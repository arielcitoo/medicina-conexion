<div class="paso1-container">
  
  <!-- Título del paso -->
  <div class="paso-header">
    <h3 class="paso-title">
      <mat-icon>receipt</mat-icon>
      Datos del Recibo
    </h3>
    <p class="paso-description">
      Complete la información del recibo de examen preocupacional
    </p>
  </div>

  <!-- Formulario -->
  <form [formGroup]="form" class="paso-form">
    
    <!-- Fila 1: Número de recibo y Total importe -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field required-field">
        <mat-label>Número de Recibo</mat-label>
        <input matInput 
               formControlName="numeroRecibo" 
               placeholder="Ej: 019393">
        <mat-icon matSuffix>tag</mat-icon>
        
        @if (form.get('numeroRecibo')?.hasError('required')) {
          <mat-error>El número de recibo es requerido</mat-error>
        }
        @if (form.get('numeroRecibo')?.hasError('pattern')) {
          <mat-error>Formato inválido (solo números y guiones)</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field required-field">
        <mat-label>Total Importe</mat-label>
        <input matInput 
               type="number" 
               formControlName="totalImporte" 
               placeholder="0.00">
        <span matPrefix> Bs. &nbsp;</span>
        <mat-icon matSuffix>attach_money</mat-icon>
        
        @if (form.get('totalImporte')?.hasError('required')) {
          <mat-error>El importe es requerido</mat-error>
        }
        @if (form.get('totalImporte')?.hasError('min')) {
          <mat-error>El importe debe ser mayor a 0</mat-error>
        }
      </mat-form-field>
    </div>

    <!-- Cantidad de asegurados -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field required-field">
        <mat-label>Cantidad de Asegurados</mat-label>
        <input matInput 
               type="number" 
               formControlName="cantidadAsegurados" 
               [min]="1"
               placeholder="Ej: 5">
        <mat-icon matSuffix>people</mat-icon>
        
        @if (form.get('cantidadAsegurados')?.hasError('required')) {
          <mat-error>La cantidad es requerida</mat-error>
        }
        @if (form.get('cantidadAsegurados')?.hasError('min')) {
          <mat-error>Mínimo 1 asegurado</mat-error>
        }
        
        <mat-hint>
          @if (form.get('cantidadAsegurados')?.value > 1) {
            Requiere datos de contacto del empleador
          }
        </mat-hint>
      </mat-form-field>
    </div>

    <!-- Campos condicionales para más de 1 asegurado -->
    @if (form.get('cantidadAsegurados')?.value > 1) {
      <div class="conditional-section">
        <div class="section-header">
          <mat-icon>info</mat-icon>
          <p>Para múltiples asegurados, se requiere información de contacto del empleador</p>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field required-field">
            <mat-label>Correo Electrónico del Empleador</mat-label>
            <input matInput 
                   type="email" 
                   formControlName="correoEmpleador" 
                   placeholder="empleador@empresa.com">
            <mat-icon matSuffix>email</mat-icon>
            
            @if (form.get('correoEmpleador')?.hasError('required')) {
              <mat-error>El correo es requerido</mat-error>
            }
            @if (form.get('correoEmpleador')?.hasError('email')) {
              <mat-error>Ingrese un correo válido</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field required-field">
            <mat-label>Celular del Empleador</mat-label>
            <input matInput 
                   formControlName="celularEmpleador" 
                   placeholder="72882569">
            <mat-icon matSuffix>phone</mat-icon>
            
            @if (form.get('celularEmpleador')?.hasError('required')) {
              <mat-error>El celular es requerido</mat-error>
            }
            @if (form.get('celularEmpleador')?.hasError('pattern')) {
              <mat-error>Debe tener 8 dígitos</mat-error>
            }
          </mat-form-field>
        </div>
      </div>
    }

    <!-- Subida de archivo -->
    <div class="file-upload-section">
      <div class="section-header">
        <mat-icon>cloud_upload</mat-icon>
        <div>
          <h4>Subir Imagen del Recibo</h4>
          <p class="section-description">Formato: JPG, PNG o PDF (Máximo 5MB)</p>
        </div>
      </div>

      <div class="upload-container">
        <!-- Input file oculto -->
        <input type="file" 
               #fileInput
               hidden
               (change)="onFileSelected($event)"
               accept="image/*,.pdf">
        
        <!-- Botón de selección -->
        <button mat-raised-button 
                color="primary" 
                type="button"
                (click)="fileInput.click()"
                class="upload-button">
          <mat-icon>upload</mat-icon>
          Seleccionar Archivo
        </button>

        <!-- Información del archivo -->
        @if (form.get('imagenRecibo')?.value) {
          <div class="file-info">
            <div class="file-details">
              <mat-icon>description</mat-icon>
              <div>
                <span class="file-name">{{ form.get('imagenRecibo')?.value?.name }}</span>
                <span class="file-size">
                  {{ (form.get('imagenRecibo')?.value?.size / 1024 / 1024).toFixed(2) }} MB
                </span>
              </div>
            </div>
            <button mat-icon-button 
                    color="warn" 
                    type="button"
                    (click)="removeFile()"
                    matTooltip="Eliminar archivo">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        }
      </div>

      <!-- Preview de imagen -->
      @if (imagenPreview && form.get('imagenRecibo')?.value?.type?.startsWith('image/')) {
        <div class="image-preview">
          <p class="preview-label">Vista previa:</p>
          <div class="preview-container">
            <img [src]="imagenPreview" alt="Preview del recibo">
            <button mat-icon-button 
                    color="warn" 
                    class="preview-close"
                    (click)="removeFile()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      }

      <!-- Mensajes de error -->
      @if (form.get('imagenRecibo')?.invalid && form.get('imagenRecibo')?.touched) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>La imagen del recibo es obligatoria</span>
        </div>
      }
    </div>

  </form>
</div>