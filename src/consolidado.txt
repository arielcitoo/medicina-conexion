============================================================================== 
ARCHIVO : src\main.ts 
============================================================================== 
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { App } from './app/app';

bootstrapApplication(App, appConfig)
  .catch((err) => console.error(err));

============================================================================== 
ARCHIVO : src\index.html 
============================================================================== 
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MedicinaConexion</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <app-root></app-root>
</body>
</html>

============================================================================== 
ARCHIVO : src\styles.css 
============================================================================== 
/* Estilos para modales */
.modal-backdrop {
  background-color: rgba(0, 0, 0, 0.5) !important;
}

.modal-panel {
  opacity: 1 !important;
  visibility: visible !important;
  background-color: white !important;
}

/* Forzar visibilidad del overlay */
.cdk-overlay-pane {
  opacity: 1 !important;
  visibility: visible !important;
  z-index: 1000 !important;
}

.cdk-overlay-backdrop {
  opacity: 0.5 !important;
  background-color: black !important;
}
============================================================================== 
ARCHIVO : src\app\app.config.ts 
============================================================================== 
import { ApplicationConfig, importProvidersFrom, provideBrowserGlobalErrorListeners, provideZonelessChangeDetection } from '@angular/core';
import { provideRouter } from '@angular/router';
import { provideHttpClient, withFetch } from '@angular/common/http';
import { provideNativeDateAdapter } from '@angular/material/core';
import { routes } from './app.routes';
import { AseguradosService } from './core/service/asegurados.service';
import { BrowserModule } from '@angular/platform-browser';
import { SharedMaterialModule } from './shared/modules/material.module';//angular Material m贸dulos compartidos
//import { ExamenPreocupacionalService } from './service/examen-preocupacional.service';

export const appConfig: ApplicationConfig = {
  providers: [
    provideBrowserGlobalErrorListeners(),
    provideZonelessChangeDetection(),
    provideRouter(routes),
    provideHttpClient(withFetch()),
    provideNativeDateAdapter(),
     AseguradosService,
      importProvidersFrom(
      SharedMaterialModule,
  //    ExamenPreocupacionalService,
      BrowserModule   
      ),
  ]
};
.
============================================================================== 
ARCHIVO : src\app\app.routes.ts 
============================================================================== 
// app-routing.module.ts

import { Routes } from '@angular/router';
import { AuthGuard } from './interceptors/auth.guard';

export const routes: Routes = [

   {
    path: '',
    redirectTo: 'home',
    pathMatch: 'full'
  },
  
  { 
    path: 'home', 
    loadComponent: () => import('./features/home/home').then(m => m.Home)
  },

  {
    path: 'admin-citas',
    loadComponent: () => import('./features/admin-citas/admin-citas/admin-citas').then(m => m.AdminCitas),
    canActivate: [AuthGuard],
    data: { requiredPermission: 'admin_citas' }
  },

  { 
    path: 'login', 
    loadComponent: () => import('./features/examenes-preocupacionales/components/login/login').then(m => m.Login)
  },

  { 
    path: 'prelogin', 
    loadComponent: () => import('./features/examenes-preocupacionales/components/prelogin/prelogin').then(m => m.Prelogin)
  },
  
  {
    path: 'admin/login',
    loadComponent: () => import('./features/admin-citas/components/login-admin/login-admin').then(m => m.LoginAdmin)
  },
  {
    path: 'acceso-denegado',
    loadComponent: () => import('./shared/components/acceso-denegado/acceso-denegado').then(m => m.AccesoDenegado)
  },

  { 
    path: 'busqueda', 
    loadComponent: () => import('./features/examenes-preocupacionales/components/busqueda-asegurados/busqueda-asegurados').then(m => m.Busqueda)
  },

 { 
    path: 'examen-preocupacional', 
    loadComponent: () => import('./features/examenes-preocupacionales/examen-preocupacional/examen-preocupacional').then(m => m.ExamenPreocupacional),
    canActivate: [AuthGuard]
  },
{ 
    path: '**', 
    redirectTo: 'home'
} 
 ];

..
============================================================================== 
ARCHIVO : src\app\app.ts 
============================================================================== 
import { Component, inject, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { NavigationEnd, Router, RouterOutlet } from '@angular/router';
import { Header} from './shared/components/header/header';
import { filter } from 'rxjs';
import { SesionService } from './core/service/sesion.service';
import { EmpresaService } from './core/service/empresa.service';





@Component({
  selector: 'app-root',
  standalone: true,
  imports: [CommonModule, RouterOutlet, Header],
  templateUrl: './app.html',
  styleUrl: './app.css'
})
export class App implements OnInit {

  private readonly router = inject(Router);
  private readonly sesionService = inject(SesionService);
  private readonly empresaService = inject(EmpresaService);

  ngOnInit(): void {
    // Track navigation for analytics
    this.router.events.pipe(
      filter(event => event instanceof NavigationEnd)
    ).subscribe(() => {
      // Analytics tracking would go here
    });

    console.log('App inicializado');
  }
}..
============================================================================== 
ARCHIVO : src\app\app.html 
============================================================================== 
<div class="app-container">
      <!-- <app-header ></app-header> -->
      <main class="main-content">
        <router-outlet></router-outlet>
      </main>
      <footer class="app-footer">
        <p>Medicina del Trabajo</p>
      </footer>
    </div>..
============================================================================== 
ARCHIVO : src\app\app.css 
============================================================================== 
.app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: #f8fafc;
    }
    
    .main-content {
      flex: 1;
    }
    
    .app-footer {
      background: #1f2937;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
    }


.debug-banner {
  background: #ff9800;
  color: white;
  padding: 5px 10px;
  font-size: 11px;
  text-align: center;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;
  opacity: 0.8;
}

.main-content {
  min-height: calc(100vh - 120px);
  padding-top: 20px;
}

.simple-footer {
  background: #f5f5f5;
  padding: 15px;
  text-align: center;
  color: #666;
  font-size: 13px;
  border-top: 1px solid #e0e0e0;
}

@media (max-width: 768px) {
  .main-content {
    min-height: calc(100vh - 100px);
    padding-top: 10px;
  }
  
  .debug-banner {
    display: none;
  }
}..
============================================================================== 
ARCHIVO : src\app\core\guards\admin-citas.guard.ts 
============================================================================== 
// core/guards/admin-citas.guard.ts
import { inject } from '@angular/core';
import { Router } from '@angular/router';
import { AuthCnsService } from '../service/auth-cns.service';

export const adminCitasGuard = () => {
  const authService = inject(AuthCnsService);
  const router = inject(Router);
  
  // 1. Verificar autenticaci贸n
  if (!authService.isAuthenticated()) {
    router.navigate(['/login']);
    return false;
  }
  
  // 2. Verificar si es admin o tiene permisos espec铆ficos
  const isAdmin = authService.isAdmin();
  const hasPermission = authService.hasPermission('administrar_citas');
  
  if (!isAdmin && !hasPermission) {
    // Redirigir a acceso denegado con informaci贸n del usuario
    router.navigate(['/acceso-denegado']);
    return false;
  }
  
  return true;
};..
============================================================================== 
ARCHIVO : src\app\core\interceptors\auth.interceptor.ts 
============================================================================== 
// core/interceptors/auth.interceptor.ts
import { Injectable } from '@angular/core';
import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpErrorResponse } from '@angular/common/http';
import { Observable, throwError, BehaviorSubject } from 'rxjs';
import { catchError, filter, take, switchMap } from 'rxjs/operators';
import { AuthCnsService } from '../service/auth-cns.service';

@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  private isRefreshing = false;
  private refreshTokenSubject = new BehaviorSubject<string | null>(null);
  
  constructor(private authService: AuthCnsService) {}
  
  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    // No interceptar peticiones de autenticaci贸n
    if (req.url.includes('/connect/token')) {
      return next.handle(req);
    }
    
    const token = this.authService.getAccessToken();
    
    if (token) {
      req = this.addToken(req, token);
    }
    
    return next.handle(req).pipe(
      catchError(error => {
        if (error instanceof HttpErrorResponse && error.status === 401) {
          return this.handle401Error(req, next);
        }
        return throwError(() => error);
      })
    );
  }
  
  private addToken(request: HttpRequest<any>, token: string): HttpRequest<any> {
    return request.clone({
      setHeaders: {
        Authorization: `Bearer ${token}`
      }
    });
  }
  
  private handle401Error(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    if (!this.isRefreshing) {
      this.isRefreshing = true;
      this.refreshTokenSubject.next(null);
      
      return this.authService.refreshToken().pipe(
        switchMap((token: any) => {
          this.isRefreshing = false;
          this.refreshTokenSubject.next(token.access_token);
          return next.handle(this.addToken(request, token.access_token));
        }),
        catchError((error) => {
          this.isRefreshing = false;
          this.authService.logout();
          return throwError(() => error);
        })
      );
    } else {
      return this.refreshTokenSubject.pipe(
        filter(token => token !== null),
        take(1),
        switchMap(token => {
          return next.handle(this.addToken(request, token!));
        })
      );
    }
  }
}..
============================================================================== 
ARCHIVO : src\app\core\service\asegurados.service.ts 
============================================================================== 
import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpParams, HttpHeaders, HttpErrorResponse } from '@angular/common/http';
import { Observable, throwError } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { BaseApiService } from './base-api.service';
import { Asegurado, BusquedaAseguradoResponse } from '../../interface/asegurado.interface';
import { API_CONFIG } from '../../shared/config/api.config';


@Injectable({
  providedIn: 'root'
})
export class AseguradosService extends BaseApiService {

  /**
   * Buscar asegurado titular por documento de identidad y fecha de nacimiento
   */
   buscarAsegurado(documento: string, fechaNacimiento: string): Observable<BusquedaAseguradoResponse> {
    const url = `${this.baseUrl}${API_CONFIG.endpoints.aseguradoTitular}`;
    const params = new HttpParams()
      .set('DocumentoIdentidad', documento)
      .set('FechaNacimiento', fechaNacimiento);

    return this.http.get<any>(url, {
      params,
      headers: this.getAuthHeaders()
    }).pipe(
      map(response => this.mapToAseguradoResponse(response))
    );
  }


  /**
   * Mapea la respuesta de la API al formato de la interfaz
   */
    private mapToAseguradoResponse(apiResponse: any): BusquedaAseguradoResponse {
    if (!apiResponse) {
      return {
        success: false,
        message: 'No se encontraron datos del asegurado'
      };
    }

    // Si la API ya devuelve un objeto con la estructura correcta
    if (apiResponse.success !== undefined) {
      return apiResponse as BusquedaAseguradoResponse;
    }

    const asegurado: Asegurado = {
      aseguradoId: apiResponse.aseguradoId || 0,
      matricula: apiResponse.matricula || '',
      estadoAsegurado: apiResponse.estadoAsegurado || '',
      documentoIdentidad: apiResponse.documentoIdentidad || '',
      extencion: apiResponse.extencion || '',
      complemento: apiResponse.complemento || '',
      fechaNacimiento: apiResponse.fechaNacimiento || '',
      paterno: apiResponse.primerApellido || apiResponse.paterno || '',
      materno: apiResponse.segundoApellido || apiResponse.materno || '',
      nombres: apiResponse.nombres || '',
      genero: apiResponse.genero || '',
      tipoAsegurado: apiResponse.tipoAsegurado || '',
      razonSocial: apiResponse.razonSocial || '',
      nroPatronal: apiResponse.nroPatronal || '',
      estadoMora: apiResponse.estadoMora || '',
      grupoFamiliarId: apiResponse.grupoFamiliarId || 0,
      // Campos que pueden no venir de la API, establecer valores por defecto
      correoElectronico: apiResponse.correoElectronico || apiResponse.correo || '',
      celular: apiResponse.celular || apiResponse.telefono || '',
      area: apiResponse.area || apiResponse.departamento || '',
      cargo: apiResponse.cargo || apiResponse.puesto || '',
      fechaIngreso: apiResponse.fechaIngreso || apiResponse.fechaAfiliacion || '',
      empresaId: apiResponse.empresaId || undefined,
      nombreCompleto: this.generarNombreCompleto(apiResponse)
    };

    return {
      success: true,
      data: asegurado,
      message: 'Asegurado encontrado correctamente'
    };
  }

  /**
   * Genera el nombre completo a partir de los componentes
   */
 private generarNombreCompleto(asegurado: any): string {
    const partes = [];
    if (asegurado.nombres) partes.push(asegurado.nombres);
    if (asegurado.primerApellido || asegurado.paterno) partes.push(asegurado.primerApellido || asegurado.paterno);
    if (asegurado.segundoApellido || asegurado.materno) partes.push(asegurado.segundoApellido || asegurado.materno);

    return partes.join(' ');
  }
}
..
============================================================================== 
ARCHIVO : src\app\core\service\auth-cns.service.ts 
============================================================================== 
// core/service/auth-cns.service.ts
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Router } from '@angular/router';
import { BehaviorSubject, Observable, of } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { environment } from '../../../environments/environment.development';

export interface UserInfo {
    id: string;
    username: string;
    nombreCompleto: string;
    email: string;
    roles: string[];
    permisos: string[];
    area: string;
    cargo: string;
    unidad: string;
}

@Injectable({ providedIn: 'root' })
export class AuthCnsService {
    private readonly AUTH_URL = 'https://auth-desarrollo.cns.gob.bo';
    private readonly API_URL = 'https://api-desarrollo.cns.gob.bo';
    private readonly STORAGE_KEY = 'cns_auth_data';

    private currentUserSubject = new BehaviorSubject<UserInfo | null>(null);
    currentUser$ = this.currentUserSubject.asObservable();

    constructor(
        private http: HttpClient,
        private router: Router
    ) {
        this.loadStoredUser();
    }

    /**
     * Iniciar sesi贸n con el SSO del CNS
     */
    // login(username: string, password: string): Observable<any> {
    //     return this.http.post(`${this.AUTH_URL}/connect/token`, {
    //         grant_type: 'password',
    //         username: username,
    //         password: password,
    //         client_id: 'erp_web_client',
    //         client_secret: 'your_client_secret_here', // Esto debe venir de configuraci贸n
    //         scope: 'openid profile email roles offline_access erp_api'
    //     }, {
    //         headers: {
    //             'Content-Type': 'application/x-www-form-urlencoded'
    //         }
    //     }).pipe(
    //         tap((response: any) => {
    //             // Guardar tokens
    //             this.storeTokens(response);
    //             // Obtener informaci贸n del usuario
    //             return this.getUserInfo();
    //         }),
    //         catchError(error => {
    //             console.error('Error en login:', error);
    //             throw error;
    //         })
    //     );
    // }

    /**
     * Obtener informaci贸n del usuario autenticado
     */
    getUserInfo(): Observable<UserInfo> {
        return this.http.get<UserInfo>(`${this.API_URL}/api/usuario/info`).pipe(
            tap(user => {
                this.storeUser(user);
                this.currentUserSubject.next(user);
            }),
            catchError(error => {
                console.error('Error obteniendo info usuario:', error);
                throw error;
            })
        );
    }

    /**
     * Cerrar sesi贸n
     */
    logout(): void {
        // Limpiar datos locales
        localStorage.removeItem(this.STORAGE_KEY);
        localStorage.removeItem('cns_access_token');
        localStorage.removeItem('cns_refresh_token');
        sessionStorage.clear();

        // Redirigir al logout del SSO
        window.location.href = `${this.AUTH_URL}/connect/endsession`;
    }

    /**
     * Verificar si el usuario est谩 autenticado
     */
    isAuthenticated(): boolean {
        const token = this.getAccessToken();
        if (!token) return false;

        // Verificar expiraci贸n del token
        const payload = this.decodeToken(token);
        if (!payload || !payload.exp) return false;

        const now = Math.floor(Date.now() / 1000);
        return payload.exp > now;
    }

    /**
     * Verificar si tiene rol de administrador
     */
    isAdmin(): boolean {
        const user = this.currentUserSubject.value;
        return user?.roles?.includes('admin') ||
            user?.roles?.includes('administrador') ||
            user?.roles?.includes('administrador_citas') || false;
    }

    /**
     * Verificar permisos espec铆ficos
     */
    hasPermission(permission: string): boolean {
        const user = this.currentUserSubject.value;
        return user?.permisos?.includes(permission) || false;
    }

    /**
     * Obtener token de acceso
     */
    getAccessToken(): string | null {
        return localStorage.getItem('cns_access_token');
    }

    /**
     * Decodificar token JWT
     */
    private decodeToken(token: string): any {
        try {
            const payload = token.split('.')[1];
            return JSON.parse(atob(payload));
        } catch {
            return null;
        }
    }

    /**
     * Guardar tokens en localStorage
     */
    private storeTokens(authResponse: any): void {
        if (authResponse.access_token) {
            localStorage.setItem('cns_access_token', authResponse.access_token);
        }
        if (authResponse.refresh_token) {
            localStorage.setItem('cns_refresh_token', authResponse.refresh_token);
        }
    }

    /**
     * Guardar informaci贸n del usuario
     */
    private storeUser(user: UserInfo): void {
        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(user));
    }

    /**
     * Cargar usuario almacenado
     */
    private loadStoredUser(): void {
        try {
            const stored = localStorage.getItem(this.STORAGE_KEY);
            if (stored) {
                const user = JSON.parse(stored);
                this.currentUserSubject.next(user);
            }
        } catch (error) {
            console.error('Error cargando usuario almacenado:', error);
        }
    }

    /**
     * Refrescar token (para implementar si es necesario)
     */
    refreshToken(): Observable<any> {
        const refreshToken = localStorage.getItem('cns_refresh_token');
        if (!refreshToken) {
            this.router.navigate(['/login']);
            return of(null);
        }

        return this.http.post(`${this.AUTH_URL}/connect/token`, {
            grant_type: 'refresh_token',
            refresh_token: refreshToken,
            client_id: 'erp_web_client',
            client_secret: 'your_client_secret_here'
        }).pipe(
            tap((response: any) => {
                this.storeTokens(response);
            }),
            catchError(error => {
                console.error('Error refrescando token:', error);
                this.logout();
                return of(null);
            })
        );
    }

    // En auth-cns.service.ts - m茅todo login
    login(username: string, password: string): Observable<any> {
        // Modo demo para desarrollo
        if (!environment.production && username === 'admin' && password === 'admin') {
            const demoUser: UserInfo = {
                id: 'demo-1',
                username: 'admin',
                nombreCompleto: 'Administrador Demo',
                email: 'admin@cns.gob.bo',
                roles: ['admin', 'administrador_citas'],
                permisos: ['ver_citas', 'aprobar_citas', 'programar_citas'],
                area: 'Medicina del Trabajo',
                cargo: 'Administrador',
                unidad: 'Sistemas'
            };

            localStorage.setItem('cns_access_token', 'demo-token-' + Date.now());
            this.storeUser(demoUser);
            this.currentUserSubject.next(demoUser);

            return of(demoUser);
        }

        // Autenticaci贸n real
        return this.http.post(`${this.AUTH_URL}/connect/token`, {
            // ... par谩metros reales
        });
    }
}..
============================================================================== 
ARCHIVO : src\app\core\service\base-api.service.ts 
============================================================================== 
// core/services/base-api.service.ts
import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';
import { Observable, throwError } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { ConfigService } from './config.service';

@Injectable({ providedIn: 'root' })
export abstract class BaseApiService {
  protected readonly http = inject(HttpClient);
  protected readonly configService = inject(ConfigService);
  
  // Token deber铆a venir de un servicio de autenticaci贸n
  protected token = 'eyJhbGciOiJSUzI1NiIsImtpZCI6IjExMjFCOEVCNTk4NTc5RjQwOTA1MDJEMDAyOUMxNjExMzU1MUIzOUZSUzI1NiIsInR5cCI6ImF0K2p3dCIsIng1dCI6IkVTRzQ2MW1GZWZRSkJRTFFBcHdXRVRWUnM1OCJ9.eyJuYmYiOjE3Njk3MDAxMTIsImV4cCI6MTc2OTczNjExMiwiaXNzIjoiaHR0cHM6Ly9hdXRoLWRlc2Fycm9sbG8uY25zLmdvYi5ibyIsImF1ZCI6WyJhZG1pbkNsaWVudF9hcGkiLCJBUElfRXhhbXBsZSIsImVycFNlcnZpY2VzIiwidGVzdC1ycmhoIiwiQVBJX1JFUE9SVCJdLCJjbGllbnRfaWQiOiJleGFtcGxlX3N3YWdnZXJ1aSIsInN1YiI6Ijg2NDIxMzU2LWM4NjQtNDA4NS1hNGJhLTdkODQ4ZWRiZjU0MCIsImF1dGhfdGltZSI6MTc2OTY5OTk4MiwiaWRwIjoibG9jYWwiLCJpZGVudGl0eSI6IjBjYTExZDY1LWM0MjAtNGIzYi04NjZkLTJlMTU5MGI4YTkzMyIsInNpZCI6IjZCNTY4NTM2MTUyMTA1MTI4REQ1Q0ZCQzhFRkM1ODI0IiwiaWF0IjoxNzY5NzAwMTEyLCJzY29wZSI6WyJlcnBTZXJ2aWNlcyJdLCJhbXIiOlsicHdkIl19.TH98dy8q5DgXi2nGe-alA6MFoNGuyK1jnqyK7tEZeT84SjXoiMlqn0ClMe6Kg7p81mbeqt-OrpMqe0jGfAJzI5cENu9nybcTG1k4njDB-KX8pekHrFcNwPH_8xkkH8IniS7vqbZk2bRsExlHpPK29dBTWZEupd4F8HfSx6N5H4p45WcEsVE4HMTKbsJHc4d0sRMPGyAlVNMArY_jlYLOtLjfhgHu2et0cyNcNTQVQzgZvShnkBybrme8RtEIjLXzoa6zpGOVIYo3AH6gOqk8Mjp1i5aStR0CU45YQyFqrLKL_e6QAwiPzCOs_8RyZLrWzC5Q-bhjL_i79YG-fuY6-Q';

  protected get baseUrl(): string {
    return this.configService.apiConfig.baseUrl;
  }

  /**
   * Obtiene el token actual
   */
  getToken(): string {
    return this.token;
  }

  /**
   * Verifica si el token es v谩lido
   */
  isTokenValid(): boolean {
    return !!this.token && this.token.length > 100; // Validaci贸n b谩sica
  }

  /**
   * Establece un nuevo token
   */
  setToken(newToken: string): void {
    this.token = newToken;
  }

  protected getAuthHeaders(): HttpHeaders {
    return new HttpHeaders({
      'Authorization': `Bearer ${this.token}`,
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    });
  }

    // M茅todos HTTP helper simplificados
  protected getRequest<T>(endpoint: string, params?: any): Observable<T> {
    return this.http.get<T>(
      `${this.baseUrl}${endpoint}`,
      { 
        headers: this.getAuthHeaders(),
        params: params 
      }
    ).pipe(
      catchError(this.handleError)
    );
  }

  protected postRequest<T>(endpoint: string, body: any): Observable<T> {
    return this.http.post<T>(
      `${this.baseUrl}${endpoint}`,
      body,
      { headers: this.getAuthHeaders() }
    ).pipe(
      catchError(this.handleError)
    );
  }

  protected putRequest<T>(endpoint: string, body: any): Observable<T> {
    return this.http.put<T>(
      `${this.baseUrl}${endpoint}`,
      body,
      { headers: this.getAuthHeaders() }
    ).pipe(
      catchError(this.handleError)
    );
  }

  protected deleteRequest<T>(endpoint: string): Observable<T> {
    return this.http.delete<T>(
      `${this.baseUrl}${endpoint}`,
      { headers: this.getAuthHeaders() }
    ).pipe(
      catchError(this.handleError)
    );
  }

  protected handleError(error: HttpErrorResponse): Observable<never> {
  const errorMessages: { [key: number]: string } = {  // <-- Tipo expl铆cito
    0: 'Error de conexi贸n. Verifique su conexi贸n a internet.',
    400: 'Solicitud incorrecta. Verifique los datos enviados.',
    401: 'No autorizado. Su sesi贸n ha expirado.',
    403: 'Acceso prohibido.',
    404: 'Recurso no encontrado.',
    409: 'Conflicto: El recurso ya existe.',
    500: 'Error interno del servidor.',
    502: 'Servicio temporalmente no disponible.',
    503: 'Servicio no disponible.',
    504: 'Tiempo de espera agotado.'
  };

  // Ahora TypeScript sabe que podemos usar n煤meros como 铆ndices
  const message = errorMessages[error.status] || 
                 error.error?.message || 
                 `Error ${error.status}: ${error.message}`;

  console.error('API Error:', {
    status: error.status,
    message: error.message,
    url: error.url,
    details: error.error
  });

  return throwError(() => new Error(message));
}


}..
============================================================================== 
ARCHIVO : src\app\core\service\config.service.ts 
============================================================================== 
import { Injectable } from '@angular/core';
import { environment } from '../../../environments/environment.development';
import { STORAGE_KEYS } from '../../shared/config/api.config';

@Injectable({ providedIn: 'root' })
export class ConfigService {
  private readonly config = {
    api: {
      baseUrl: environment.apiBaseUrl,
      endpoints: {
        aseguradoTitular: '/Afiliaciones/Asegurados/AseguradoTitular',
        empresasAfiliadas: '/Afiliaciones/EmpresasAfiliadas/Search',
        examenesPreocupacionales: '/examenes-preocupacionales',
        adminCitas: '/admin-citas'
      }
    },
    storageKeys: STORAGE_KEYS, // Esto ahora incluye todas las keys
    timeouts: {
      sesion: 7 * 24 * 60 * 60 * 1000, // 7 d铆as
      empresaCache: 60 * 60 * 1000 // 1 hora
    },
    validation: {
      maxFileSize: 5 * 1024 * 1024,
      maxAsegurados: 100,
      celularPattern: /^[0-9]{8}$/
    }
  };

  get apiConfig() {
    return this.config.api;
  }

  get storageKeys() {
    return this.config.storageKeys;
  }

  get timeouts() {
    return this.config.timeouts;
  }

  get validation() {
    return this.config.validation;
  }

  buildApiUrl(endpoint: string): string {
    return `${this.config.api.baseUrl}${endpoint}`;
  }
}..
============================================================================== 
ARCHIVO : src\app\core\service\empresa.service.ts 
============================================================================== 
import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpParams, HttpHeaders, HttpErrorResponse } from '@angular/common/http';
import { Observable, BehaviorSubject } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { BaseApiService } from './base-api.service';
import { Empresa, VerificacionEmpresaResponse } from '../../interface/empresa.interface';
import { API_CONFIG, STORAGE_KEYS, ERROR_MESSAGES } from '../../shared/config/api.config';

@Injectable({
  providedIn: 'root'
})

export class EmpresaService extends BaseApiService {
  private empresaSource = new BehaviorSubject<Empresa | null>(null);
  empresaChanged$ = this.empresaSource.asObservable();

  constructor() {
    super();
    this.cargarEmpresaInicial();
  }

  /**
   * Cargar empresa desde localStorage al iniciar
   */
  private cargarEmpresaInicial(): void {
    const empresa = this.getEmpresaExamen();
    if (empresa) {
      this.empresaSource.next(empresa);
    }
  }

  /**
   * Buscar empresa por n煤mero patronal
   */
  buscarEmpresa(numeroPatronal: string): Observable<VerificacionEmpresaResponse> {
    const url = `${this.baseUrl}${API_CONFIG.endpoints.empresasAfiliadas}`;
    const params = new HttpParams()
      .set('Tipo', '3')
      .set('Search', numeroPatronal);

    return this.http.get<any[]>(url, {
      params,
      headers: this.getAuthHeaders()
    }).pipe(
      map(response => this.procesarRespuestaEmpresa(response, numeroPatronal)),
      tap(resultado => {
        if (resultado.success) {
          this.guardarEmpresaExamen(resultado.empresa);
        }
      })
    );
  }

  /**
   * Procesa la respuesta de la API y la normaliza
   * Garantiza que siempre retorne una Empresa v谩lida cuando success = true
   */
  private procesarRespuestaEmpresa(response: any[], numeroPatronal: string): VerificacionEmpresaResponse {
    if (!response || !Array.isArray(response) || response.length === 0) {
      return {
        success: false,
        mensaje: ERROR_MESSAGES.empresaNotFound,
        codigo: 'EMPRESA_NO_ENCONTRADA',
        empresa: this.crearEmpresaVacia() // Empresa vac铆a pero v谩lida
      };
    }

    const empresaData = response[0];
    const empresaNormalizada = this.normalizarEmpresa(empresaData, numeroPatronal);

    return {
      success: true,
      mensaje: `Empresa encontrada: ${empresaNormalizada.razonSocial}`,
      codigo: 'EMPRESA_ENCONTRADA',
      empresa: empresaNormalizada
    };
  }

  /**
   * Normaliza los datos de la empresa a un formato consistente
   */
  private normalizarEmpresa(empresaData: any, numeroPatronal: string): Empresa {
  const estado = empresaData.parametroEstadoEmpresa?.descripcion || empresaData.estado || 'DESCONOCIDO';
  const razonSocial = empresaData.empresa?.razonSocial || empresaData.razonSocial || 'Sin raz贸n social';
  const nit = empresaData.empresa?.nit || empresaData.nit || '';

  return {
    id: empresaData.id || empresaData.empresaId || Date.now(),
    numeroPatronal: empresaData.nroPatronal || numeroPatronal,
    razonSocial: razonSocial,
    ruc: nit, // 隆Aqu铆 se guarda como 'ruc' pero es el NIT!
    direccion: empresaData.referenciaDireccion || empresaData.direccion || '',
    telefono: empresaData.empresa?.telefono || empresaData.telefono || '',
    estado: estado,
    email: empresaData.email || '',
    fechaAfiliacion: new Date(empresaData.fechaAfiliacion || Date.now()),
    tipoEmpresa: empresaData.tipoEmpresa || ''
  };
}
/**
   * Crea una empresa vac铆a pero v谩lida para mantener consistencia de tipos
   */
  private crearEmpresaVacia(): Empresa {
    return {
      id: 0,
      numeroPatronal: '',
      razonSocial: '',
      ruc: '',
      direccion: '',
      telefono: '',
      estado: '',
      email: '',
      fechaAfiliacion: new Date(),
      tipoEmpresa: ''
    };
  }

  /**
   * Guardar empresa en localStorage y emitir cambio
   */
  guardarEmpresaExamen(empresa: Empresa): void {
    if (!empresa) return;

    const empresaData = {
      ...empresa,
      fechaVerificacion: new Date().toISOString(),
      verificada: true,
      puedeAcceder: this.estaActiva(empresa)
    };

    localStorage.setItem(STORAGE_KEYS.empresaExamen, JSON.stringify(empresaData));
    this.empresaSource.next(empresaData);
  }

   /**
   * Obtener empresa desde localStorage
   */
  getEmpresaExamen(): Empresa | null {
    try {
      const data = localStorage.getItem(STORAGE_KEYS.empresaExamen);
      if (!data) return null;

      const empresa = JSON.parse(data) as Empresa & { fechaVerificacion: string };

      // Verificar que la empresa a煤n sea v谩lida (menos de 1 hora)
      const fechaVerificacion = new Date(empresa.fechaVerificacion);
      const ahora = new Date();
      const diferenciaHoras = (ahora.getTime() - fechaVerificacion.getTime()) / (1000 * 60 * 60);

      if (diferenciaHoras > 1) {
        this.limpiarDatosExamen();
        return null;
      }

      this.empresaSource.next(empresa);
      return empresa;
    } catch {
      return null;
    }
  }

  /**
   * Verificar si puede acceder al examen
   */
  puedeAccederExamen(): boolean {
    const empresa = this.getEmpresaExamen();

    if (!empresa) return false;
    if (!this.estaActiva(empresa)) return false;
    if (!this.isTokenValid()) return false;

    return true;
  }

  /**
   * Redirigir al examen (m茅todo as铆ncrono)
   */
  async redirigirAExamen(): Promise<boolean> {
    if (!this.puedeAccederExamen()) {
      throw new Error('No tiene permisos para acceder al examen. Verifique que la empresa est茅 activa.');
    }
    return true;
  }

  /**
   * Verificar si empresa est谩 activa
   */
  estaActiva(empresa: Empresa): boolean {
    if (!empresa) return false;

    const estado = empresa.estado.toUpperCase();
    return estado.includes('ACTIV') || estado === 'ACTIVO' || estado === 'ACTIVA' || estado.includes('VIGENTE');
  }

  /**
   * Limpiar datos de empresa
   */
  limpiarDatosExamen(): void {
    localStorage.removeItem(STORAGE_KEYS.empresaExamen);
    this.empresaSource.next(null);
  }
}
..
============================================================================== 
ARCHIVO : src\app\core\service\examen-preocupacional.service.ts 
============================================================================== 
import { HttpClient, HttpResponse } from '@angular/common/http';
import { inject, Injectable } from '@angular/core';
import { catchError, Observable, tap, throwError } from 'rxjs';
import { environment } from '../../../environments/environment';
import { PaginationDTO } from '../../models/PaginationDTO';
import { buildQueryParams } from '../../shared/utils/buildQueryParams';

export interface ExamenPreocupacionalResponse {
  id: number;
  numeroPatronal: string;
  razonSocial: string;
  nit: string;
  fechaSolicitud: string;
  estado: string;
  observaciones?: string;
}

export interface ApiErrorResponse {
  type?: string;
  title?: string;
  status?: number;
  detail?: string;
  errors?: { [key: string]: string[] };
  message?: string;
}

export interface ExamenPreocupacionalCreateDTO {
  numeroPatronal: string;
  razonSocial: string;
  nit: string;
  Asegurados: AseguradoCreateDTO[];
  observaciones?: string;
}

export interface AseguradoCreateDTO {
  aseguradoId: number;
  ci: string;
  nombreCompleto: string;
  fechaNacimiento: string; // Formato: YYYY-MM-DD
  genero?: string;
  correoElectronico: string;
  celular: string;
  empresa: string;
  nitEmpresa?: string;
}

export interface ExamenPreocupacionalDTO {
  id: number;
  numeroPatronal: string;
  razonSocial: string;
  nit: string;
  fechaSolicitud: string;
  fechaAprobacion?: string;
  estado: string;
  observaciones?: string;
  asegurados: AseguradoDTO[];
  documentos?: DocumentoExamenDTO[];
}

export interface AseguradoDTO {
  id: number;
  examenId: number;
  aseguradoId: number;
  ci: string;
  nombreCompleto: string;
  fechaNacimiento: string;
  genero?: string;
  correoElectronico: string;
  celular: string;
  empresa: string;
  nitEmpresa?: string;
  estado: string;
  fechaRegistro: string;
}

export interface DocumentoExamenDTO {
  id: number;
  examenId: number;
  nombreArchivo: string;
  rutaArchivo?: string;
  tipoDocumento: string;
  tamanioBytes: number;
  contentType?: string;
  fechaCarga: string;
  observaciones?: string;
}

export interface DocumentoCreateDTO {
  archivo: File;
  tipoDocumento: string;
  observaciones?: string;
}

export interface BuscarExamenesDTO extends PaginationDTO {
  numeroPatronal?: string;
  razonSocial?: string;
  estado?: string;
  fechaDesde?: string;
  fechaHasta?: string;
}


@Injectable({
  providedIn: 'root'
})
export class ExamenPreocupacionalService {
  private http = inject(HttpClient);
  private urlBase = environment.apiUrl + '/examenes-preocupacionales';
  /**
   * Obtiene la lista paginada de ex谩menes
   */
  public getPagination(filtros: BuscarExamenesDTO): Observable<HttpResponse<ExamenPreocupacionalDTO[]>> {
    let queryParams = buildQueryParams(filtros);
    return this.http.get<ExamenPreocupacionalDTO[]>(this.urlBase, {
      params: queryParams,
      observe: 'response'
    });
  }

  /**
   * Crea un nuevo examen preocupacional
   */
  public createExamen(examen: ExamenPreocupacionalCreateDTO): Observable<ExamenPreocupacionalResponse> {
  // DEBUG
  console.log('=== ENVIANDO EXAMEN ===');
  console.log('URL:', this.urlBase);
  console.log('Datos completos:', JSON.stringify(examen, null, 2));
  console.log('Cantidad de asegurados:', examen.Asegurados?.length);
  
  if (examen.Asegurados && examen.Asegurados.length > 0) {
    console.log('Primer asegurado:', examen.Asegurados[0]);
    console.log('Fecha nacimiento del primer asegurado:', examen.Asegurados[0].fechaNacimiento);
  }

  return this.http.post<ExamenPreocupacionalResponse>(this.urlBase, examen).pipe(
    tap((response: ExamenPreocupacionalResponse) => {
      console.log(' Respuesta exitosa del backend:', response);
    }),
    catchError((error: any) => {
      console.error(' Error en createExamen:');
      console.error('Status:', error.status);
      console.error('Status Text:', error.statusText);
      
      if (error.error) {
        console.error('Error body:', error.error);
        
        // Si es error de validaci贸n (400)
        if (error.status === 400) {
          const apiError = error.error as ApiErrorResponse;
          
          if (apiError.errors) {
            console.error('Errores de validaci贸n:');
            Object.keys(apiError.errors).forEach(key => {
              console.error(`  ${key}:`, apiError.errors![key]);
            });
          } else if (apiError.message) {
            console.error('Mensaje de error:', apiError.message);
          } else if (apiError.detail) {
            console.error('Detalle del error:', apiError.detail);
          }
        }
      }
      
      return throwError(() => error);
    })
  );
}

  /**
   * Obtiene un examen por ID
   */
  public getById(id: number): Observable<ExamenPreocupacionalDTO> {
    return this.http.get<ExamenPreocupacionalDTO>(`${this.urlBase}/${id}`);
  }

  /**
   * Actualiza un examen existente
   */
  public updateExamen(id: number, examen: { observaciones?: string; estado?: string }): Observable<any> {
    return this.http.put(`${this.urlBase}/${id}`, examen);
  }

  /**
   * Elimina un examen
   */
  public deleteExamen(id: number): Observable<any> {
    return this.http.delete(`${this.urlBase}/${id}`);
  }

  /**
   * Sube un documento para un examen
   */
  public subirDocumento(examenId: number, documento: DocumentoCreateDTO): Observable<any> {
    const formData = this.createFormDataDocumento(documento);
    const url = `${environment.apiUrl}/examenes/${examenId}/documentos`;
    return this.http.post(url, formData);
  }

  /**
   * Obtiene documentos de un examen
   */
  public getDocumentos(examenId: number): Observable<DocumentoExamenDTO[]> {
    const url = `${environment.apiUrl}/examenes/${examenId}/documentos`;
    return this.http.get<DocumentoExamenDTO[]>(url);
  }

  /**
   * Elimina un documento
   */
  public deleteDocumento(examenId: number, documentoId: number): Observable<any> {
    const url = `${environment.apiUrl}/examenes/${examenId}/documentos/${documentoId}`;
    return this.http.delete(url);
  }

  /**
   * Crea FormData para documentos
   */
  private createFormDataDocumento(documento: DocumentoCreateDTO): FormData {
    const formData = new FormData();
    formData.append('archivo', documento.archivo);
    formData.append('tipoDocumento', documento.tipoDocumento);
    
    if (documento.observaciones) {
      formData.append('observaciones', documento.observaciones);
    }
    
    return formData;
  }

  
  /**
   * Obtiene todos los ex谩menes (sin paginaci贸n)
   */
  public getAll(): Observable<ExamenPreocupacionalDTO[]> {
    return this.http.get<ExamenPreocupacionalDTO[]>(this.urlBase);
  }
}..
============================================================================== 
ARCHIVO : src\app\core\service\notification.service.ts 
============================================================================== 
// core/services/notification.service.ts
import { Injectable, inject } from '@angular/core';
import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';

@Injectable({ providedIn: 'root' })
export class NotificationService {
  private readonly snackBar = inject(MatSnackBar);
  
  private readonly defaultConfig: MatSnackBarConfig = {
    duration: 3000,
    horizontalPosition: 'right',
    verticalPosition: 'top'
  };

  success(message: string, config?: MatSnackBarConfig): void {
    this.snackBar.open(message, 'Cerrar', {
      ...this.defaultConfig,
      ...config,
      panelClass: ['snackbar-success']
    });
  }

  error(message: string, config?: MatSnackBarConfig): void {
    this.snackBar.open(message, 'Cerrar', {
      ...this.defaultConfig,
      ...config,
      panelClass: ['snackbar-error']
    });
  }

  warning(message: string, config?: MatSnackBarConfig): void {
    this.snackBar.open(message, 'Cerrar', {
      ...this.defaultConfig,
      ...config,
      panelClass: ['snackbar-warning']
    });
  }

  info(message: string, config?: MatSnackBarConfig): void {
    this.snackBar.open(message, 'Cerrar', {
      ...this.defaultConfig,
      ...config,
      panelClass: ['snackbar-info']
    });
  }
}..
============================================================================== 
ARCHIVO : src\app\core\service\sesion.service.ts 
============================================================================== 
import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { SesionAcceso } from '../../interface/sesion-acceso.interface';

@Injectable({
  providedIn: 'root',
})
export class SesionService {
private readonly SESSION_KEY = 'examen_sesion_acceso';
  private readonly ID_KEY = 'examen_id_acceso';
  
  private sesionActual = new BehaviorSubject<any>(null);
  
  constructor() {
    // Cargar sesi贸n al iniciar
    this.cargarSesionDesdeStorage();
  }



  
  /**
   * Crear nueva sesi贸n de acceso
   */
  crearNuevaSesion(empresa?: any): string {
    const idAcceso = this.generarIdUnico();
    
    const sesion: SesionAcceso = {
      id: idAcceso,
      empresaId: empresa?.id || '',
      razonSocial: empresa?.razonSocial || '',
      estado: 'ACTIVO',
      fechaCreacion: new Date(),
      fechaExpiracion: this.calcularFechaExpiracion(),
      ultimoAcceso: new Date(),
      pasoActual: empresa ? 1 : 0, // Si ya tiene empresa, paso 1
      datosParciales: empresa ? { empresa } : {},
      ipOrigen: this.obtenerIP(),
      userAgent: navigator.userAgent
    };
    
    // Guardar en localStorage
    localStorage.setItem(this.SESSION_KEY, JSON.stringify(sesion));
    localStorage.setItem(this.ID_KEY, idAcceso);
    
    // Emitir cambios
    this.sesionActual.next(sesion);
    
    console.log(' Nueva sesi贸n creada:', idAcceso);
    return idAcceso;
  }


  // Agregar este m茅todo a tu SesionService existente
tienePermiso(permiso: string): boolean {
  //const usuario = this.getUsuarioActual(); // M茅todo que debes implementar
  //const permisos = usuario?.permisos || [];
  
  // En desarrollo, retornar true
  return true;
  
  // En producci贸n:
  // return permisos.includes(permiso) || permisos.includes('admin');
}

  /**
   * Recuperar sesi贸n por ID
   */
  recuperarSesion(idAcceso: string): boolean {
    const sesionGuardada = localStorage.getItem(this.SESSION_KEY);
    
    if (!sesionGuardada) {
      console.log(' No hay sesi贸n guardada');
      return false;
    }
    
    const sesion: SesionAcceso = JSON.parse(sesionGuardada);
    
    // Verificar que el ID coincida
    if (sesion.id !== idAcceso) {
      console.warn(' ID de acceso no coincide');
      return false;
    }
    
    // Verificar si no est谩 expirada
    if (this.sesionExpirada(sesion)) {
      console.warn(' Sesi贸n expirada');
      this.limpiarSesion();
      return false;
    }
    
    // Actualizar 煤ltimo acceso
    sesion.ultimoAcceso = new Date();
    this.guardarSesion(sesion);
    
    // Emitir cambios
    this.sesionActual.next(sesion);
    
    console.log(' Sesi贸n recuperada:', idAcceso);
    return true;
  }

  /**
   * Obtener sesi贸n actual
   */
  getSesionActual(): Observable<any> {
    return this.sesionActual.asObservable();
  }

  getSesionActualValue(): any {
    return this.sesionActual.value;
  }

  /**
   * Actualizar paso actual
   */
  actualizarPaso(paso: number, datos?: any): void {
    const sesion = this.sesionActual.value;
    
    if (sesion) {
      sesion.pasoActual = paso;
      sesion.ultimoAcceso = new Date();
      
      if (datos) {
        sesion.datosParciales = { ...sesion.datosParciales, ...datos };
      }
      
      this.guardarSesion(sesion);
      console.log(` Paso actualizado a ${paso}`);
    }
  }

  /**
   * Obtener ID de acceso actual
   */
  getIdAcceso(): string | null {
    return localStorage.getItem(this.ID_KEY);
  }

  /**
   * Limpiar sesi贸n
   */
  limpiarSesion(): void {
    localStorage.removeItem(this.SESSION_KEY);
    localStorage.removeItem(this.ID_KEY);
    this.sesionActual.next(null);
    console.log('Ч Sesi贸n limpiada');
  }

  /**
   * M茅todos privados
   */
  private generarIdUnico(): string {
    // Formato: EXM-XXXX-XXXX-XXXX
    const timestamp = Date.now().toString(36);
    const random = Math.random().toString(36).substring(2, 8);
    return `EXM-${timestamp}-${random}`.toUpperCase();
  }

  private calcularFechaExpiracion(): Date {
    const fecha = new Date();
    fecha.setDate(fecha.getDate() + 7); // Expira en 7 d铆as
    return fecha;
  }

  private sesionExpirada(sesion: SesionAcceso): boolean {
    return new Date(sesion.fechaExpiracion) < new Date();
  }

  private guardarSesion(sesion: SesionAcceso): void {
    localStorage.setItem(this.SESSION_KEY, JSON.stringify(sesion));
    this.sesionActual.next(sesion);
  }

  private cargarSesionDesdeStorage(): void {
    const sesionGuardada = localStorage.getItem(this.SESSION_KEY);
    if (sesionGuardada) {
      const sesion = JSON.parse(sesionGuardada);
      if (!this.sesionExpirada(sesion)) {
        this.sesionActual.next(sesion);
      } else {
        this.limpiarSesion();
      }
    }
  }

  private obtenerIP(): string {
    // En un entorno real, esto vendr铆a del backend
    return 'IP_NO_DISPONIBLE';
  }
}
..
============================================================================== 
ARCHIVO : src\app\core\service\storage.service.ts 
============================================================================== 
// core/services/storage.service.ts
import { Injectable } from '@angular/core';
import { ConfigService } from './config.service';

@Injectable({ providedIn: 'root' })
export class StorageService {
  constructor(private configService: ConfigService) {}

  // M茅todos gen茅ricos
  setItem<T>(key: string, value: T): void {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch (error) {
      console.error(`Error saving to localStorage (${key}):`, error);
    }
  }

  getItem<T>(key: string): T | null {
    try {
      const item = localStorage.getItem(key);
      return item ? JSON.parse(item) : null;
    } catch (error) {
      console.error(`Error reading from localStorage (${key}):`, error);
      return null;
    }
  }

  removeItem(key: string): void {
    localStorage.removeItem(key);
  }

  clear(): void {
    localStorage.clear();
  }

  // M茅todos espec铆ficos para la aplicaci贸n
  setEmpresaExamen(empresa: any): void {
    const empresaData = {
      ...empresa,
      fechaVerificacion: new Date().toISOString()
    };
    this.setItem(this.configService.storageKeys.empresaExamen, empresaData);
  }

  getEmpresaExamen(): any | null {
    const empresa = this.getItem<any>(this.configService.storageKeys.empresaExamen);
    if (!empresa) return null;

    // Verificar expiraci贸n
    const fechaVerificacion = new Date(empresa.fechaVerificacion);
    const ahora = new Date();
    const diferencia = ahora.getTime() - fechaVerificacion.getTime();
    
    if (diferencia > this.configService.timeouts.empresaCache) {
      this.removeItem(this.configService.storageKeys.empresaExamen);
      return null;
    }

    return empresa;
  }

  clearExamenData(): void {
    const keys = this.configService.storageKeys;
    this.removeItem(keys.empresaExamen);
    this.removeItem(keys.sesionAcceso);
    this.removeItem(keys.idAcceso);
  }
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\admin-citas\admin-citas.ts 
============================================================================== 
import { Component, OnInit, ViewChild, AfterViewInit, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Router, RouterModule } from '@angular/router';
import { FormsModule, ReactiveFormsModule, FormBuilder, FormGroup } from '@angular/forms';
import { MatTableModule, MatTableDataSource } from '@angular/material/table';
import { MatPaginatorModule, MatPaginator } from '@angular/material/paginator';
import { MatSortModule, MatSort } from '@angular/material/sort';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { MatDialogModule, MatDialog } from '@angular/material/dialog';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatInputModule } from '@angular/material/input';
import { MatSelectModule } from '@angular/material/select';
import { MatDatepickerModule } from '@angular/material/datepicker';
import { MatNativeDateModule } from '@angular/material/core';
import { MatProgressSpinnerModule } from '@angular/material/progress-spinner';
import { MatSnackBarModule, MatSnackBar } from '@angular/material/snack-bar';
import { MatTooltipModule } from '@angular/material/tooltip';
import { MatCheckboxModule } from '@angular/material/checkbox';
import { MatCardModule } from '@angular/material/card';
import { MatExpansionModule } from '@angular/material/expansion';
import { MatTabsModule } from '@angular/material/tabs';
import { MatBadgeModule } from '@angular/material/badge';
import { MatChipsModule } from '@angular/material/chips';
import { MatMenuModule } from '@angular/material/menu';
import { MatDividerModule } from '@angular/material/divider';
import { MatProgressBarModule } from '@angular/material/progress-bar';

import { SharedMaterialModule } from '../../../shared/modules/material.module';
import { AdminCitasService } from '../services/admin-citas.service';
import { SolicitudExamen, Asegurado } from '../models/admin-citas.interface';
import { VerDocumentosDialog } from '../components/ver-documentos-dialog/ver-documentos-dialog';
import { ObservarSolicitudDialog } from '../components/observar-citas-dialog/observar-citas-dialog';
import { ProgramarCitasDialog } from '../components/programar-citas-dialog/programar-citas-dialog';

import { AuthCnsService } from '../../../core/service/auth-cns.service'

@Component({
  selector: 'app-admin-citas',
  standalone: true,
  imports: [
    CommonModule,
    RouterModule,
    FormsModule,
    ReactiveFormsModule,
    SharedMaterialModule,
    MatTableModule,
    MatPaginatorModule,
    MatSortModule,
    MatButtonModule,
    MatIconModule,
    MatDialogModule,
    MatFormFieldModule,
    MatInputModule,
    MatSelectModule,
    MatDatepickerModule,
    MatNativeDateModule,
    MatProgressSpinnerModule,
    MatSnackBarModule,
    MatTooltipModule,
    MatCheckboxModule,
    MatCardModule,
    MatExpansionModule,
    MatTabsModule,
    MatBadgeModule,
    MatChipsModule,
    MatMenuModule,
    MatDividerModule,
    MatProgressBarModule
  ],
  templateUrl: './admin-citas.html',
  styleUrls: ['./admin-citas.css']
})
export class AdminCitas implements OnInit, AfterViewInit {
  
  @ViewChild(MatPaginator) paginator!: MatPaginator;
  @ViewChild(MatSort) sort!: MatSort;

  private readonly adminCitasService = inject(AdminCitasService);
  private readonly dialog = inject(MatDialog);
  private readonly snackBar = inject(MatSnackBar);
  private readonly fb = inject(FormBuilder);
  private readonly router = inject(Router);

  // Datos
  dataSource = new MatTableDataSource<SolicitudExamen>([]);
  displayedColumns: string[] = [
    'select',
    'id',
    'asegurado',
    'ci',
    'empresa',
    'estado',
    'fechaRegistro',
    'documentos',
    'acciones'
  ];
  selection = new Set<SolicitudExamen>();

  // Estados
  isLoading = false;
  tieneSesionActiva = false;
  usuarioActual: any = null;

  // Filtros
  estados = [
    { value: 'todos', label: 'Todos los estados', icon: 'all_inbox' },
    { value: 'pendiente', label: 'Pendiente', icon: 'pending_actions' },
    { value: 'observado', label: 'Observado', icon: 'visibility' },
    { value: 'aprobado', label: 'Aprobado', icon: 'check_circle' },
    { value: 'programado', label: 'Programado', icon: 'schedule' },
    { value: 'completado', label: 'Completado', icon: 'done_all' }
  ];

  // Formularios
  filtroForm: FormGroup;

  
  constructor() {
    this.filtroForm = this.fb.group({
      buscar: [''],
      estado: ['todos'],
      fechaDesde: [''],
      fechaHasta: ['']
    });
  }

  ngOnInit(): void {
    this.verificarSesion();
    this.inicializarUsuario();
    this.cargarSolicitudes();
    
  }

  ngAfterViewInit(): void {
    this.dataSource.paginator = this.paginator;
    this.dataSource.sort = this.sort;
    this.dataSource.filterPredicate = this.createFilter();
  }

  // ===== MTODOS DE SESIN =====

  /**
   * Verificar sesi贸n manualmente (soluci贸n temporal)
   */
  private verificarSesion(): void {
    // Verificar localStorage directamente
    const tieneEmpresa = !!localStorage.getItem('empresa_examen_preocupacional');
    const tieneSesion = !!localStorage.getItem('examen_sesion_acceso');
    const tieneIdAcceso = !!localStorage.getItem('examen_id_acceso');
    const tieneToken = !!localStorage.getItem('jwt_token');
    
    this.tieneSesionActiva = tieneEmpresa && tieneSesion && tieneIdAcceso && tieneToken;
    
    if (!this.tieneSesionActiva) {
      this.mostrarError('No tiene una sesi贸n activa. Redirigiendo al inicio...');
      
      // Redirigir despu茅s de 2 segundos
      setTimeout(() => {
        this.router.navigate(['/']);
      }, 2000);
    }
  }

  /**
   * Inicializar datos del usuario
   */
  private inicializarUsuario(): void {
    // Obtener datos del usuario desde localStorage
    const empresaStr = localStorage.getItem('empresa_examen_preocupacional');
    const sesionStr = localStorage.getItem('examen_sesion_acceso');
    const idAcceso = localStorage.getItem('examen_id_acceso');
    
    if (empresaStr && sesionStr && idAcceso) {
      try {
        const empresa = JSON.parse(empresaStr);
        const sesion = JSON.parse(sesionStr);
        
        this.usuarioActual = {
          empresa: empresa,
          sesion: sesion,
          idAcceso: idAcceso,
          nombre: empresa.razonSocial || 'Administrador',
          email: empresa.correoElectronico || 'admin@cns.gov.bo',
          roles: ['admin', 'administrador_citas'],
          permisos: ['ver_citas', 'aprobar_citas', 'programar_citas', 'administrar_citas']
        };
        
        console.log('Usuario inicializado:', this.usuarioActual);
      } catch (error) {
        console.error('Error al parsear datos de usuario:', error);
      }
    }
  }

  /**
   * Verificar permisos de administraci贸n
   */
  private verificarPermisos(): boolean {
    // Para desarrollo, asumimos que todos tienen permisos
    // En producci贸n, implementar l贸gica real de permisos
    if (!this.tieneSesionActiva) {
      return false;
    }
    
    // Verificar roles del usuario
    const tieneRolAdmin = this.usuarioActual?.roles?.includes('admin') || 
                         this.usuarioActual?.roles?.includes('administrador_citas');
    
    if (!tieneRolAdmin) {
      this.mostrarError('No tiene permisos para acceder a esta secci贸n');
      setTimeout(() => {
        this.router.navigate(['/']);
      }, 2000);
      return false;
    }
    
    return true;
  }

  /**
   * Cerrar sesi贸n del administrador
   */
  cerrarSesion(): void {
    if (confirm('驴Est谩 seguro de cerrar la sesi贸n de administraci贸n?')) {
      // Limpiar localStorage
      localStorage.removeItem('empresa_examen_preocupacional');
      localStorage.removeItem('examen_sesion_acceso');
      localStorage.removeItem('examen_id_acceso');
      localStorage.removeItem('jwt_token');
      
      this.tieneSesionActiva = false;
      this.usuarioActual = null;
      this.mostrarMensaje('Sesi贸n cerrada exitosamente');
      
      // Redirigir al home
      setTimeout(() => {
        this.router.navigate(['/']);
      }, 1500);
    }
  }

  // ===== MTODOS DE DATOS =====

  /**
   * Cargar solicitudes desde el servicio
   */
  cargarSolicitudes(): void {
    this.isLoading = true;
    
    // En producci贸n, usar servicio real
    // this.adminCitasService.getSolicitudes().subscribe({
    //   next: (solicitudes) => {
    //     this.dataSource.data = solicitudes;
    //     this.isLoading = false;
    //   },
    //   error: (error) => {
    //     console.error('Error al cargar solicitudes:', error);
    //     this.isLoading = false;
    //     this.mostrarError('Error al cargar las solicitudes');
    //   }
    // });

    // Datos mock para desarrollo
    setTimeout(() => {
      this.dataSource.data = this.adminCitasService.getSolicitudesMock();
      this.isLoading = false;
    }, 1000);
  }

  /**
   * Crear filtro personalizado para la tabla
   */
  createFilter(): (data: SolicitudExamen, filter: string) => boolean {
    return (data, filter) => {
      const searchTerms = JSON.parse(filter);
      
      // Buscar en texto
      const searchText = searchTerms.text?.toLowerCase() || '';
      const matchesSearch = !searchText || 
        this.getNombreAsegurado(data.asegurado).toLowerCase().includes(searchText) ||
        this.getCIAsegurado(data.asegurado).toLowerCase().includes(searchText) ||
        this.getEmpresaAsegurado(data.asegurado).toLowerCase().includes(searchText);

      // Filtrar por estado
      const matchesEstado = searchTerms.estado === 'todos' || data.estado === searchTerms.estado;

      // Filtrar por fecha
      const fechaRegistro = new Date(data.fechaRegistro);
      const matchesFechaDesde = !searchTerms.fechaDesde || fechaRegistro >= new Date(searchTerms.fechaDesde);
      const matchesFechaHasta = !searchTerms.fechaHasta || fechaRegistro <= new Date(searchTerms.fechaHasta);

      return matchesSearch && matchesEstado && matchesFechaDesde && matchesFechaHasta;
    };
  }

  /**
   * Aplicar filtros a la tabla
   */
  aplicarFiltro(): void {
    const filtro = {
      text: this.filtroForm.get('buscar')?.value || '',
      estado: this.filtroForm.get('estado')?.value,
      fechaDesde: this.filtroForm.get('fechaDesde')?.value,
      fechaHasta: this.filtroForm.get('fechaHasta')?.value
    };
    
    this.dataSource.filter = JSON.stringify(filtro);

    if (this.dataSource.paginator) {
      this.dataSource.paginator.firstPage();
    }
  }

  /**
   * Limpiar todos los filtros
   */
  limpiarFiltros(): void {
    this.filtroForm.reset({
      buscar: '',
      estado: 'todos',
      fechaDesde: '',
      fechaHasta: ''
    });
    this.aplicarFiltro();
  }

  // ===== MTODOS DE GESTIN DE SOLICITUDES =====

  /**
   * Ver documentos de una solicitud
   */
  verDocumentos(solicitud: SolicitudExamen): void {
    this.dialog.open(VerDocumentosDialog, {
      width: '900px',
      maxHeight: '90vh',
      data: { 
        documentos: solicitud.documentos,
        asegurado: solicitud.asegurado 
      }
    });
  }

  /**
   * Aprobar solicitud
   */
  aprobarSolicitud(solicitud: SolicitudExamen): void {
    if (confirm(`驴Est谩 seguro de aprobar la solicitud de ${this.getNombreAsegurado(solicitud.asegurado)}?`)) {
      this.isLoading = true;
      
      // En producci贸n, usar servicio real
      // this.adminCitasService.aprobarSolicitud(solicitud.id).subscribe({
      //   next: () => {
      //     this.actualizarSolicitudAprobada(solicitud);
      //     this.isLoading = false;
      //   },
      //   error: (error) => {
      //     console.error('Error al aprobar solicitud:', error);
      //     this.mostrarError('Error al aprobar la solicitud');
      //     this.isLoading = false;
      //   }
      // });

      // Mock
      setTimeout(() => {
        this.actualizarSolicitudAprobada(solicitud);
        this.isLoading = false;
      }, 1000);
    }
  }

  /**
   * Actualizar solicitud como aprobada
   */
  private actualizarSolicitudAprobada(solicitud: SolicitudExamen): void {
    solicitud.estado = 'aprobado';
    solicitud.fechaAprobacion = new Date();
    solicitud.observaciones = undefined;
    
    // Enviar email de aprobaci贸n
    this.enviarEmailAprobacion(solicitud);
    this.mostrarMensaje('Solicitud aprobada exitosamente');
  }

  /**
   * Observar solicitud
   */
  observarSolicitud(solicitud: SolicitudExamen): void {
    const dialogRef = this.dialog.open(ObservarSolicitudDialog, {
      width: '500px',
      data: { solicitud }
    });

    dialogRef.afterClosed().subscribe(observaciones => {
      if (observaciones) {
        this.isLoading = true;
        
        // En producci贸n, usar servicio real
        // this.adminCitasService.observarSolicitud(solicitud.id, observaciones).subscribe({
        //   next: () => {
        //     solicitud.estado = 'observado';
        //     solicitud.observaciones = observaciones;
        //     this.mostrarMensaje('Observaciones registradas');
        //     this.isLoading = false;
        //   },
        //   error: (error) => {
        //     console.error('Error al observar solicitud:', error);
        //     this.mostrarError('Error al registrar observaciones');
        //     this.isLoading = false;
        //   }
        // });

        // Mock
        setTimeout(() => {
          solicitud.estado = 'observado';
          solicitud.observaciones = observaciones;
          this.mostrarMensaje('Observaciones registradas');
          this.isLoading = false;
        }, 1000);
      }
    });
  }

  /**
   * Rechazar solicitud
   */
  rechazarSolicitud(solicitud: SolicitudExamen): void {
    const motivo = prompt('Ingrese el motivo del rechazo:');
    if (motivo) {
      this.isLoading = true;
      
      // Mock
      setTimeout(() => {
        solicitud.estado = 'observado';
        solicitud.observaciones = `Rechazado: ${motivo}`;
        this.mostrarMensaje('Solicitud rechazada');
        this.isLoading = false;
      }, 1000);
    }
  }

  /**
   * Enviar email de aprobaci贸n
   */
  enviarEmailAprobacion(solicitud: SolicitudExamen): void {
    console.log('Email de aprobaci贸n enviado a:', solicitud.asegurado.correoElectronico);
    this.mostrarMensaje('Email de aprobaci贸n enviado');
  }

  /**
   * Programar citas para una solicitud aprobada
   */
  programarCitas(solicitud: SolicitudExamen): void {
    const dialogRef = this.dialog.open(ProgramarCitasDialog, {
      width: '1000px',
      maxHeight: '90vh',
      data: { solicitud }
    });

    dialogRef.afterClosed().subscribe(result => {
      if (result) {
        solicitud.estado = 'programado';
        solicitud.fechaProgramacion = new Date();
        solicitud.citasProgramadas = result;
        this.mostrarMensaje('Citas programadas exitosamente');
      }
    });
  }

  /**
   * Ver citas programadas
   */
  verCitasProgramadas(solicitud: SolicitudExamen): void {
    if (solicitud.citasProgramadas && solicitud.citasProgramadas.length > 0) {
      const citasInfo = solicitud.citasProgramadas.map(cita => 
        ` ${this.getNombreServicio(cita.servicio)}: ${new Date(cita.fecha).toLocaleDateString()} ${cita.hora}`
      ).join('\n');
      
      alert(`Citas programadas para ${this.getNombreAsegurado(solicitud.asegurado)}:\n\n${citasInfo}`);
    } else {
      this.mostrarMensaje('No hay citas programadas para esta solicitud');
    }
  }

  // ===== MTODOS DE DATOS DEL ASEGURADO =====

  /**
   * Obtener nombre completo del asegurado
   */
  getNombreAsegurado(asegurado: Asegurado): string {
    if (asegurado.nombreCompleto) {
      return asegurado.nombreCompleto;
    }
    
    const nombreCompleto = [
      asegurado.paterno,
      asegurado.materno,
      asegurado.nombres
    ].filter(part => part && part.trim()).join(' ');
    
    return nombreCompleto || 'Asegurado';
  }

  /**
   * Obtener CI del asegurado
   */
  getCIAsegurado(asegurado: Asegurado): string {
    const ci = asegurado.documentoIdentidad || '';
    const extension = asegurado.extencion || '';
    
    if (extension) {
      return `${ci} ${extension}`.trim();
    }
    return ci;
  }

  /**
   * Obtener empresa del asegurado
   */
  getEmpresaAsegurado(asegurado: Asegurado): string {
    return asegurado.razonSocial || '';
  }

  /**
   * Obtener nombre del servicio
   */
  getNombreServicio(servicio: string): string {
    switch(servicio) {
      case 'laboratorio': return 'Laboratorio';
      case 'rayos_x': return 'Rayos X';
      case 'evaluacion_medica': return 'Evaluaci贸n M茅dica';
      default: return servicio;
    }
  }

  // ===== MTODOS DE UI/HELPERS =====

  /**
   * Obtener icono seg煤n estado
   */
  getEstadoIcon(estado: string): string {
    switch(estado) {
      case 'pendiente': return 'pending_actions';
      case 'observado': return 'visibility';
      case 'aprobado': return 'check_circle';
      case 'programado': return 'schedule';
      case 'completado': return 'done_all';
      default: return 'help';
    }
  }

  /**
   * Obtener clase CSS seg煤n estado
   */
  getEstadoColor(estado: string): string {
    switch(estado) {
      case 'pendiente': return 'estado-pendiente';
      case 'observado': return 'estado-observado';
      case 'aprobado': return 'estado-aprobado';
      case 'programado': return 'estado-programado';
      case 'completado': return 'estado-completado';
      default: return '';
    }
  }

  /**
   * Obtener etiqueta del estado
   */
  getEstadoLabel(estadoValue: string): string {
    const estado = this.estados.find(e => e.value === estadoValue);
    return estado ? estado.label : estadoValue;
  }

  /**
   * Obtener cantidad de documentos pendientes
   */
  getDocumentosPendientesCount(solicitud: SolicitudExamen): number {
    return solicitud.documentos.filter(doc => doc.estado === 'pendiente').length;
  }

  // ===== MTODOS DE SELECCIN =====

  /**
   * Alternar selecci贸n de una fila
   */
  toggleSeleccion(solicitud: SolicitudExamen): void {
    if (this.selection.has(solicitud)) {
      this.selection.delete(solicitud);
    } else {
      this.selection.add(solicitud);
    }
  }

  /**
   * Seleccionar todas las filas
   */
  seleccionarTodos(event: any): void {
    if (event.checked) {
      this.dataSource.filteredData.forEach(row => this.selection.add(row));
    } else {
      this.selection.clear();
    }
  }

  /**
   * Aprobar solicitudes seleccionadas
   */
  aprobarSeleccionados(): void {
    const seleccionados = Array.from(this.selection);
    if (seleccionados.length === 0) {
      this.mostrarError('Seleccione al menos una solicitud');
      return;
    }

    if (confirm(`驴Aprobar ${seleccionados.length} solicitud(es)?`)) {
      seleccionados.forEach(solicitud => {
        solicitud.estado = 'aprobado';
        solicitud.fechaAprobacion = new Date();
        this.enviarEmailAprobacion(solicitud);
      });
      this.mostrarMensaje(`${seleccionados.length} solicitud(es) aprobada(s)`);
      this.selection.clear();
    }
  }

  // ===== MTODOS DE EXPORTACIN =====

  /**
   * Exportar a Excel
   */
  exportarExcel(): void {
    this.mostrarMensaje('Exportando datos a Excel...');
    // Implementar l贸gica de exportaci贸n
  }

  /**
   * Exportar a PDF
   */
  exportarPDF(): void {
    this.mostrarMensaje('Generando reporte PDF...');
    // Implementar l贸gica de exportaci贸n PDF
  }

  // ===== MTODOS GETTER PARA TEMPLATE =====

  get totalSolicitudes(): number {
    return this.dataSource.data.length;
  }

  getSolicitudesPendientesCount(): number {
    return this.dataSource.data.filter(s => s.estado === 'pendiente').length;
  }

  getSolicitudesAprobadasCount(): number {
    return this.dataSource.data.filter(s => s.estado === 'aprobado').length;
  }

  getSolicitudesProgramadasCount(): number {
    return this.dataSource.data.filter(s => s.estado === 'programado').length;
  }

  getSolicitudesCompletadasCount(): number {
    return this.dataSource.data.filter(s => s.estado === 'completado').length;
  }

  get todasSeleccionadas(): boolean {
    return this.selection.size > 0 && 
           this.selection.size === this.dataSource.filteredData.length;
  }

  get seleccionadosParcialmente(): boolean {
    return this.selection.size > 0 && 
           this.selection.size < this.dataSource.filteredData.length;
  }

  getFechaActual(): Date {
    return new Date();
  }

  get fechaActual(): Date {
    return this.getFechaActual();
  }

  // ===== MTODOS DE NOTIFICACIN =====

  /**
   * Mostrar mensaje de 茅xito
   */
  mostrarMensaje(mensaje: string): void {
    this.snackBar.open(mensaje, 'Cerrar', {
      duration: 3000,
      panelClass: ['snackbar-success']
    });
  }

  /**
   * Mostrar mensaje de error
   */
  mostrarError(mensaje: string): void {
    this.snackBar.open(mensaje, 'Cerrar', {
      duration: 3000,
      panelClass: ['snackbar-error']
    });
  }

  /**
   * Obtener estad铆sticas
   */
  getEstadisticas(): any {
    return {
      total: this.totalSolicitudes,
      pendientes: this.getSolicitudesPendientesCount(),
      aprobadas: this.getSolicitudesAprobadasCount(),
      programadas: this.getSolicitudesProgramadasCount(),
      completadas: this.getSolicitudesCompletadasCount()
    };
  }
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\admin-citas\admin-citas.html 
============================================================================== 
<div class="admin-citas-container">
  <!-- Header Principal -->
  <div class="admin-header">
    <div class="header-content">
      <h1 class="header-title">
        <mat-icon class="header-icon">schedule</mat-icon>
        Administraci贸n de Reservas de Citas
      </h1>
      <p class="header-subtitle">
        Gesti贸n y validaci贸n de documentaci贸n para Ex谩menes Preocupacionales
      </p>
    </div>
    
    <!-- Estad铆sticas -->
    <div class="header-stats">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon total">
            <mat-icon>description</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{totalSolicitudes}}</h3>
            <p>Total Solicitudes</p>
          </div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon pending">
            <mat-icon>pending_actions</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{getSolicitudesPendientesCount()}}</h3>
            <p>Pendientes</p>
          </div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon approved">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{getSolicitudesAprobadasCount()}}</h3>
            <p>Aprobadas</p>
          </div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon scheduled">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{getSolicitudesProgramadasCount()}}</h3>
            <p>Programadas</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Panel de Filtros -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="filtroForm" (ngSubmit)="aplicarFiltro()" class="filters-form">
        <div class="filters-row">
          <!-- B煤squeda -->
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Buscar por nombre, CI o empresa</mat-label>
            <input matInput formControlName="buscar" 
                   placeholder="Ej: Juan P茅rez, 1234567, Empresa ABC">
            <mat-icon matSuffix>search</mat-icon>
            <mat-hint>Presione Enter para buscar</mat-hint>
          </mat-form-field>

          <!-- Estado -->
          <mat-form-field appearance="outline" class="status-field">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="estado">
              <mat-option *ngFor="let estado of estados" [value]="estado.value">
                <div class="estado-option">
                  <mat-icon>{{estado.icon}}</mat-icon>
                  <span>{{estado.label}}</span>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Fecha desde -->
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Fecha desde</mat-label>
            <input matInput [matDatepicker]="pickerDesde" formControlName="fechaDesde">
            <mat-datepicker-toggle matSuffix [for]="pickerDesde"></mat-datepicker-toggle>
            <mat-datepicker #pickerDesde></mat-datepicker>
          </mat-form-field>

          <!-- Fecha hasta -->
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Fecha hasta</mat-label>
            <input matInput [matDatepicker]="pickerHasta" formControlName="fechaHasta">
            <mat-datepicker-toggle matSuffix [for]="pickerHasta"></mat-datepicker-toggle>
            <mat-datepicker #pickerHasta></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="filter-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="isLoading">
            <mat-icon>filter_alt</mat-icon>
            Aplicar Filtros
          </button>
          <button mat-button type="button" (click)="limpiarFiltros()" [disabled]="isLoading">
            <mat-icon>clear</mat-icon>
            Limpiar
          </button>
          <button mat-button type="button" (click)="exportarExcel()" [disabled]="isLoading">
            <mat-icon>download</mat-icon>
            Exportar Excel
          </button>
          <button mat-button type="button" (click)="exportarPDF()" [disabled]="isLoading">
            <mat-icon>picture_as_pdf</mat-icon>
            Exportar PDF
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Acciones en Lote -->
  <div *ngIf="selection.size > 0" class="batch-actions">
    <mat-card>
      <mat-card-content>
        <div class="batch-info">
          <div class="batch-selection">
            <mat-icon>check_circle</mat-icon>
            <span>{{selection.size}} solicitud(es) seleccionada(s)</span>
          </div>
          <div class="batch-buttons">
            <button mat-raised-button color="primary" (click)="aprobarSeleccionados()">
              <mat-icon>check_circle</mat-icon>
              Aprobar Seleccionadas
            </button>
            <button mat-stroked-button color="warn" (click)="selection.clear()">
              <mat-icon>clear</mat-icon>
              Cancelar Selecci贸n
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Tabla de Solicitudes -->
  <mat-card class="table-card">
    <mat-card-content>
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="50" class="loading-spinner"></mat-spinner>
        <p>Cargando solicitudes...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && dataSource.filteredData.length === 0" class="no-data">
        <mat-icon>folder_open</mat-icon>
        <h3>No hay solicitudes para mostrar</h3>
        <p *ngIf="dataSource.filter">Intenta con otros criterios de b煤squeda</p>
        <p *ngIf="!dataSource.filter">No se han registrado solicitudes a煤n</p>
      </div>

      <!-- Tabla de Datos -->
      <div *ngIf="!isLoading && dataSource.filteredData.length > 0" class="table-container">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0">
          
          <!-- Columna Checkbox -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox
                [checked]="todasSeleccionadas"
                [indeterminate]="seleccionadosParcialmente"
                (change)="seleccionarTodos($event)">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox
                [checked]="selection.has(row)"
                (change)="toggleSeleccion(row)">
              </mat-checkbox>
            </td>
          </ng-container>

          <!-- Columna ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
            <td mat-cell *matCellDef="let solicitud">
              <span class="solicitud-id">#{{solicitud.id}}</span>
            </td>
          </ng-container>

          <!-- Columna Asegurado -->
          <ng-container matColumnDef="asegurado">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Asegurado</th>
            <td mat-cell *matCellDef="let solicitud">
              <div class="asegurado-info">
                <strong>{{getNombreAsegurado(solicitud.asegurado)}}</strong>
                <div class="contacto-info" *ngIf="solicitud.asegurado.correoElectronico">
                  <mat-icon class="small-icon">email</mat-icon>
                  {{solicitud.asegurado.correoElectronico}}
                </div>
                <div class="contacto-info" *ngIf="solicitud.asegurado.celular">
                  <mat-icon class="small-icon">phone</mat-icon>
                  {{solicitud.asegurado.celular}}
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Columna CI -->
          <ng-container matColumnDef="ci">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>C.I.</th>
            <td mat-cell *matCellDef="let solicitud">
              <div class="ci-info">
                {{getCIAsegurado(solicitud.asegurado)}}
                <span *ngIf="solicitud.asegurado.extencion" class="ci-extension">
                  {{solicitud.asegurado.extencion}}
                </span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Empresa -->
          <ng-container matColumnDef="empresa">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Empresa</th>
            <td mat-cell *matCellDef="let solicitud">
              <div class="empresa-info">
                {{getEmpresaAsegurado(solicitud.asegurado)}}
                <small *ngIf="solicitud.asegurado.nroPatronal">Pat: {{solicitud.asegurado.nroPatronal}}</small>
                <small *ngIf="solicitud.asegurado.matricula">Mat: {{solicitud.asegurado.matricula}}</small>
              </div>
            </td>
          </ng-container>

          <!-- Columna Estado -->
          <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
            <td mat-cell *matCellDef="let solicitud">
              <div class="estado-container">
                <span class="estado-badge" [ngClass]="getEstadoColor(solicitud.estado)">
                  <mat-icon class="badge-icon">{{getEstadoIcon(solicitud.estado)}}</mat-icon>
                  {{solicitud.estado | titlecase}}
                </span>
                <div *ngIf="solicitud.fechaAprobacion" class="fecha-aprobacion">
                  Aprobado: {{solicitud.fechaAprobacion | date:'dd/MM/yyyy'}}
                </div>
                <div *ngIf="solicitud.fechaProgramacion" class="fecha-programacion">
                  Programado: {{solicitud.fechaProgramacion | date:'dd/MM/yyyy'}}
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Columna Fecha Registro -->
          <ng-container matColumnDef="fechaRegistro">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Registro</th>
            <td mat-cell *matCellDef="let solicitud">
              {{solicitud.fechaRegistro | date:'dd/MM/yyyy HH:mm'}}
            </td>
          </ng-container>

          <!-- Columna Documentos -->
          <ng-container matColumnDef="documentos">
            <th mat-header-cell *matHeaderCellDef>Documentos</th>
            <td mat-cell *matCellDef="let solicitud">
              <div class="documentos-info">
                <div class="documentos-badge" (click)="verDocumentos(solicitud)" matTooltip="Ver documentos">
                  <mat-icon>folder_open</mat-icon>
                  <span>{{solicitud.documentos.length}} docs</span>
                  <span *ngIf="getDocumentosPendientesCount(solicitud) > 0" class="pendientes-count">
                    ({{getDocumentosPendientesCount(solicitud)}} pendientes)
                  </span>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Columna Acciones -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let solicitud">
              <div class="acciones-cell">
                <!-- Men煤 de acciones -->
                <button mat-icon-button [matMenuTriggerFor]="menuAcciones" 
                        matTooltip="M谩s acciones">
                  <mat-icon>more_vert</mat-icon>
                </button>
                
                <mat-menu #menuAcciones="matMenu">
                  <!-- Ver documentos -->
                  <button mat-menu-item (click)="verDocumentos(solicitud)">
                    <mat-icon>folder_open</mat-icon>
                    <span>Ver Documentos</span>
                  </button>

                  <mat-divider></mat-divider>

                  <!-- Acciones seg煤n estado -->
                  <ng-container *ngIf="solicitud.estado === 'pendiente'">
                    <button mat-menu-item (click)="aprobarSolicitud(solicitud)" class="action-aprobar">
                      <mat-icon>check_circle</mat-icon>
                      <span>Aprobar Solicitud</span>
                    </button>
                    <button mat-menu-item (click)="observarSolicitud(solicitud)" class="action-observar">
                      <mat-icon>visibility</mat-icon>
                      <span>Observar Solicitud</span>
                    </button>
                    <button mat-menu-item (click)="rechazarSolicitud(solicitud)" class="action-rechazar">
                      <mat-icon>close</mat-icon>
                      <span>Rechazar Solicitud</span>
                    </button>
                  </ng-container>

                  <ng-container *ngIf="solicitud.estado === 'aprobado'">
                    <button mat-menu-item (click)="programarCitas(solicitud)" class="action-programar">
                      <mat-icon>schedule</mat-icon>
                      <span>Programar Citas</span>
                    </button>
                    <button mat-menu-item (click)="observarSolicitud(solicitud)" class="action-observar">
                      <mat-icon>visibility</mat-icon>
                      <span>Regresar a Observado</span>
                    </button>
                  </ng-container>

                  <ng-container *ngIf="solicitud.estado === 'programado'">
                    <button mat-menu-item (click)="verCitasProgramadas(solicitud)" class="action-ver">
                      <mat-icon>calendar_today</mat-icon>
                      <span>Ver Citas Programadas</span>
                    </button>
                    <button mat-menu-item (click)="programarCitas(solicitud)" class="action-reprogramar">
                      <mat-icon>edit_calendar</mat-icon>
                      <span>Reprogramar Citas</span>
                    </button>
                  </ng-container>

                  <ng-container *ngIf="solicitud.estado === 'observado'">
                    <button mat-menu-item (click)="aprobarSolicitud(solicitud)" class="action-aprobar">
                      <mat-icon>check_circle</mat-icon>
                      <span>Aprobar Solicitud</span>
                    </button>
                    <button mat-menu-item (click)="observarSolicitud(solicitud)" class="action-editar">
                      <mat-icon>edit</mat-icon>
                      <span>Editar Observaciones</span>
                    </button>
                  </ng-container>

                  <mat-divider></mat-divider>

                  <!-- Acciones comunes -->
                  <button mat-menu-item (click)="enviarEmailAprobacion(solicitud)" 
                          *ngIf="solicitud.estado === 'aprobado' || solicitud.estado === 'programado'">
                    <mat-icon>email</mat-icon>
                    <span>Reenviar Email</span>
                  </button>
                  
                  <button mat-menu-item (click)="verCitasProgramadas(solicitud)" 
                          *ngIf="solicitud.citasProgramadas && solicitud.citasProgramadas.length > 0">
                    <mat-icon>calendar_today</mat-icon>
                    <span>Ver Citas ({{solicitud.citasProgramadas.length}})</span>
                  </button>
                </mat-menu>

                <!-- Botones de acci贸n r谩pida -->
                <div class="acciones-rapidas" *ngIf="solicitud.estado === 'pendiente'">
                  <button mat-mini-fab color="primary" (click)="aprobarSolicitud(solicitud)" 
                          matTooltip="Aprobar" class="btn-rapido">
                    <mat-icon>check</mat-icon>
                  </button>
                  <button mat-mini-fab color="accent" (click)="observarSolicitud(solicitud)" 
                          matTooltip="Observar" class="btn-rapido">
                    <mat-icon>visibility</mat-icon>
                  </button>
                </div>

                <div class="acciones-rapidas" *ngIf="solicitud.estado === 'aprobado'">
                  <button mat-mini-fab color="primary" (click)="programarCitas(solicitud)" 
                          matTooltip="Programar Citas" class="btn-rapido">
                    <mat-icon>schedule</mat-icon>
                  </button>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Header Row -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          
          <!-- Data Row -->
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
              [class.selected-row]="selection.has(row)"
              (click)="toggleSeleccion(row)">
          </tr>
        </table>

        <!-- Paginador -->
        <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" 
                       showFirstLastButtons 
                       aria-label="Seleccione p谩gina de solicitudes"
                       class="custom-paginator">
        </mat-paginator>

        <!-- Informaci贸n de resultados -->
        <div class="results-info">
          <div class="results-count">
            Mostrando {{dataSource.filteredData.length}} de {{totalSolicitudes}} solicitudes
          </div>
          <div class="results-filters" *ngIf="dataSource.filter">
            <mat-chip-set>
              <mat-chip *ngIf="filtroForm.get('buscar')?.value" 
                       [removable]="true" (removed)="filtroForm.get('buscar')?.setValue(''); aplicarFiltro()">
                Buscar: "{{filtroForm.get('buscar')?.value}}"
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <mat-chip *ngIf="filtroForm.get('estado')?.value !== 'todos'"
                       [removable]="true" (removed)="filtroForm.get('estado')?.setValue('todos'); aplicarFiltro()">
                Estado: {{getEstadoLabel(filtroForm.get('estado')?.value)}}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <mat-chip *ngIf="filtroForm.get('fechaDesde')?.value"
                       [removable]="true" (removed)="filtroForm.get('fechaDesde')?.setValue(''); aplicarFiltro()">
                Desde: {{filtroForm.get('fechaDesde')?.value | date:'dd/MM/yyyy'}}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <mat-chip *ngIf="filtroForm.get('fechaHasta')?.value"
                       [removable]="true" (removed)="filtroForm.get('fechaHasta')?.setValue(''); aplicarFiltro()">
                Hasta: {{filtroForm.get('fechaHasta')?.value | date:'dd/MM/yyyy'}}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Gu铆a R谩pida -->
  <mat-card class="quick-guide-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>help</mat-icon>
        Gu铆a R谩pida de Estados
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="guide-grid">
        <div class="guide-item">
          <span class="estado-badge estado-pendiente">
            <mat-icon class="badge-icon">pending_actions</mat-icon>
            Pendiente
          </span>
          <p>Documentaci贸n en revisi贸n. Puede aprobar, observar o rechazar.</p>
        </div>
        <div class="guide-item">
          <span class="estado-badge estado-observado">
            <mat-icon class="badge-icon">visibility</mat-icon>
            Observado
          </span>
          <p>Documentaci贸n requiere correcciones. Puede aprobar despu茅s de correcciones.</p>
        </div>
        <div class="guide-item">
          <span class="estado-badge estado-aprobado">
            <mat-icon class="badge-icon">check_circle</mat-icon>
            Aprobado
          </span>
          <p>Documentaci贸n aprobada. Puede programar citas m茅dicas.</p>
        </div>
        <div class="guide-item">
          <span class="estado-badge estado-programado">
            <mat-icon class="badge-icon">schedule</mat-icon>
            Programado
          </span>
          <p>Citas m茅dicas asignadas. Puede ver o reprogramar citas.</p>
        </div>
        <div class="guide-item">
          <span class="estado-badge estado-completado">
            <mat-icon class="badge-icon">done_all</mat-icon>
            Completado
          </span>
          <p>Ex谩menes m茅dicos completados. Proceso finalizado.</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Footer con Informaci贸n -->
  <div class="footer-info">
    <mat-card>
      <mat-card-content>
        <div class="footer-content">
          <div class="footer-section">
            <h4>
              <mat-icon>info</mat-icon>
              Informaci贸n del Sistema
            </h4>
            <p>ltima actualizaci贸n: {{fechaActual | date:'dd/MM/yyyy HH:mm'}}</p>
            <p>Total de solicitudes procesadas: {{totalSolicitudes}}</p>
          </div>
          <div class="footer-section">
            <h4>
              <mat-icon>support_agent</mat-icon>
              Soporte
            </h4>
            <p>Para asistencia t茅cnica contacte al 谩rea de sistemas</p>
            <p>Email: soporte.sistemas@cns.gov.bo</p>
          </div>
          <div class="footer-section">
            <h4>
              <mat-icon>security</mat-icon>
              Seguridad
            </h4>
            <p>Sesi贸n activa: {{tieneSesionActiva ? 'S铆' : 'No'}}</p>
            <button mat-button (click)="cerrarSesion()" *ngIf="tieneSesionActiva">
              <mat-icon>logout</mat-icon>
              Cerrar Sesi贸n
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\admin-citas\admin-citas.css 
============================================================================== 
.admin-citas-container {
  padding: 20px;
  background: #f5f5f5;
  min-height: 100vh;
}

/* Header */
.admin-header {
  margin-bottom: 30px;
}

.header-content {
  margin-bottom: 20px;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 15px;
  color: #2e7d32;
  margin-bottom: 10px;
}

.header-icon {
  font-size: 36px;
  width: 36px;
  height: 36px;
  color: #4caf50;
}

.header-subtitle {
  color: #666;
  font-size: 1.1rem;
}

.header-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.stat-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

.stat-card mat-card-content {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 20px;
}

.stat-icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.stat-icon.pending {
  background: #fff3e0;
  color: #f57c00;
}

.stat-icon.total {
  background: #e8f5e9;
  color: #4caf50;
}

.stat-info h3 {
  margin: 0;
  font-size: 2rem;
  color: #333;
}

.stat-info p {
  margin: 5px 0 0 0;
  color: #666;
}

/* Filtros */
.filters-card {
  margin-bottom: 20px;
  background: white;
}

.filters-form {
  padding: 10px;
}

.filters-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.search-field {
  flex: 2;
}

.filter-actions {
  display: flex;
  gap: 15px;
  justify-content: flex-end;
}

/* Acciones en lote */
.batch-actions {
  margin-bottom: 20px;
}

.batch-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
}

.batch-buttons {
  display: flex;
  gap: 10px;
}

/* Tabla */
.table-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

.table-container {
  overflow-x: auto;
}

table {
  width: 100%;
}

th.mat-header-cell {
  background: #f5f5f5;
  font-weight: 600;
  color: #333;
  padding: 16px;
}

td.mat-cell {
  padding: 12px 16px;
  border-bottom: 1px solid #f0f0f0;
}

tr.mat-row:hover {
  background: #f9f9f9;
}

/* Estados */
.estado-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
}

.estado-badge.pendiente {
  background: #fff3e0;
  color: #f57c00;
}

.estado-badge.observado {
  background: #e3f2fd;
  color: #1976d2;
}

.estado-badge.aprobado {
  background: #e8f5e9;
  color: #4caf50;
}

.estado-badge.programado {
  background: #f3e5f5;
  color: #7b1fa2;
}

.estado-badge.completado {
  background: #e8eaf6;
  color: #3f51b5;
}

.badge-icon {
  font-size: 16px;
  width: 16px;
  height: 16px;
}

/* Informaci贸n del asegurado */
.asegurado-info strong {
  display: block;
  margin-bottom: 4px;
}

.contacto-info {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.85rem;
  color: #666;
}

.small-icon {
  font-size: 16px;
  width: 16px;
  height: 16px;
}

/* Empresa */
.empresa-info small {
  display: block;
  color: #888;
  font-size: 0.85rem;
  margin-top: 4px;
}

/* Documentos */
.documentos-info {
  display: flex;
  align-items: center;
  gap: 10px;
}

.documentos-badge {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: #e3f2fd;
  border-radius: 12px;
  font-size: 0.8rem;
  color: #1976d2;
}

/* Acciones */
.acciones-cell {
  display: flex;
  gap: 8px;
}

.action-button {
  min-width: auto;
  padding: 4px 8px;
}

/* Loading */
.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
}

.loading-spinner {
  color: #4caf50;
}

/* Responsive */
@media (max-width: 768px) {
  .admin-citas-container {
    padding: 10px;
  }
  
  .filters-row {
    grid-template-columns: 1fr;
  }
  
  .batch-info {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .batch-buttons {
    justify-content: center;
  }
  
  .header-stats {
    grid-template-columns: 1fr;
  }
}

/* Fecha aprobaci贸n */
.fecha-aprobacion {
  font-size: 0.75rem;
  color: #888;
  margin-top: 4px;
}

/* Solicitud ID */
.solicitud-id {
  font-weight: 600;
  color: #2e7d32;
  background: #e8f5e9;
  padding: 4px 8px;
  border-radius: 4px;
}

/* No data */
.no-data {
  text-align: center;
  padding: 40px;
  color: #888;
}

.no-data mat-icon {
  font-size: 48px;
  width: 48px;
  height: 48px;
  margin-bottom: 20px;
  opacity: 0.5;
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\login-admin\login-admin.ts 
============================================================================== 
// features/admin-citas/components/login-admin/login-admin.ts
import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthCnsService } from '../../../../core/service/auth-cns.service';

@Component({
  selector: 'app-login-admin',
  templateUrl: './login-admin.html',
  styleUrls: ['./login-admin.css']
})
export class LoginAdmin {
  username = '';
  password = '';
  isLoading = false;
  errorMessage = '';
  
  constructor(
    private authService: AuthCnsService,
    private router: Router
  ) {}
  
  login(): void {
    this.isLoading = true;
    this.errorMessage = '';
    
    this.authService.login(this.username, this.password).subscribe({
      next: () => {
        // Verificar si es admin despu茅s del login
        if (this.authService.isAdmin() || this.authService.hasPermission('administrar_citas')) {
          this.router.navigate(['/admin-citas']);
        } else {
          this.errorMessage = 'No tiene permisos para acceder al sistema de citas';
          this.authService.logout();
        }
        this.isLoading = false;
      },
      error: (error) => {
        this.errorMessage = 'Credenciales incorrectas o error de conexi贸n';
        console.error('Error en login:', error);
        this.isLoading = false;
      }
    });
  }
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\login-admin\login-admin.html 
============================================================================== 
<p>login-admin works!</p>
..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\login-admin\login-admin.css 
============================================================================== 
..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\observar-citas-dialog\observar-citas-dialog.ts 
============================================================================== 
import { Component, Inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { MAT_DIALOG_DATA, MatDialogModule, MatDialogRef } from '@angular/material/dialog';
import { MatButtonModule } from '@angular/material/button';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatInputModule } from '@angular/material/input';
import { MatIconModule } from '@angular/material/icon';

import { SolicitudExamen } from '../../models/admin-citas.interface';

@Component({
  selector: 'app-observar-solicitud-dialog',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    MatDialogModule,
    MatButtonModule,
    MatFormFieldModule,
    MatInputModule,
    MatIconModule
  ],
  templateUrl: './observar-citas-dialog.html',
  styleUrls: ['./observar-citas-dialog.css']
})
export class ObservarSolicitudDialog {
  observaciones: string = '';
  solicitud: SolicitudExamen;

  constructor(
    public dialogRef: MatDialogRef<ObservarSolicitudDialog>,
    @Inject(MAT_DIALOG_DATA) public data: any
  ) {
    this.solicitud = data.solicitud;
    if (this.solicitud.observaciones) {
      this.observaciones = this.solicitud.observaciones;
    }
  }

  guardar(): void {
    if (this.observaciones.trim()) {
      this.dialogRef.close(this.observaciones);
    }
  }

  cancelar(): void {
    this.dialogRef.close();
  }
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\observar-citas-dialog\observar-citas-dialog.html 
============================================================================== 
<h2 mat-dialog-title>
  <mat-icon>feedback</mat-icon>
  Registrar Observaciones
</h2>

<mat-dialog-content>
  <div class="solicitud-info">
    <h4>Solicitud #{{solicitud.id}}</h4>
    <p><strong>Asegurado:</strong> {{solicitud.asegurado.nombres}} {{solicitud.asegurado.nombreCompleto}}</p>   
    <p><strong>C.I.:</strong> {{solicitud.asegurado.documentoIdentidad}}</p>
  </div>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Observaciones</mat-label>
    <textarea matInput [(ngModel)]="observaciones" 
              placeholder="Ingrese las observaciones sobre la documentaci贸n..."
              rows="8"></textarea>
    <mat-hint>Describa los problemas encontrados en la documentaci贸n</mat-hint>
  </mat-form-field>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancelar()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="guardar()" [disabled]="!observaciones.trim()">
    <mat-icon>save</mat-icon>
    Guardar Observaciones
  </button>
</mat-dialog-actions>..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\observar-citas-dialog\observar-citas-dialog.css 
============================================================================== 
..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\programar-citas-dialog\programar-citas-dialog.ts 
============================================================================== 
import { Component, Inject, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { MAT_DIALOG_DATA, MatDialogModule, MatDialogRef } from '@angular/material/dialog';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { MatCardModule } from '@angular/material/card';
import { MatTabsModule } from '@angular/material/tabs';
import { MatDatepickerModule } from '@angular/material/datepicker';
import { MatNativeDateModule } from '@angular/material/core';
import { MatSelectModule } from '@angular/material/select';
import { MatRadioModule } from '@angular/material/radio';
import { MatListModule } from '@angular/material/list';

import { SolicitudExamen, HorarioDisponible, Cita } from '../../models/admin-citas.interface';
import { AdminCitasService } from '../../services/admin-citas.service';

@Component({
  selector: 'app-programar-citas-dialog',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    MatDialogModule,
    MatButtonModule,
    MatIconModule,
    MatCardModule,
    MatTabsModule,
    MatDatepickerModule,
    MatNativeDateModule,
    MatSelectModule,
    MatRadioModule,
    MatListModule
  ],
  templateUrl: './programar-citas-dialog.html',
  styleUrls: ['./programar-citas-dialog.css']
})
export class ProgramarCitasDialog implements OnInit {
  solicitud: SolicitudExamen;
  horarios: HorarioDisponible[] = [];
  citasSeleccionadas: Cita[] = [];
  
  servicios = [
    { id: 'laboratorio', nombre: 'Laboratorio', icono: 'science' },
    { id: 'rayos_x', nombre: 'Rayos X', icono: 'scatter_plot' },
    { id: 'evaluacion_medica', nombre: 'Evaluaci贸n M茅dica', icono: 'medical_services' }
  ];

  constructor(
    public dialogRef: MatDialogRef<ProgramarCitasDialog>,
    @Inject(MAT_DIALOG_DATA) public data: any,
    private adminCitasService: AdminCitasService
  ) {
    this.solicitud = data.solicitud;
  }

  ngOnInit(): void {
    this.cargarHorarios();
  }

  cargarHorarios(): void {
    // En producci贸n, usar servicio real
    // this.adminCitasService.getHorariosDisponibles().subscribe({
    //   next: (horarios) => {
    //     this.horarios = horarios;
    //   },
    //   error: (error) => {
    //     console.error('Error al cargar horarios:', error);
    //   }
    // });

    // Datos mock
    this.horarios = [
      {
        id: 1,
        servicio: 'laboratorio',
        fecha: new Date('2024-01-25'),
        horaInicio: '08:00',
        horaFin: '08:30',
        cuposDisponibles: 5,
        cuposTotales: 10
      },
      {
        id: 2,
        servicio: 'laboratorio',
        fecha: new Date('2024-01-25'),
        horaInicio: '08:30',
        horaFin: '09:00',
        cuposDisponibles: 3,
        cuposTotales: 10
      },
      {
        id: 3,
        servicio: 'rayos_x',
        fecha: new Date('2024-01-25'),
        horaInicio: '09:00',
        horaFin: '09:30',
        cuposDisponibles: 8,
        cuposTotales: 10
      },
      {
        id: 4,
        servicio: 'evaluacion_medica',
        fecha: new Date('2024-01-25'),
        horaInicio: '10:00',
        horaFin: '10:30',
        cuposDisponibles: 4,
        cuposTotales: 10
      }
    ];
  }

  getHorariosPorServicio(servicio: string): HorarioDisponible[] {
    return this.horarios.filter(h => h.servicio === servicio && h.cuposDisponibles > 0);
  }

  seleccionarCita(servicio: string, horario: HorarioDisponible): void {
    // Remover cita existente para el mismo servicio
    this.citasSeleccionadas = this.citasSeleccionadas.filter(c => c.servicio !== servicio);
    
    // Agregar nueva cita
    const nuevaCita: Cita = {
      solicitudId: this.solicitud.id,
      servicio: servicio as any,
      fecha: horario.fecha,
      hora: horario.horaInicio,
      duracion: 30,
      estado: 'confirmada'
    };
    
    this.citasSeleccionadas.push(nuevaCita);
  }

  getCitaSeleccionada(servicio: string): Cita | undefined {
    return this.citasSeleccionadas.find(c => c.servicio === servicio);
  }

  getHorariosLaboratorio(): HorarioDisponible[] {
  return this.horarios.filter(h => h.servicio === 'laboratorio' && h.cuposDisponibles > 0);
}

getHorariosRayosX(): HorarioDisponible[] {
  return this.horarios.filter(h => h.servicio === 'rayos_x' && h.cuposDisponibles > 0);
}

getHorariosEvaluacion(): HorarioDisponible[] {
  return this.horarios.filter(h => h.servicio === 'evaluacion_medica' && h.cuposDisponibles > 0);
}

getNombreServicio(servicio: string): string {
  const servicioObj = this.servicios.find(s => s.id === servicio);
  return servicioObj ? servicioObj.nombre : servicio;
}

getIconoServicio(servicio: string): string {
  const servicioObj = this.servicios.find(s => s.id === servicio);
  return servicioObj ? servicioObj.icono : 'help';
}


  todasCitasSeleccionadas(): boolean {
    return this.citasSeleccionadas.length === this.servicios.length;
  }

  programar(): void {
    if (this.todasCitasSeleccionadas()) {
      this.dialogRef.close(this.citasSeleccionadas);
    } else {
      alert('Debe seleccionar horarios para todos los servicios');
    }
  }

  cancelar(): void {
    this.dialogRef.close();
  }

  filtrarPorFecha(servicio: string, fecha: Date): void {
  console.log(`Filtrando ${servicio} por fecha:`, fecha);
  // Implementar l贸gica de filtrado
}

mostrarMasFechas(servicio: string): void {
  console.log(`Mostrando m谩s fechas para: ${servicio}`);
  // Implementar l贸gica para cargar m谩s fechas
}

deseleccionarCita(servicio: string): void {
  this.citasSeleccionadas = this.citasSeleccionadas.filter(c => c.servicio !== servicio);
}

getEstadoServicio(servicio: string): string {
  return servicio; // Retorna el nombre del servicio para usar como clase CSS
}

getDuracionServicio(servicio: string): number {
  switch(servicio) {
    case 'laboratorio': return 30;
    case 'rayos_x': return 20;
    case 'evaluacion_medica': return 45;
    default: return 30;
  }
}
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\programar-citas-dialog\programar-citas-dialog.html 
============================================================================== 
<h2 mat-dialog-title>
  <mat-icon>schedule</mat-icon>
  Programar Citas para Examen Preocupacional
</h2>

<mat-dialog-content>
  <div class="solicitud-info">
    <h3>{{solicitud.asegurado.nombres}} {{solicitud.asegurado.nombreCompleto}}</h3>
    <p><strong>C.I.:</strong> {{solicitud.asegurado.documentoIdentidad}} | <strong>Empresa:</strong> {{solicitud.asegurado.razonSocial}}</p>
    <p><strong>Email:</strong> {{solicitud.asegurado.correoElectronico}} | <strong>Tel茅fono:</strong> {{solicitud.asegurado.celular}}</p>
  </div>

  <div class="citas-progreso">
    <div class="pasos">
      <div class="paso" [class.completado]="getCitaSeleccionada('laboratorio')">
        <div class="paso-numero">1</div>
        <div class="paso-texto">Laboratorio</div>
      </div>
      <div class="paso" [class.completado]="getCitaSeleccionada('rayos_x')">
        <div class="paso-numero">2</div>
        <div class="paso-texto">Rayos X</div>
      </div>
      <div class="paso" [class.completado]="getCitaSeleccionada('evaluacion_medica')">
        <div class="paso-numero">3</div>
        <div class="paso-texto">Evaluaci贸n M茅dica</div>
      </div>
    </div>
  </div>

  <mat-tab-group animationDuration="0ms">
    <!-- Tab 1: Laboratorio -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>science</mat-icon>
        Laboratorio
        <mat-icon class="tab-status-icon" *ngIf="getCitaSeleccionada('laboratorio')">check_circle</mat-icon>
      </ng-template>
      
      <div class="servicio-tab">
        <div class="tab-header">
          <h4>
            <mat-icon>science</mat-icon>
            Seleccione horario para Ex谩menes de Laboratorio
          </h4>
          <p class="tab-description">
            An谩lisis de sangre, orina y otros ex谩menes complementarios.
            Duraci贸n aproximada: 30 minutos.
          </p>
        </div>
        
        <div *ngIf="getCitaSeleccionada('laboratorio')" class="cita-seleccionada">
          <mat-card class="seleccion-card">
            <mat-card-content>
              <div class="seleccion-header">
                <mat-icon class="seleccion-icon">check_circle</mat-icon>
                <div>
                  <h5>Horario seleccionado para Laboratorio:</h5>
                  <div class="horario-detalle">
                    <span class="fecha">{{getCitaSeleccionada('laboratorio')?.fecha | date:'EEEE dd/MM/yyyy'}}</span>
                    <span class="hora">{{getCitaSeleccionada('laboratorio')?.hora}}</span>
                    <button mat-button color="warn" (click)="deseleccionarCita('laboratorio')">
                      <mat-icon>close</mat-icon>
                      Cambiar
                    </button>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="horarios-disponibles">
          <div class="filtro-fecha">
            <mat-form-field appearance="outline">
              <mat-label>Filtrar por fecha</mat-label>
              <input matInput [matDatepicker]="pickerLab" (dateChange)="filtrarPorFecha('laboratorio', $event.value)">
              <mat-datepicker-toggle matSuffix [for]="pickerLab"></mat-datepicker-toggle>
              <mat-datepicker #pickerLab></mat-datepicker>
            </mat-form-field>
          </div>

          <h5>Horarios disponibles para Laboratorio:</h5>
          <div *ngIf="getHorariosLaboratorio().length === 0" class="no-horarios">
            <mat-icon>event_busy</mat-icon>
            <p>No hay horarios disponibles para la fecha seleccionada</p>
            <button mat-button (click)="mostrarMasFechas('laboratorio')">
              <mat-icon>calendar_today</mat-icon>
              Ver m谩s fechas
            </button>
          </div>

          <div class="horarios-grid" *ngIf="getHorariosLaboratorio().length > 0">
            <mat-card *ngFor="let horario of getHorariosLaboratorio()" 
                     class="horario-card"
                     [class.selected]="getCitaSeleccionada('laboratorio')?.hora === horario.horaInicio"
                     (click)="seleccionarCita('laboratorio', horario)">
              <mat-card-content>
                <div class="horario-info">
                  <mat-icon class="horario-icon">access_time</mat-icon>
                  <div class="horario-details">
                    <strong class="hora">{{horario.horaInicio}} - {{horario.horaFin}}</strong>
                    <span class="fecha">{{horario.fecha | date:'dd/MM/yyyy'}}</span>
                    <span class="duracion">Duraci贸n: 30 min</span>
                  </div>
                </div>
                <div class="cupos-info">
                  <span class="cupos" [class.pocos]="horario.cuposDisponibles < 3" 
                        [class.agotado]="horario.cuposDisponibles === 0">
                    <mat-icon>people</mat-icon>
                    {{horario.cuposDisponibles}}/{{horario.cuposTotales}}
                  </span>
                  <button mat-button color="primary" class="btn-seleccionar"
                          *ngIf="getCitaSeleccionada('laboratorio')?.hora !== horario.horaInicio">
                    Seleccionar
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- Tab 2: Rayos X -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>scatter_plot</mat-icon>
        Rayos X
        <mat-icon class="tab-status-icon" *ngIf="getCitaSeleccionada('rayos_x')">check_circle</mat-icon>
      </ng-template>
      
      <div class="servicio-tab">
        <div class="tab-header">
          <h4>
            <mat-icon>scatter_plot</mat-icon>
            Seleccione horario para Rayos X
          </h4>
          <p class="tab-description">
            Radiograf铆as tor谩cicas y otros estudios radiol贸gicos.
            Duraci贸n aproximada: 20 minutos.
          </p>
        </div>
        
        <div *ngIf="getCitaSeleccionada('rayos_x')" class="cita-seleccionada">
          <mat-card class="seleccion-card">
            <mat-card-content>
              <div class="seleccion-header">
                <mat-icon class="seleccion-icon">check_circle</mat-icon>
                <div>
                  <h5>Horario seleccionado para Rayos X:</h5>
                  <div class="horario-detalle">
                    <span class="fecha">{{getCitaSeleccionada('rayos_x')?.fecha | date:'EEEE dd/MM/yyyy'}}</span>
                    <span class="hora">{{getCitaSeleccionada('rayos_x')?.hora}}</span>
                    <button mat-button color="warn" (click)="deseleccionarCita('rayos_x')">
                      <mat-icon>close</mat-icon>
                      Cambiar
                    </button>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="horarios-disponibles">
          <div class="filtro-fecha">
            <mat-form-field appearance="outline">
              <mat-label>Filtrar por fecha</mat-label>
              <input matInput [matDatepicker]="pickerRayos" (dateChange)="filtrarPorFecha('rayos_x', $event.value)">
              <mat-datepicker-toggle matSuffix [for]="pickerRayos"></mat-datepicker-toggle>
              <mat-datepicker #pickerRayos></mat-datepicker>
            </mat-form-field>
          </div>

          <h5>Horarios disponibles para Rayos X:</h5>
          <div *ngIf="getHorariosRayosX().length === 0" class="no-horarios">
            <mat-icon>event_busy</mat-icon>
            <p>No hay horarios disponibles para la fecha seleccionada</p>
            <button mat-button (click)="mostrarMasFechas('rayos_x')">
              <mat-icon>calendar_today</mat-icon>
              Ver m谩s fechas
            </button>
          </div>

          <div class="horarios-grid" *ngIf="getHorariosRayosX().length > 0">
            <mat-card *ngFor="let horario of getHorariosRayosX()" 
                     class="horario-card"
                     [class.selected]="getCitaSeleccionada('rayos_x')?.hora === horario.horaInicio"
                     (click)="seleccionarCita('rayos_x', horario)">
              <mat-card-content>
                <div class="horario-info">
                  <mat-icon class="horario-icon">access_time</mat-icon>
                  <div class="horario-details">
                    <strong class="hora">{{horario.horaInicio}} - {{horario.horaFin}}</strong>
                    <span class="fecha">{{horario.fecha | date:'dd/MM/yyyy'}}</span>
                    <span class="duracion">Duraci贸n: 20 min</span>
                  </div>
                </div>
                <div class="cupos-info">
                  <span class="cupos" [class.pocos]="horario.cuposDisponibles < 3" 
                        [class.agotado]="horario.cuposDisponibles === 0">
                    <mat-icon>people</mat-icon>
                    {{horario.cuposDisponibles}}/{{horario.cuposTotales}}
                  </span>
                  <button mat-button color="primary" class="btn-seleccionar"
                          *ngIf="getCitaSeleccionada('rayos_x')?.hora !== horario.horaInicio">
                    Seleccionar
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- Tab 3: Evaluaci贸n M茅dica -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>medical_services</mat-icon>
        Evaluaci贸n M茅dica
        <mat-icon class="tab-status-icon" *ngIf="getCitaSeleccionada('evaluacion_medica')">check_circle</mat-icon>
      </ng-template>
      
      <div class="servicio-tab">
        <div class="tab-header">
          <h4>
            <mat-icon>medical_services</mat-icon>
            Seleccione horario para Evaluaci贸n M茅dica
          </h4>
          <p class="tab-description">
            Consulta m茅dica ocupacional, evaluaci贸n f铆sica y diagn贸stico.
            Duraci贸n aproximada: 45 minutos.
          </p>
        </div>
        
        <div *ngIf="getCitaSeleccionada('evaluacion_medica')" class="cita-seleccionada">
          <mat-card class="seleccion-card">
            <mat-card-content>
              <div class="seleccion-header">
                <mat-icon class="seleccion-icon">check_circle</mat-icon>
                <div>
                  <h5>Horario seleccionado para Evaluaci贸n M茅dica:</h5>
                  <div class="horario-detalle">
                    <span class="fecha">{{getCitaSeleccionada('evaluacion_medica')?.fecha | date:'EEEE dd/MM/yyyy'}}</span>
                    <span class="hora">{{getCitaSeleccionada('evaluacion_medica')?.hora}}</span>
                    <button mat-button color="warn" (click)="deseleccionarCita('evaluacion_medica')">
                      <mat-icon>close</mat-icon>
                      Cambiar
                    </button>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="horarios-disponibles">
          <div class="filtro-fecha">
            <mat-form-field appearance="outline">
              <mat-label>Filtrar por fecha</mat-label>
              <input matInput [matDatepicker]="pickerEvaluacion" (dateChange)="filtrarPorFecha('evaluacion_medica', $event.value)">
              <mat-datepicker-toggle matSuffix [for]="pickerEvaluacion"></mat-datepicker-toggle>
              <mat-datepicker #pickerEvaluacion></mat-datepicker>
            </mat-form-field>
          </div>

          <h5>Horarios disponibles para Evaluaci贸n M茅dica:</h5>
          <div *ngIf="getHorariosEvaluacion().length === 0" class="no-horarios">
            <mat-icon>event_busy</mat-icon>
            <p>No hay horarios disponibles para la fecha seleccionada</p>
            <button mat-button (click)="mostrarMasFechas('evaluacion_medica')">
              <mat-icon>calendar_today</mat-icon>
              Ver m谩s fechas
            </button>
          </div>

          <div class="horarios-grid" *ngIf="getHorariosEvaluacion().length > 0">
            <mat-card *ngFor="let horario of getHorariosEvaluacion()" 
                     class="horario-card"
                     [class.selected]="getCitaSeleccionada('evaluacion_medica')?.hora === horario.horaInicio"
                     (click)="seleccionarCita('evaluacion_medica', horario)">
              <mat-card-content>
                <div class="horario-info">
                  <mat-icon class="horario-icon">access_time</mat-icon>
                  <div class="horario-details">
                    <strong class="hora">{{horario.horaInicio}} - {{horario.horaFin}}</strong>
                    <span class="fecha">{{horario.fecha | date:'dd/MM/yyyy'}}</span>
                    <span class="duracion">Duraci贸n: 45 min</span>
                  </div>
                </div>
                <div class="cupos-info">
                  <span class="cupos" [class.pocos]="horario.cuposDisponibles < 3" 
                        [class.agotado]="horario.cuposDisponibles === 0">
                    <mat-icon>people</mat-icon>
                    {{horario.cuposDisponibles}}/{{horario.cuposTotales}}
                  </span>
                  <button mat-button color="primary" class="btn-seleccionar"
                          *ngIf="getCitaSeleccionada('evaluacion_medica')?.hora !== horario.horaInicio">
                    Seleccionar
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>

  <div class="resumen-citas" *ngIf="citasSeleccionadas.length > 0">
    <h4>
      <mat-icon>list_alt</mat-icon>
      Resumen de Citas Seleccionadas
    </h4>
    <mat-card class="resumen-card">
      <mat-card-content>
        <mat-list class="resumen-list">
          <mat-list-item *ngFor="let cita of citasSeleccionadas" class="resumen-item">
            <mat-icon matListItemIcon [class]="getEstadoServicio(cita.servicio)">
              {{getIconoServicio(cita.servicio)}}
            </mat-icon>
            <div matListItemTitle class="servicio-nombre">{{getNombreServicio(cita.servicio)}}</div>
            <div matListItemLine class="servicio-detalle">
              <span class="servicio-fecha">{{cita.fecha | date:'dd/MM/yyyy'}}</span>
              <span class="servicio-hora">{{cita.hora}}</span>
              <span class="servicio-duracion">{{getDuracionServicio(cita.servicio)}} min</span>
            </div>
            <button mat-icon-button color="warn" (click)="deseleccionarCita(cita.servicio)">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-list-item>
        </mat-list>
        
        <div class="resumen-total">
          <div class="total-info">
            <span>Total de servicios:</span>
            <strong>{{citasSeleccionadas.length}}/3</strong>
          </div>
          <div class="completado-info" *ngIf="todasCitasSeleccionadas()">
            <mat-icon class="completado-icon">check_circle</mat-icon>
            <span>隆Todos los servicios han sido programados!</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <div class="dialog-actions">
    <button mat-button (click)="cancelar()">
      <mat-icon>close</mat-icon>
      Cancelar
    </button>
    <button mat-button (click)="programar()" [disabled]="!todasCitasSeleccionadas()"
            matTooltip="Debe seleccionar horarios para todos los servicios"
            matTooltipPosition="above">
      <mat-icon>send</mat-icon>
      Enviar Confirmaci贸n por Email
    </button>
    <button mat-raised-button color="primary" (click)="programar()" 
            [disabled]="!todasCitasSeleccionadas()">
      <mat-icon>save</mat-icon>
      Confirmar Programaci贸n
    </button>
  </div>
</mat-dialog-actions>..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\programar-citas-dialog\programar-citas-dialog.css 
============================================================================== 
/* Estilos del di谩logo */
.mat-dialog-content {
  max-height: 70vh;
  min-width: 900px;
  padding: 20px 24px !important;
}

/* Informaci贸n de la solicitud */
.solicitud-info {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 24px;
  border-left: 4px solid #4caf50;
}

.solicitud-info h3 {
  margin: 0 0 10px 0;
  color: #1b5e20;
  font-size: 1.4rem;
  font-weight: 600;
}

.solicitud-info p {
  margin: 6px 0;
  color: #388e3c;
  font-size: 0.95rem;
}

.solicitud-info strong {
  color: #1b5e20;
  font-weight: 600;
}

/* Progreso de citas */
.citas-progreso {
  margin-bottom: 30px;
}

.pasos {
  display: flex;
  justify-content: space-between;
  position: relative;
}

.pasos::before {
  content: '';
  position: absolute;
  top: 25px;
  left: 10%;
  right: 10%;
  height: 2px;
  background: #e0e0e0;
  z-index: 1;
}

.paso {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  z-index: 2;
  flex: 1;
}

.paso.completado .paso-numero {
  background: #4caf50;
  color: white;
}

.paso.completado .paso-texto {
  color: #4caf50;
  font-weight: 600;
}

.paso-numero {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #e0e0e0;
  color: #757575;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.2rem;
  margin-bottom: 10px;
  border: 3px solid white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.paso-texto {
  color: #757575;
  font-size: 0.9rem;
  text-align: center;
  max-width: 100px;
}

/* Tabs */
.mat-tab-group {
  margin-bottom: 30px;
}

.mat-tab-label {
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;
  min-width: 180px !important;
  opacity: 1 !important;
}

.tab-status-icon {
  font-size: 18px !important;
  width: 18px !important;
  height: 18px !important;
  color: #4caf50 !important;
}

/* Contenido de los tabs */
.servicio-tab {
  padding: 20px;
}

.tab-header {
  margin-bottom: 25px;
}

.tab-header h4 {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #1b5e20;
  margin: 0 0 10px 0;
  font-size: 1.3rem;
}

.tab-header mat-icon {
  color: #4caf50;
}

.tab-description {
  color: #666;
  font-size: 0.95rem;
  line-height: 1.5;
  margin: 0;
}

/* Cita seleccionada */
.cita-seleccionada {
  margin-bottom: 25px;
}

.seleccion-card {
  background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e9 100%);
  border: 2px solid #4caf50;
}

.seleccion-header {
  display: flex;
  align-items: center;
  gap: 20px;
}

.seleccion-icon {
  font-size: 36px !important;
  width: 36px !important;
  height: 36px !important;
  color: #4caf50;
}

.seleccion-header h5 {
  margin: 0 0 10px 0;
  color: #1b5e20;
  font-size: 1.1rem;
}

.horario-detalle {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.fecha {
  background: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: 500;
  color: #1b5e20;
  border: 1px solid #c8e6c9;
}

.hora {
  background: #4caf50;
  color: white;
  padding: 6px 16px;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1.1rem;
}

/* Filtro de fecha */
.filtro-fecha {
  margin-bottom: 20px;
}

.filtro-fecha mat-form-field {
  width: 250px;
}

/* Sin horarios */
.no-horarios {
  text-align: center;
  padding: 40px;
  background: #f8f9fa;
  border-radius: 12px;
  border: 2px dashed #dee2e6;
}

.no-horarios mat-icon {
  font-size: 48px;
  width: 48px;
  height: 48px;
  color: #adb5bd;
  margin-bottom: 15px;
}

.no-horarios p {
  color: #6c757d;
  margin-bottom: 20px;
  font-size: 1rem;
}

/* Grid de horarios */
.horarios-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.horario-card {
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid transparent;
}

.horario-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
  border-color: #c8e6c9;
}

.horario-card.selected {
  border-color: #4caf50;
  background: #f1f8e9;
}

.horario-card .mat-card-content {
  padding: 20px !important;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Informaci贸n del horario */
.horario-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

.horario-icon {
  font-size: 28px !important;
  width: 28px !important;
  height: 28px !important;
  color: #4caf50;
}

.horario-details {
  display: flex;
  flex-direction: column;
}

.hora {
  font-size: 1.1rem;
  color: #1b5e20;
  font-weight: 600;
}

.fecha {
  font-size: 0.9rem;
  color: #666;
  margin: 4px 0;
}

.duracion {
  font-size: 0.85rem;
  color: #888;
  background: #f5f5f5;
  padding: 2px 8px;
  border-radius: 4px;
  display: inline-block;
  width: fit-content;
}

/* Informaci贸n de cupos */
.cupos-info {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

.cupos {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
  background: #e3f2fd;
  color: #1976d2;
}

.cupos.pocos {
  background: #fff3e0;
  color: #f57c00;
}

.cupos.agotado {
  background: #ffebee;
  color: #f44336;
}

.cupos mat-icon {
  font-size: 16px !important;
  width: 16px !important;
  height: 16px !important;
}

.btn-seleccionar {
  padding: 4px 16px !important;
  font-size: 0.85rem !important;
  min-width: auto !important;
}

/* Resumen de citas */
.resumen-citas {
  margin-top: 30px;
}

.resumen-citas h4 {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #1b5e20;
  margin-bottom: 15px;
  font-size: 1.2rem;
}

.resumen-card {
  border-left: 4px solid #4caf50;
}

.resumen-list {
  padding: 0;
}

.resumen-item {
  height: 70px !important;
  border-bottom: 1px solid #f0f0f0;
}

.resumen-item:last-child {
  border-bottom: none;
}

.resumen-item mat-icon[matListItemIcon] {
  width: 40px !important;
  height: 40px !important;
  font-size: 24px !important;
  display: flex !important;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.resumen-item mat-icon.laboratorio {
  background: #e3f2fd;
  color: #1976d2;
}

.resumen-item mat-icon.rayos_x {
  background: #f3e5f5;
  color: #7b1fa2;
}

.resumen-item mat-icon.evaluacion_medica {
  background: #e8f5e9;
  color: #4caf50;
}

.servicio-nombre {
  font-weight: 600;
  color: #333;
}

.servicio-detalle {
  display: flex;
  gap: 15px;
  margin-top: 5px;
}

.servicio-fecha, .servicio-hora, .servicio-duracion {
  background: #f5f5f5;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.85rem;
  color: #666;
}

.resumen-total {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid #f0f0f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.total-info {
  display: flex;
  gap: 10px;
  align-items: center;
}

.total-info span {
  color: #666;
}

.total-info strong {
  color: #1b5e20;
  font-size: 1.2rem;
}

.completado-info {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #4caf50;
  font-weight: 500;
}

.completado-icon {
  color: #4caf50;
}

/* Acciones del di谩logo */
.dialog-actions {
  display: flex;
  gap: 15px;
  align-items: center;
  width: 100%;
  justify-content: flex-end;
}

/* Responsive */
@media (max-width: 1000px) {
  .mat-dialog-content {
    min-width: auto;
  }
  
  .horarios-grid {
    grid-template-columns: 1fr;
  }
  
  .pasos {
    flex-direction: column;
    gap: 20px;
    align-items: flex-start;
  }
  
  .pasos::before {
    display: none;
  }
  
  .paso {
    flex-direction: row;
    gap: 15px;
    width: 100%;
  }
  
  .paso-numero {
    margin-bottom: 0;
  }
}

@media (max-width: 600px) {
  .horario-detalle {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .servicio-detalle {
    flex-direction: column;
    gap: 5px;
  }
  
  .dialog-actions {
    flex-direction: column;
    gap: 10px;
    align-items: stretch;
  }
  
  .dialog-actions button {
    width: 100%;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\ver-documentos-dialog\ver-documentos-dialog.ts 
============================================================================== 
import { Component, Inject, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { MAT_DIALOG_DATA, MatDialogModule, MatDialogRef } from '@angular/material/dialog';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { MatTabsModule } from '@angular/material/tabs';
import { MatCardModule } from '@angular/material/card';
import { MatChipsModule } from '@angular/material/chips';
import { DatePipe } from '@angular/common';

import { Documento, Asegurado } from '../../models/admin-citas.interface';
@Component({
  selector: 'app-ver-documentos-dialog',
  standalone: true,
  imports: [
    CommonModule,
    MatDialogModule,
    MatButtonModule,
    MatIconModule,
    MatTabsModule,
    MatCardModule,
    MatChipsModule
  ],
  providers: [DatePipe],
  templateUrl: './ver-documentos-dialog.html',
  styleUrls: ['./ver-documentos-dialog.css']
})
export class VerDocumentosDialog implements OnInit {
  documentos: Documento[];
  documentosPendientes: Documento[] = [];
  documentosAprobados: Documento[] = [];
  documentosRechazados: Documento[] = [];
  asegurado: Asegurado;

  constructor(
    public dialogRef: MatDialogRef<VerDocumentosDialog>,
    @Inject(MAT_DIALOG_DATA) public data: any,
    private datePipe: DatePipe
  ) {
    this.documentos = data.documentos;
    this.asegurado = data.asegurado;
  }

  ngOnInit(): void {
    this.filtrarDocumentos();
  }

  private filtrarDocumentos(): void {
    this.documentosPendientes = this.documentos.filter(d => d.estado === 'pendiente');
    this.documentosAprobados = this.documentos.filter(d => d.estado === 'aprobado');
    this.documentosRechazados = this.documentos.filter(d => d.estado === 'rechazado');
  }

  // M茅todos para obtener datos del asegurado seg煤n tu interfaz
  getNombreCompleto(): string {
    // Si existe nombreCompleto calculado, usarlo
    if (this.asegurado.nombreCompleto) {
      return this.asegurado.nombreCompleto;
    }
    
    // Construir nombre completo a partir de paterno, materno y nombres
    const nombreCompleto = [
      this.asegurado.paterno,
      this.asegurado.materno,
      this.asegurado.nombres
    ].filter(part => part && part.trim()).join(' ');
    
    return nombreCompleto || 'Asegurado';
  }

  getCI(): string {
    // Usar documentoIdentidad con extensi贸n si existe
    const ci = this.asegurado.documentoIdentidad || '';
    const extension = this.asegurado.extencion || '';
    const complemento = this.asegurado.complemento || '';
    
    if (extension) {
      return `${ci} ${extension} ${complemento}`.trim();
    }
    return ci || 'No disponible';
  }

  getEmpresa(): string {
    return this.asegurado.razonSocial || 'No disponible';
  }

  getEmail(): string {
    return this.asegurado.correoElectronico || 'No disponible';
  }

  getTelefono(): string {
    return this.asegurado.celular || 'No disponible';
  }

  getMatricula(): string {
    return this.asegurado.matricula || 'No disponible';
  }

  getEstadoAsegurado(): string {
    return this.asegurado.estadoAsegurado || 'No disponible';
  }

  getFechaNacimiento(): string {
    return this.asegurado.fechaNacimiento || 'No disponible';
  }

  getFechaNacimientoFormateada(): string {
    if (!this.asegurado.fechaNacimiento) return 'No disponible';
    
    try {
      // Intentar formatear la fecha
      const fecha = new Date(this.asegurado.fechaNacimiento);
      return this.datePipe.transform(fecha, 'dd/MM/yyyy') || this.asegurado.fechaNacimiento;
    } catch {
      return this.asegurado.fechaNacimiento;
    }
  }

  getTipoDocumento(tipo: string): string {
    switch(tipo) {
      case 'recibo': return 'Recibo de Pago';
      case 'gestora_anverso': return 'Gestora (Anverso)';
      case 'gestora_reverso': return 'Gestora (Reverso)';
      default: return 'Otro Documento';
    }
  }

  getIconoTipo(tipo: string): string {
    switch(tipo) {
      case 'recibo': return 'receipt';
      case 'gestora_anverso': return 'description';
      case 'gestora_reverso': return 'description';
      default: return 'attach_file';
    }
  }

  getEstadoColor(estado: string): string {
    switch(estado) {
      case 'aprobado': return 'aprobado';
      case 'pendiente': return 'pendiente';
      case 'rechazado': return 'rechazado';
      default: return '';
    }
  }

  getTextoEstado(estado: string): string {
    switch(estado) {
      case 'aprobado': return 'Aprobado';
      case 'pendiente': return 'Pendiente';
      case 'rechazado': return 'Rechazado';
      default: return estado;
    }
  }

  verDocumento(url: string): void {
    window.open(url, '_blank');
  }

  aprobarDocumento(documento: Documento): void {
    documento.estado = 'aprobado';
    this.filtrarDocumentos();
  }

  rechazarDocumento(documento: Documento): void {
    documento.estado = 'rechazado';
    this.filtrarDocumentos();
  }

  marcarComoPendiente(documento: Documento): void {
    documento.estado = 'pendiente';
    this.filtrarDocumentos();
  }

  getTotalDocumentos(): number {
    return this.documentos.length;
  }

  getDocumentosPendientesCount(): number {
    return this.documentosPendientes.length;
  }

  tieneDocumentosPendientes(): boolean {
    return this.documentosPendientes.length > 0;
  }

  cerrar(): void {
    this.dialogRef.close();
  }

  guardarCambios(): void {
    this.dialogRef.close(this.documentos);
  }
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\ver-documentos-dialog\ver-documentos-dialog.html 
============================================================================== 
<h2 mat-dialog-title>
  <mat-icon>folder_open</mat-icon>
  Documentos del Asegurado
</h2>

<mat-dialog-content>
  <div class="asegurado-info">
    <h3>{{getNombreCompleto()}}</h3>
    <div class="info-grid">
      <div class="info-item">
        <strong>C.I.:</strong> {{getCI()}}
      </div>
      <div class="info-item">
        <strong>Matr铆cula:</strong> {{getMatricula()}}
      </div>
      <div class="info-item">
        <strong>Empresa:</strong> {{getEmpresa()}}
      </div>
      <div class="info-item">
        <strong>N掳 Patronal:</strong> {{asegurado.nroPatronal || 'No disponible'}}
      </div>
      <div class="info-item">
        <strong>Email:</strong> {{getEmail()}}
      </div>
      <div class="info-item">
        <strong>Tel茅fono:</strong> {{getTelefono()}}
      </div>
      <div class="info-item">
        <strong>Fecha Nacimiento:</strong> {{getFechaNacimientoFormateada()}}
      </div>
      <div class="info-item">
        <strong>Estado:</strong> {{getEstadoAsegurado()}}
      </div>
      <div class="info-item">
        <strong>G茅nero:</strong> {{asegurado.genero || 'No disponible'}}
      </div>
      <div class="info-item">
        <strong>Tipo Asegurado:</strong> {{asegurado.tipoAsegurado || 'No disponible'}}
      </div>
    </div>
    
    <div class="estado-documentos">
      <span class="badge total">Total Documentos: {{getTotalDocumentos()}}</span>
      <span class="badge pendiente" *ngIf="getDocumentosPendientesCount() > 0">
        Pendientes: {{getDocumentosPendientesCount()}}
      </span>
    </div>
  </div>

  <mat-tab-group>
    <mat-tab label="Todos los Documentos">
      <div class="documentos-grid">
        <mat-card *ngFor="let documento of documentos" class="documento-card">
          <mat-card-header>
            <mat-icon mat-card-avatar class="documento-icon" [class]="getEstadoColor(documento.estado)">
              {{getIconoTipo(documento.tipo)}}
            </mat-icon>
            <mat-card-title>{{getTipoDocumento(documento.tipo)}}</mat-card-title>
            <mat-card-subtitle>
              Subido: {{documento.fechaCarga | date:'dd/MM/yyyy HH:mm'}}
            </mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <p class="nombre-archivo">{{documento.nombreArchivo}}</p>
            <mat-chip-set>
              <mat-chip [class]="getEstadoColor(documento.estado)">
                {{getTextoEstado(documento.estado)}}
              </mat-chip>
            </mat-chip-set>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button color="primary" (click)="verDocumento(documento.url)">
              <mat-icon>visibility</mat-icon>
              Ver
            </button>
            <button mat-button color="accent" (click)="aprobarDocumento(documento)" 
                    *ngIf="documento.estado !== 'aprobado'">
              <mat-icon>check</mat-icon>
              Aprobar
            </button>
            <button mat-button color="warn" (click)="rechazarDocumento(documento)"
                    *ngIf="documento.estado !== 'rechazado'">
              <mat-icon>close</mat-icon>
              Rechazar
            </button>
            <button mat-button (click)="marcarComoPendiente(documento)"
                    *ngIf="documento.estado !== 'pendiente'">
              <mat-icon>pending</mat-icon>
              Marcar Pendiente
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>
    
    <mat-tab label="Documentos Pendientes">
      <div *ngIf="!tieneDocumentosPendientes()" class="no-documents">
        <mat-icon>check_circle</mat-icon>
        <p>No hay documentos pendientes</p>
      </div>
      <div class="documentos-grid">
        <mat-card *ngFor="let documento of documentosPendientes" 
                 class="documento-card pendiente">
          <mat-card-header>
            <mat-icon mat-card-avatar class="documento-icon pendiente">
              {{getIconoTipo(documento.tipo)}}
            </mat-icon>
            <mat-card-title>{{getTipoDocumento(documento.tipo)}}</mat-card-title>
            <mat-card-subtitle>
              Subido: {{documento.fechaCarga | date:'dd/MM/yyyy HH:mm'}}
            </mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <p class="nombre-archivo">{{documento.nombreArchivo}}</p>
            <mat-chip-set>
              <mat-chip class="pendiente">
                {{getTextoEstado(documento.estado)}}
              </mat-chip>
            </mat-chip-set>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button color="primary" (click)="verDocumento(documento.url)">
              <mat-icon>visibility</mat-icon>
              Ver
            </button>
            <button mat-button color="accent" (click)="aprobarDocumento(documento)">
              <mat-icon>check</mat-icon>
              Aprobar
            </button>
            <button mat-button color="warn" (click)="rechazarDocumento(documento)">
              <mat-icon>close</mat-icon>
              Rechazar
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>
    
    <mat-tab label="Documentos Aprobados">
      <div *ngIf="documentosAprobados.length === 0" class="no-documents">
        <mat-icon>folder_open</mat-icon>
        <p>No hay documentos aprobados</p>
      </div>
      <div class="documentos-grid">
        <mat-card *ngFor="let documento of documentosAprobados" 
                 class="documento-card aprobado">
          <mat-card-header>
            <mat-icon mat-card-avatar class="documento-icon aprobado">
              {{getIconoTipo(documento.tipo)}}
            </mat-icon>
            <mat-card-title>{{getTipoDocumento(documento.tipo)}}</mat-card-title>
            <mat-card-subtitle>
              Subido: {{documento.fechaCarga | date:'dd/MM/yyyy HH:mm'}}
            </mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <p class="nombre-archivo">{{documento.nombreArchivo}}</p>
            <mat-chip-set>
              <mat-chip class="aprobado">
                {{getTextoEstado(documento.estado)}}
              </mat-chip>
            </mat-chip-set>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button color="primary" (click)="verDocumento(documento.url)">
              <mat-icon>visibility</mat-icon>
              Ver
            </button>
            <button mat-button (click)="marcarComoPendiente(documento)">
              <mat-icon>pending</mat-icon>
              Marcar Pendiente
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>
    
    <mat-tab label="Documentos Rechazados">
      <div *ngIf="documentosRechazados.length === 0" class="no-documents">
        <mat-icon>cancel</mat-icon>
        <p>No hay documentos rechazados</p>
      </div>
      <div class="documentos-grid">
        <mat-card *ngFor="let documento of documentosRechazados" 
                 class="documento-card rechazado">
          <mat-card-header>
            <mat-icon mat-card-avatar class="documento-icon rechazado">
              {{getIconoTipo(documento.tipo)}}
            </mat-icon>
            <mat-card-title>{{getTipoDocumento(documento.tipo)}}</mat-card-title>
            <mat-card-subtitle>
              Subido: {{documento.fechaCarga | date:'dd/MM/yyyy HH:mm'}}
            </mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <p class="nombre-archivo">{{documento.nombreArchivo}}</p>
            <mat-chip-set>
              <mat-chip class="rechazado">
                {{getTextoEstado(documento.estado)}}
              </mat-chip>
            </mat-chip-set>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button color="primary" (click)="verDocumento(documento.url)">
              <mat-icon>visibility</mat-icon>
              Ver
            </button>
            <button mat-button (click)="marcarComoPendiente(documento)">
              <mat-icon>pending</mat-icon>
              Marcar Pendiente
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="guardarCambios()">
    <mat-icon>save</mat-icon>
    Guardar Cambios
  </button>
</mat-dialog-actions>..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\components\ver-documentos-dialog\ver-documentos-dialog.css 
============================================================================== 
/* Contenedor principal */
.mat-dialog-content {
  max-height: 70vh;
  min-width: 800px;
}

/* Informaci贸n del asegurado */
.asegurado-info {
  background: #f5f5f5;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.asegurado-info h3 {
  margin: 0 0 10px 0;
  color: #2e7d32;
}

.asegurado-info p {
  margin: 5px 0;
  color: #666;
}

.estado-documentos {
  display: flex;
  gap: 10px;
  margin-top: 15px !important;
}

.badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
}

.badge.total {
  background: #e3f2fd;
  color: #1976d2;
}

.badge.pendiente {
  background: #fff3e0;
  color: #f57c00;
}

/* Grid de documentos */
.documentos-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 20px;
  padding: 20px 0;
}

.documento-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.documento-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.documento-card.pendiente {
  border-left: 4px solid #ff9800;
}

.documento-card.aprobado {
  border-left: 4px solid #4caf50;
}

.documento-card.rechazado {
  border-left: 4px solid #f44336;
}

/* Iconos de documentos */
.documento-icon {
  display: flex !important;
  align-items: center;
  justify-content: center;
  border-radius: 50% !important;
}

.documento-icon.pendiente {
  background: #fff3e0;
  color: #f57c00;
}

.documento-icon.aprobado {
  background: #e8f5e9;
  color: #4caf50;
}

.documento-icon.rechazado {
  background: #ffebee;
  color: #f44336;
}

/* Nombre de archivo */
.nombre-archivo {
  font-family: monospace;
  background: #f5f5f5;
  padding: 8px;
  border-radius: 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-bottom: 15px !important;
}

/* Chips de estado */
mat-chip {
  font-weight: 500;
  font-size: 0.8rem;
}

mat-chip.pendiente {
  background: #fff3e0 !important;
  color: #f57c00 !important;
}

mat-chip.aprobado {
  background: #e8f5e9 !important;
  color: #4caf50 !important;
}

mat-chip.rechazado {
  background: #ffebee !important;
  color: #f44336 !important;
}

/* Acciones */
mat-card-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 8px !important;
}

/* Sin documentos */
.no-documents {
  text-align: center;
  padding: 60px 20px;
  color: #888;
}

.no-documents mat-icon {
  font-size: 48px;
  width: 48px;
  height: 48px;
  margin-bottom: 20px;
  opacity: 0.3;
}

.no-documents p {
  margin: 0;
  font-size: 1.1rem;
}

/* Responsive */
@media (max-width: 900px) {
  .mat-dialog-content {
    min-width: auto;
  }
  
  .documentos-grid {
    grid-template-columns: 1fr;
  }
}

/* Tabs */
.mat-tab-group {
  margin-top: 20px;
}

.mat-tab-label {
  min-width: 150px !important;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 12px;
  margin: 15px 0;
}

.info-item {
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 6px;
  border-left: 3px solid #4caf50;
}

.info-item strong {
  color: #2e7d32;
  margin-right: 8px;
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\models\admin-citas.interface.ts 
============================================================================== 
import { Asegurado as AseguradoBase } from '../../../interface/asegurado.interface';

export interface Documento {
  id: number;
  tipo: 'recibo' | 'gestora_anverso' | 'gestora_reverso' | 'otros';
  nombreArchivo: string;
  url: string;
  fechaCarga: Date;
  estado: 'pendiente' | 'aprobado' | 'rechazado';
}

// Extender la interfaz existente para el m贸dulo de citas
export interface Asegurado extends AseguradoBase {
  // Ya incluye todas las propiedades de AseguradoBase
  // Podemos agregar propiedades espec铆ficas para citas si son necesarias
}

export interface SolicitudExamen {
  id: number;
  asegurado: Asegurado;
  documentos: Documento[];
  estado: 'pendiente' | 'observado' | 'aprobado' | 'programado' | 'completado';
  fechaRegistro: Date;
  fechaAprobacion?: Date;
  fechaProgramacion?: Date;
  observaciones?: string;
  citasProgramadas?: Cita[];
}

export interface HorarioDisponible {
  id: number;
  servicio: 'laboratorio' | 'rayos_x' | 'evaluacion_medica';
  fecha: Date;
  horaInicio: string;
  horaFin: string;
  cuposDisponibles: number;
  cuposTotales: number;
}

export interface Cita {
  id?: number;
  solicitudId: number;
  servicio: 'laboratorio' | 'rayos_x' | 'evaluacion_medica';
  fecha: Date;
  hora: string;
  duracion: number;
  estado: 'pendiente' | 'confirmada' | 'completada' | 'cancelada';
}..
============================================================================== 
ARCHIVO : src\app\features\admin-citas\services\admin-citas.service.ts 
============================================================================== 
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { SolicitudExamen, HorarioDisponible, Cita } from '../models/admin-citas.interface';
import { BaseApiService } from '../../../core/service/base-api.service';


@Injectable({
  providedIn: 'root'
})
export class AdminCitasService extends BaseApiService {
  
  constructor() {
    super(); // Esto es CRTICO - llama al constructor de BaseApiService
  }

  // Obtener todas las solicitudes
  getSolicitudes(): Observable<SolicitudExamen[]> {
    return this.getRequest<SolicitudExamen[]>('/admin-citas/solicitudes');
  }

  // Obtener solicitud por ID
  getSolicitudById(id: number): Observable<SolicitudExamen> {
    return this.getRequest<SolicitudExamen>(`/admin-citas/solicitudes/${id}`);
  }

  // Aprobar solicitud
  aprobarSolicitud(id: number): Observable<any> {
    return this.postRequest(`/admin-citas/solicitudes/${id}/aprobar`, {});
  }

  // Observar solicitud
  observarSolicitud(id: number, observaciones: string): Observable<any> {
    return this.postRequest(`/admin-citas/solicitudes/${id}/observar`, { observaciones });
  }

  // Rechazar solicitud
  rechazarSolicitud(id: number, motivo: string): Observable<any> {
    return this.postRequest(`/admin-citas/solicitudes/${id}/rechazar`, { motivo });
  }

  // Enviar email de aprobaci贸n
  enviarEmailAprobacion(id: number): Observable<any> {
    return this.postRequest(`/admin-citas/solicitudes/${id}/enviar-email`, {});
  }

  // Obtener horarios disponibles
  getHorariosDisponibles(): Observable<HorarioDisponible[]> {
    return this.getRequest<HorarioDisponible[]>('/admin-citas/horarios');
  }

  // Programar citas
  programarCitas(solicitudId: number, citas: Cita[]): Observable<any> {
    return this.postRequest(`/admin-citas/solicitudes/${solicitudId}/programar`, { citas });
  }

  // Buscar solicitudes
  buscarSolicitudes(filtro: string): Observable<SolicitudExamen[]> {
    return this.getRequest<SolicitudExamen[]>('/admin-citas/solicitudes/buscar', { q: filtro });
  }

  // Datos mock para desarrollo
  getSolicitudesMock(): SolicitudExamen[] {
    return [
      {
        id: 1,
        asegurado: {
          aseguradoId: 1,
          matricula: 'MAT001',
          estadoAsegurado: 'ACTIVO',
          documentoIdentidad: '1234567',
          extencion: 'LP',
          complemento: '',
          fechaNacimiento: '1985-05-15',
          paterno: 'P茅rez',
          materno: 'G贸mez',
          nombres: 'Juan',
          genero: 'MASCULINO',
          tipoAsegurado: 'TITULAR',
          razonSocial: 'Empresa ABC S.A.',
          nroPatronal: 'PAT123',
          estadoMora: 'AL DA',
          grupoFamiliarId: 1,
          correoElectronico: 'juan.perez@email.com',
          celular: '77712345',
          nombreCompleto: 'Juan P茅rez G贸mez'
        },
        documentos: [
          {
            id: 1,
            tipo: 'recibo',
            nombreArchivo: 'recibo_pago.pdf',
            url: '/assets/docs/recibo1.pdf',
            fechaCarga: new Date('2024-01-15'),
            estado: 'aprobado'
          },
          {
            id: 2,
            tipo: 'gestora_anverso',
            nombreArchivo: 'gestora_anverso.jpg',
            url: '/assets/docs/gestora1.jpg',
            fechaCarga: new Date('2024-01-15'),
            estado: 'pendiente'
          }
        ],
        estado: 'pendiente',
        fechaRegistro: new Date('2024-01-15'),
        observaciones: 'Falta documento de identidad'
      },
      {
        id: 2,
        asegurado: {
          aseguradoId: 2,
          matricula: 'MAT002',
          estadoAsegurado: 'ACTIVO',
          documentoIdentidad: '7654321',
          extencion: 'LP',
          complemento: '',
          fechaNacimiento: '1990-08-22',
          paterno: 'G贸mez',
          materno: 'L贸pez',
          nombres: 'Mar铆a',
          genero: 'FEMENINO',
          tipoAsegurado: 'TITULAR',
          razonSocial: 'Empresa XYZ Ltda.',
          nroPatronal: 'PAT456',
          estadoMora: 'AL DA',
          grupoFamiliarId: 2,
          correoElectronico: 'maria.gomez@email.com',
          celular: '77754321',
          nombreCompleto: 'Mar铆a G贸mez L贸pez'
        },
        documentos: [
          {
            id: 3,
            tipo: 'recibo',
            nombreArchivo: 'recibo_pago2.pdf',
            url: '/assets/docs/recibo2.pdf',
            fechaCarga: new Date('2024-01-16'),
            estado: 'aprobado'
          }
        ],
        estado: 'aprobado',
        fechaRegistro: new Date('2024-01-16'),
        fechaAprobacion: new Date('2024-01-17')
      }
    ];
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\busqueda-asegurados\busqueda-asegurados.ts 
============================================================================== 
import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { AseguradosService } from '../../../../core/service/asegurados.service';
import { Asegurado } from '../../../../interface/asegurado.interface';

@Component({
  selector: 'app-busqueda',
  imports: [CommonModule, FormsModule],
  templateUrl: './busqueda-asegurados.html',
  styleUrl: './busqueda-asegurados.css',
})
export class Busqueda {
documento = '';
  fechaNacimiento = '';
  hoy = new Date().toISOString().split('T')[0];

  cargando = false;
  error = '';
  asegurado: Asegurado | null = null;

  constructor(private apiAseguradosService: AseguradosService) {}

  buscarAsegurado() {
    if (!this.documento || !this.fechaNacimiento) {
      this.error = 'Por favor complete todos los campos';
      return;
    }

    this.cargando = true;
    this.error = '';
    this.asegurado = null;

    console.log(' Buscando asegurado:', this.documento, this.fechaNacimiento);

    this.apiAseguradosService.buscarAsegurado(this.documento, this.fechaNacimiento).subscribe({
      next: (response) => {
        console.log('Asegurado encontrado:', response);
       // this.asegurado = response;
        this.cargando = false;
      },
      error: (err) => {
        console.error(' Error:', err);

        if (err.status === 401) {
          this.error = 'Error de autenticaci贸n. El token puede haber expirado.';
        } else if (err.status === 404) {
          this.error = 'No se encontr贸 asegurado con los datos proporcionados.';
        } else {
          this.error = `Error ${err.status}: ${err.message}`;
        }

        this.cargando = false;
      }
    });
  }

  getNombreCompleto(): string {
    if (!this.asegurado) return '';
    return `${this.asegurado.nombres} ${this.asegurado.paterno} ${this.asegurado.materno}`.trim();
  }

  getEstadoClass(): string {
    if (!this.asegurado) return '';

    const estado = this.asegurado.estadoAsegurado.toLowerCase();
    if (estado.includes('activo')) return 'activo';
    if (estado.includes('inactivo')) return 'inactivo';
    return '';
  }

  formatFecha(fecha: string): string {
    return new Date(fecha).toLocaleDateString('es-ES');
  }

  verDetalles() {
    console.log('Ver detalles del asegurado:', this.asegurado);
    alert('Aqu铆 ir铆an los detalles completos del asegurado');
  }

  programarCita() {
    console.log('Programar cita para:', this.asegurado);
    alert('Aqu铆 se abrir铆a el formulario para programar cita');
  }

  limpiarBusqueda() {
    this.documento = '';
    this.fechaNacimiento = '';
    this.asegurado = null;
    this.error = '';
  }
}
..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\busqueda-asegurados\busqueda-asegurados.html 
============================================================================== 
<p>busqueda-asegurados works!</p>
<div class="busqueda-container">
      <div class="container">
        <!-- T铆tulo -->
        <div class="page-header">
          <h1>Buscar Asegurados</h1>
          <p>Consulta informaci贸n de asegurados del CNS</p>
        </div>

        <!-- Formulario de b煤squeda -->
        <div class="search-card">
          <h2>B煤squeda por Documento</h2>
          
          <div class="search-form">
            <div class="form-group">
              <label>Documento de Identidad:</label>
              <input 
                type="text" 
                [(ngModel)]="documento" 
                placeholder="Ej: 1234567"
                maxlength="10"
              >
            </div>
            
            <div class="form-group">
              <label>Fecha de Nacimiento:</label>
              <input 
                type="date" 
                [(ngModel)]="fechaNacimiento"
                [max]="hoy"
              >
            </div>
            
            <button 
              class="btn btn-primary" 
              (click)="buscarAsegurado()"
              [disabled]="cargando || !documento || !fechaNacimiento"
            >
              {{ cargando ? 'Buscando...' : 'Buscar Asegurado' }}
            </button>
          </div>
        </div>

        <!-- Estado de carga -->
        <div *ngIf="cargando" class="loading-state">
          <div class="spinner"></div>
          <p>Consultando informaci贸n del asegurado...</p>
        </div>

        <!-- Error -->
        <div *ngIf="error && !cargando" class="error-state">
          <h3> Error</h3>
          <p>{{ error }}</p>
          <button class="btn btn-secondary" (click)="error = ''">Intentar de nuevo</button>
        </div>

        <!-- Resultados -->
        <div *ngIf="asegurado && !cargando" class="results-section">
          <div class="results-header">
            <h2>Informaci贸n Encontrada</h2>
            <button class="btn btn-secondary" (click)="limpiarBusqueda()">
              Nueva B煤squeda
            </button>
          </div>

          <!-- Tarjeta de informaci贸n -->
          <div class="info-card">
            <div class="info-header">
              <div class="info-avatar"></div>
              <div class="info-title">
                <h3>{{ getNombreCompleto() }}</h3>
                <div class="info-subtitle">
                  <span class="badge" [class]="getEstadoClass()">
                    {{ asegurado.estadoAsegurado }}
                  </span>
                  <span>Matr铆cula: {{ asegurado.matricula }}</span>
                </div>
              </div>
            </div>

            <div class="info-grid">
              <div class="info-item">
                <label>Documento:</label>
                <span>{{ asegurado.documentoIdentidad }}</span>
              </div>
              
              <div class="info-item">
                <label>Fecha Nacimiento:</label>
                <span>{{ formatFecha(asegurado.fechaNacimiento) }}</span>
              </div>
              
              <div class="info-item">
                <label>G茅nero:</label>
                <span>{{ asegurado.genero }}</span>
              </div>
              
              <div class="info-item">
                <label>Tipo Asegurado:</label>
                <span>{{ asegurado.tipoAsegurado }}</span>
              </div>
              
              <div class="info-item">
                <label>Empresa:</label>
                <span>{{ asegurado.razonSocial || 'No especificada' }}</span>
              </div>
              
              <div class="info-item">
                <label>N掳 Patronal:</label>
                <span>{{ asegurado.nroPatronal || 'No especificado' }}</span>
              </div>
            </div>

            <!-- Acciones -->
            <div class="info-actions">
              <button class="btn btn-primary" (click)="verDetalles()">
                Ver Detalles Completos
              </button>
              <button class="btn btn-secondary" (click)="programarCita()">
                Programar Cita
              </button>
            </div>
          </div>
        </div>

        <!-- Informaci贸n adicional -->
        <div class="info-section">
          <h3> 驴C贸mo funciona?</h3>
          <ul>
            <li>Ingresa el n煤mero de documento del asegurado</li>
            <li>Selecciona la fecha de nacimiento exacta</li>
            <li>Los datos deben coincidir con los registrados en el CNS</li>
            <li>Puedes programar citas m茅dicas para el asegurado encontrado</li>
          </ul>
        </div>
      </div>
    </div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\busqueda-asegurados\busqueda-asegurados.css 
============================================================================== 
.busqueda-container {
      min-height: 100vh;
      padding: 40px 0;
      background: #f8fafc;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .page-header h1 {
      color: #1f2937;
      margin-bottom: 10px;
    }
    
    .page-header p {
      color: #6b7280;
    }
    
    .search-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .search-card h2 {
      color: #374151;
      margin-bottom: 25px;
    }
    
    .search-form {
      .form-group {
        margin-bottom: 20px;
        
        label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: #4b5563;
        }
        
        input {
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e5e7eb;
          border-radius: 8px;
          font-size: 1rem;
          
          &:focus {
            outline: none;
            border-color: #0d9488;
          }
        }
      }
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
      
      &-primary {
        background: #0d9488;
        color: white;
        width: 100%;
        
        &:hover:not(:disabled) {
          background: #0f766e;
        }
        
        &:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
      }
      
      &-secondary {
        background: #6b7280;
        color: white;
        
        &:hover {
          background: #4b5563;
        }
      }
    }
    
    .loading-state {
      text-align: center;
      padding: 40px;
      
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #0d9488;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      
      p {
        color: #6b7280;
      }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-state {
      background: #fee2e2;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      margin-bottom: 30px;
      
      h3 {
        color: #dc2626;
        margin-bottom: 10px;
      }
    }
    
    .results-section {
      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        
        h2 {
          color: #1f2937;
          margin: 0;
        }
      }
    }
    
    .info-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .info-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      
      .info-avatar {
        font-size: 3rem;
      }
      
      .info-title {
        h3 {
          margin: 0 0 10px 0;
          color: #1f2937;
        }
      }
      
      .info-subtitle {
        display: flex;
        gap: 15px;
        align-items: center;
        
        .badge {
          padding: 5px 12px;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 600;
          
          &.activo {
            background: #d1fae5;
            color: #065f46;
          }
          
          &.inactivo {
            background: #fee2e2;
            color: #991b1b;
          }
        }
      }
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
      
      .info-item {
        label {
          display: block;
          color: #6b7280;
          font-size: 0.9rem;
          margin-bottom: 5px;
        }
        
        span {
          display: block;
          color: #1f2937;
          font-weight: 500;
        }
      }
    }
    
    .info-actions {
      display: flex;
      gap: 15px;
      
      .btn {
        flex: 1;
      }
    }
    
    .info-section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-top: 30px;
      
      h3 {
        color: #1f2937;
        margin-bottom: 15px;
      }
      
      ul {
        margin: 0;
        padding-left: 20px;
        
        li {
          margin-bottom: 10px;
          color: #6b7280;
        }
      }
    }
    
    @media (max-width: 768px) {
      .info-header {
        flex-direction: column;
        text-align: center;
      }
      
      .info-actions {
        flex-direction: column;
      }
    }..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\examen-exito-modal\examen-exito-modal.ts 
============================================================================== 
// features/examenes-preocupacionales/components/examen-exito-modal/examen-exito-modal.ts
import { Component, Inject, ChangeDetectionStrategy, NgZone, HostListener } from '@angular/core';
import { CommonModule } from '@angular/common';
import { MatDialogRef, MAT_DIALOG_DATA, MatDialogModule } from '@angular/material/dialog';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { MatCardModule } from '@angular/material/card';
import { MatDividerModule } from '@angular/material/divider';
import { Router } from '@angular/router';
import { inject } from '@angular/core';

export interface ExitoModalData {
  idIngreso: string;
  fechaRegistro: Date;
  numeroRecibo: string;
  totalAsegurados: number;
  importeTotal: number;
  empresa: {
    razonSocial: string;
    nit: string;
    numeroPatronal: string;
  };
}

export interface ExitoModalResult {
  action: 'descargar' | 'salir' | 'nuevo' | 'close';
}

@Component({
  selector: 'app-examen-exito-modal',
  standalone: true,
  imports: [
    CommonModule,
    MatDialogModule,
    MatButtonModule,
    MatIconModule,
    MatCardModule,
    MatDividerModule
  ],
  templateUrl: './examen-exito-modal.html',
  styleUrls: ['./examen-exito-modal.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ExamenExitoModal {
  private dialogRef = inject(MatDialogRef<ExamenExitoModal, ExitoModalResult>);
  private router = inject(Router);
  private ngZone = inject(NgZone);

  private readonly DATE_FORMAT_OPTIONS: Intl.DateTimeFormatOptions = {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    hour12: false
  };

  constructor(@Inject(MAT_DIALOG_DATA) public data: ExitoModalData) {
    // Configurar comportamiento del modal
    this.dialogRef.disableClose = false; // Permitir cerrar con ESC
    this.dialogRef.updateSize('700px', 'auto'); // Altura autom谩tica
  }

  // Permitir cerrar con ESC
  @HostListener('keydown.esc')
  onEsc(): void {
    this.cerrar();
  }

  cerrar(): void {
    this.dialogRef.close({ action: 'close' });
  }

  formatDate(fecha: Date): string {
    if (!fecha || !(fecha instanceof Date)) {
      return 'Fecha no disponible';
    }

    return fecha.toLocaleDateString('es-ES', this.DATE_FORMAT_OPTIONS)
      .replace(',', '')
      .replace(/\//g, '/');
  }

  formatNumber(numero: number): string {
    if (isNaN(numero)) {
      return '0.00';
    }

    return new Intl.NumberFormat('es-ES', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(numero);
  }

  descargarPDF(): void {
    console.log('Generando comprobante para:', this.data.idIngreso);

    const contenidoHTML = this.crearContenidoComprobante();
    const ventanaImpresion = window.open('', '_blank', 'width=800,height=600');

    if (ventanaImpresion) {
      ventanaImpresion.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Comprobante - ${this.data.idIngreso}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 30px; }
          h1 { color: #2c3e50; border-bottom: 2px solid #3498db; }
          .header { text-align: center; margin-bottom: 30px; }
          .section { margin: 20px 0; }
          .label { font-weight: bold; color: #555; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
          th { background-color: #f2f2f2; }
          .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #777; }
          @media print {
            body { margin: 20px; }
            .no-print { display: none !important; }
            button { display: none !important; }
          }
        </style>
      </head>
      <body>
        ${contenidoHTML}
        <div class="footer no-print">
          <p>Este documento fue generado el ${new Date().toLocaleDateString('es-ES')}</p>
          <button onclick="window.print()" style="padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Imprimir o Guardar como PDF
          </button>
          <button onclick="window.close()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
            Cerrar
          </button>
        </div>
      </body>
      </html>
    `);

      ventanaImpresion.document.close();
    } else {
      alert('Por favor, permite ventanas emergentes para ver el comprobante');
    }
  }

  private crearContenidoComprobante(): string {
    return `
    <div class="header">
      <h1>COMPROBANTE DE REGISTRO</h1>
      <h2>Examen Preocupacional</h2>
    </div>
    
    <div class="section">
      <p><span class="label">ID de Registro:</span> ${this.data.idIngreso}</p>
      <p><span class="label">Fecha de Registro:</span> ${this.formatDate(this.data.fechaRegistro)}</p>
      <p><span class="label">N煤mero de Recibo:</span> ${this.data.numeroRecibo}</p>
    </div>
    
    <div class="section">
      <h3>Datos de la Empresa</h3>
      <p><span class="label">Raz贸n Social:</span> ${this.data.empresa.razonSocial}</p>
      <p><span class="label">NIT:</span> ${this.data.empresa.nit}</p>
      <p><span class="label">N煤mero Patronal:</span> ${this.data.empresa.numeroPatronal}</p>
    </div>
    
    <div class="section">
      <h3>Resumen del Registro</h3>
      <p><span class="label">Total Asegurados:</span> ${this.data.totalAsegurados}</p>
      <p><span class="label">Importe Total:</span> Bs. ${this.formatNumber(this.data.importeTotal)}</p>
    </div>
    
    <div class="footer">
      <hr>
      <p>Sistema CNS - Caja Nacional de Salud</p>
      <p>Documento generado electr贸nicamente</p>
    </div>
  `;
  }

  salir(): void {
    this.dialogRef.close({ action: 'salir' });

    setTimeout(() => {
      this.ngZone.run(() => {
        this.cerrarSesionYRedirigir();
      });
    }, 100);
  }

  private cerrarSesionYRedirigir(): void {
    try {
      this.limpiarDatosSesion();
      this.router.navigate(['/login'], {
        replaceUrl: true,
        queryParams: { logout: 'true' }
      });
    } catch (error) {
      console.error('Error al cerrar sesi贸n:', error);
      try {
        this.router.navigate(['/login']);
      } catch (e) {
        window.location.href = '/login';
      }
    }
  }

  private limpiarDatosSesion(): void {
    try {
      const itemsParaMantener = ['configuracion', 'preferencias'];
      const localStorageKeys = Object.keys(localStorage);

      localStorageKeys.forEach(key => {
        if (!itemsParaMantener.includes(key)) {
          localStorage.removeItem(key);
        }
      });

      sessionStorage.clear();
      this.limpiarCookies();
      console.log('Sesi贸n cerrada correctamente');
    } catch (error) {
      console.warn('Error parcial al limpiar sesi贸n:', error);
    }
  }

  private limpiarCookies(): void {
    try {
      const cookies = document.cookie.split(';');
      cookies.forEach(cookie => {
        const eqPos = cookie.indexOf('=');
        const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
        if (name.includes('token') || name.includes('session') || name.includes('auth')) {
          document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`;
        }
      });
    } catch (error) {
      console.warn('Error al limpiar cookies:', error);
    }
  }

  // nuevoExamen(): void {
  //   this.dialogRef.close({ action: 'nuevo' });
  // }

  get tituloModal(): string {
    return `Registro Exitoso - ${this.data.idIngreso}`;
  }

  get subtituloModal(): string {
    return `${this.data.empresa.razonSocial} (NIT: ${this.data.empresa.nit})`;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\examen-exito-modal\examen-exito-modal.html 
============================================================================== 
<!-- features/examenes-preocupacionales/components/examen-exito-modal/examen-exito-modal.html -->
<div class="exito-modal">
  
  <!-- Cabecera con bot贸n de cerrar -->
  <div class="modal-header">
    <!-- Bot贸n de cerrar en esquina superior derecha -->
    <button mat-icon-button class="close-button" (click)="cerrar()">
      <mat-icon>close</mat-icon>
    </button>
    
    <mat-icon class="success-icon">check_circle</mat-icon>
    <h1 class="modal-title">隆Registro Exitoso!</h1>
  </div>

  <!-- Contenido con scroll -->
  <div class="modal-content-wrapper">
    <div class="modal-content">
      <p class="success-message">
        El examen preocupacional ha sido registrado correctamente en el sistema CNS. 
        Se ha generado un registro 煤nico con la siguiente informaci贸n:
      </p>
      
      <mat-card class="details-card">
        <mat-card-content>
          <div class="details-grid">
            <div class="detail-item">
              <strong>ID de Registro:</strong>
              <span class="id-highlight">{{ data.idIngreso }}</span>
            </div>
            <div class="detail-item">
              <strong>Fecha de Registro:</strong>
              <span>{{ formatDate(data.fechaRegistro) }}</span>
            </div>
            <div class="detail-item">
              <strong>N煤mero de Recibo:</strong>
              <span>{{ data.numeroRecibo }}</span>
            </div>
            <div class="detail-item">
              <strong>Total Asegurados:</strong>
              <span>{{ data.totalAsegurados }}</span>
            </div>
            <div class="detail-item">
              <strong>Importe Total:</strong>
              <span>Bs. {{ formatNumber(data.importeTotal) }}</span>
            </div>
            <div class="detail-item">
              <strong>Empresa:</strong>
              <span>{{ data.empresa.razonSocial }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
      
      <p class="instructions">
        Guarde esta informaci贸n para futuras consultas. Puede descargar el comprobante en PDF.
      </p>
    </div>

    <!-- SECCIN PRXIMOS PASOS -->
    <div class="proximos-pasos">
      <h3>Pr贸ximos pasos</h3>
      
      <div class="paso">
        <span class="numero">1</span>
        <div>
          <strong>Revisi贸n de documentos</strong>
          <p>Nuestro equipo verificar谩 su informaci贸n (24-48 horas h谩biles)</p>
        </div>
      </div>
      
      <div class="paso">
        <span class="numero">2</span>
        <div>
          <strong>Notificaci贸n v铆a email</strong>
          <p>Recibir谩 un enlace para seleccionar horarios si es aprobado</p>
        </div>
      </div>
      
      <div class="paso">
        <span class="numero">3</span>
        <div>
          <strong>Selecci贸n de horario</strong>
          <p>Podr谩 elegir entre fechas y horarios disponibles para sus asegurados</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ACCIONES FIJAS EN PARTE INFERIOR -->
  <div class="modal-actions-wrapper">
    <div class="modal-actions">
      <button mat-raised-button color="primary" (click)="descargarPDF()">
        <mat-icon>download</mat-icon>
        Descargar PDF
      </button>

      <button mat-stroked-button (click)="salir()">
        <mat-icon>exit_to_app</mat-icon>
        Salir del sistema
      </button>
      
      <!-- <button mat-button (click)="nuevoExamen()" class="nuevo-btn">
        <mat-icon>add_circle</mat-icon>
        Nuevo Registro
      </button> -->
    </div>
  </div>
</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\examen-exito-modal\examen-exito-modal.css 
============================================================================== 
/* features/examenes-preocupacionales/components/examen-exito-modal/examen-exito-modal.css */

/* Estilos para el di谩logo de Material */
::ng-deep .exito-modal-dialog .mat-mdc-dialog-container {
  padding: 0 !important;
  overflow: hidden;
  border-radius: 12px !important;
}

::ng-deep .exito-modal-dialog .mat-mdc-dialog-surface {
  overflow: hidden !important;
  border-radius: 12px !important;
  max-height: 90vh !important; /* Limitar altura m谩xima */
}

/* Contenedor principal del modal */
.exito-modal {
  padding: 0;
  max-width: 100%;
  height: auto;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
}

/* Cabecera fija */
.modal-header {
  text-align: center;
  padding: 24px 24px 16px;
  background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
  color: white;
  flex-shrink: 0;
  position: sticky;
  top: 0;
  z-index: 10;
  border-radius: 12px 12px 0 0;
}

.success-icon {
  font-size: 64px;
  width: 64px;
  height: 64px;
  color: white;
  margin-bottom: 16px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.modal-title {
  color: white;
  margin: 0;
  font-size: 24px;
  font-weight: 600;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Contenido con scroll */
.modal-content-wrapper {
  padding: 0 24px;
  flex: 1;
  overflow-y: auto;
  max-height: calc(90vh - 180px); /* Altura din谩mica */
}

.modal-content {
  margin-bottom: 24px;
  padding-top: 16px;
}

.success-message {
  text-align: center;
  font-size: 16px;
  color: #666;
  margin-bottom: 24px;
  line-height: 1.5;
}

.details-card {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  margin-bottom: 20px;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.details-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
  padding: 20px;
}

.detail-item {
  display: flex;
  flex-direction: column;
  padding: 8px 0;
}

.detail-item strong {
  color: #555;
  font-size: 14px;
  margin-bottom: 6px;
  font-weight: 500;
}

.detail-item span {
  color: #333;
  font-size: 15px;
  font-weight: 500;
}

.id-highlight {
  font-family: 'Courier New', monospace;
  font-weight: bold;
  color: #2196f3;
  background: #e3f2fd;
  padding: 6px 12px;
  border-radius: 6px;
  display: inline-block;
  border: 1px solid #bbdefb;
}

.instructions {
  text-align: center;
  color: #666;
  font-size: 14px;
  margin: 20px 0;
  padding: 16px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #4caf50;
}

/* SECCIN PRXIMOS PASOS */
.proximos-pasos {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 12px;
  padding: 20px;
  margin: 16px 0 24px;
  border: 1px solid #dee2e6;
}

.proximos-pasos h3 {
  color: #2c3e50;
  margin: 0 0 20px 0;
  font-size: 18px;
  font-weight: 600;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.proximos-pasos h3::before {
  content: '';
  font-size: 20px;
}

.paso {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px dashed #dee2e6;
}

.paso:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.paso .numero {
  background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
  color: white;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  flex-shrink: 0;
  box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
}

.paso div {
  flex: 1;
}

.paso strong {
  color: #2c3e50;
  font-size: 15px;
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
}

.paso p {
  color: #666;
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
}

/* ACCIONES FIJAS EN LA PARTE INFERIOR */
.modal-actions-wrapper {
  padding: 16px 24px 24px;
  background: white;
  border-top: 1px solid #e9ecef;
  position: sticky;
  bottom: 0;
  z-index: 10;
  flex-shrink: 0;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
}

.modal-actions {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.modal-actions button {
  min-width: 160px;
  height: 44px;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.modal-actions button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Bot贸n principal - Descargar */
.modal-actions button:first-child {
  background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
  color: white;
  border: none;
}

/* Bot贸n Salir */
.modal-actions button:nth-child(2) {
  color: #f44336;
  border-color: #f44336;
}

/* Bot贸n Nuevo */
.nuevo-btn {
  color: #4caf50 !important;
  border-color: #4caf50 !important;
  background: transparent !important;
}

.nuevo-btn:hover {
  background: #e8f5e9 !important;
}

/* Bot贸n de cerrar en esquina */
.close-button {
  position: absolute !important;
  top: 16px;
  right: 16px;
  background: rgba(255, 255, 255, 0.2) !important;
  backdrop-filter: blur(10px);
  color: white !important;
  z-index: 20;
}

.close-button:hover {
  background: rgba(255, 255, 255, 0.3) !important;
  transform: scale(1.1);
}

/* RESPONSIVE */
@media (max-width: 768px) {
  ::ng-deep .exito-modal-dialog {
    max-width: 95vw !important;
    width: 95vw !important;
  }
  
  .modal-header {
    padding: 20px 16px 12px;
  }
  
  .success-icon {
    font-size: 48px;
    width: 48px;
    height: 48px;
  }
  
  .modal-title {
    font-size: 20px;
  }
  
  .modal-content-wrapper {
    padding: 0 16px;
    max-height: calc(90vh - 160px);
  }
  
  .details-grid {
    grid-template-columns: 1fr;
    padding: 16px;
    gap: 12px;
  }
  
  .proximos-pasos {
    padding: 16px;
    margin: 12px 0 20px;
  }
  
  .modal-actions-wrapper {
    padding: 12px 16px 20px;
  }
  
  .modal-actions {
    flex-direction: column;
    gap: 10px;
  }
  
  .modal-actions button {
    width: 100%;
    min-width: unset;
  }
  
  .close-button {
    top: 12px;
    right: 12px;
    width: 36px !important;
    height: 36px !important;
    min-width: unset !important;
    padding: 0 !important;
  }
  
  .paso {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  
  .paso .numero {
    align-self: center;
  }
}

@media (max-width: 480px) {
  .modal-header {
    padding: 16px 12px 8px;
  }
  
  .modal-title {
    font-size: 18px;
  }
  
  .success-message {
    font-size: 15px;
    margin-bottom: 20px;
  }
  
  .detail-item strong {
    font-size: 13px;
  }
  
  .detail-item span {
    font-size: 14px;
  }
  
  .proximos-pasos h3 {
    font-size: 16px;
  }
  
  .paso strong {
    font-size: 14px;
  }
  
  .paso p {
    font-size: 13px;
  }
}

/* Animaciones */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.exito-modal {
  animation: fadeInUp 0.3s ease;
}

.paso {
  animation: fadeInUp 0.4s ease;
  animation-fill-mode: both;
}

.paso:nth-child(1) { animation-delay: 0.1s; }
.paso:nth-child(2) { animation-delay: 0.2s; }
.paso:nth-child(3) { animation-delay: 0.3s; }

/* Scroll personalizado */
.modal-content-wrapper::-webkit-scrollbar {
  width: 8px;
}

.modal-content-wrapper::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

.modal-content-wrapper::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.modal-content-wrapper::-webkit-scrollbar-thumb:hover {
  background: #a1a1a1;
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\login\login.ts 
============================================================================== 
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';
import { Router } from '@angular/router';
import { SesionService } from '../../../../core/service/sesion.service';
import { EmpresaService } from '../../../../core/service/empresa.service';
import { MatIcon } from "@angular/material/icon";
import { MatProgressSpinner } from "@angular/material/progress-spinner";
import { MatHint, MatError, MatFormField, MatLabel } from "@angular/material/form-field";
import { SharedMaterialModule } from '../../../../shared/modules/material.module'; // angular Material m贸dulos compartidos



@Component({
  selector: 'app-login',
  imports: [
    SharedMaterialModule,
    MatIcon, 
    MatProgressSpinner, 
    MatHint, 
    MatError, 
    MatFormField, 
    MatLabel,
    ReactiveFormsModule],
  templateUrl: './login.html',
  styleUrl: './login.css',
})
export class Login implements OnInit {
  loginForm: FormGroup;
  accesoForm: FormGroup;
  modo: 'nuevo' | 'recuperar' = 'nuevo';
  isLoading = false;
  mensajeError = '';
  idEjemploGenerado: boolean = false;


  constructor(
    private fb: FormBuilder,
    private router: Router,
    private sesionService: SesionService,
    private empresaService: EmpresaService
  ) {
    this.loginForm = this.fb.group({
      aceptarTerminos: [false, Validators.requiredTrue]
    });

    this.accesoForm = this.fb.group({
      idAcceso: ['', [
        Validators.required,
        Validators.pattern(/^EXM-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i)
      ]]
    });
  }

  ngOnInit(): void {
    // Verificar si ya hay una sesi贸n activa
    const idAcceso = this.sesionService.getIdAcceso();
    if (idAcceso ) {
      // Redirigir directamente seg煤n el paso actual
      const sesionRecuperada = this.sesionService.recuperarSesion(idAcceso);
       if (sesionRecuperada) {
      this.redirigirSegunPaso();
      }
    }
  }
  /**
   * MTODO onIdInput - Maneja el evento input en el campo ID
   */
  onIdInput(event: Event): void {
    const input = event.target as HTMLInputElement;
    let value = input.value;
    
    console.log(' Input detectado:', value);
    
    // 1. Convertir a may煤sculas
    value = value.toUpperCase();
    
    // 2. Remover caracteres no permitidos (solo A-Z, 0-9, gui贸n)
    value = value.replace(/[^A-Z0-9-]/g, '');
    
    // 3. Autoformatear mientras escribe
    value = this.formatearIdMientrasEscribe(value);
    
    // 4. Limitar longitud m谩xima (EXM-XXXX-XXXX-XXXX = 18 caracteres)
    if (value.length > 18) {
      value = value.substring(0, 18);
    }
    
    // 5. Actualizar el valor en el formulario
    if (value !== this.accesoForm.get('idAcceso')?.value) {
      this.accesoForm.patchValue({ idAcceso: value }, { emitEvent: false });
      
      // Limpiar mensaje de ejemplo si el usuario empieza a escribir
      if (value.length > 0 && this.idEjemploGenerado) {
        this.idEjemploGenerado = false;
      }
    }
  }

/**
   * Formatea el ID mientras el usuario escribe
   */
  private formatearIdMientrasEscribe(valor: string): string {
    // Si no empieza con EXM, forzarlo
    if (!valor.startsWith('EXM')) {
      if (valor.length > 0 && !valor.includes('EXM')) {
        valor = 'EXM' + valor;
      }
    }
    
    let formateado = valor;
    
    // Insertar guiones en posiciones espec铆ficas
    // Formato: EXM-XXXX-XXXX-XXXX
    // Posiciones: 3, 8, 13
    
    if (formateado.length > 3 && formateado.charAt(3) !== '-') {
      formateado = formateado.slice(0, 3) + '-' + formateado.slice(3);
    }
    
    if (formateado.length > 8 && formateado.charAt(8) !== '-') {
      formateado = formateado.slice(0, 8) + '-' + formateado.slice(8);
    }
    
    if (formateado.length > 13 && formateado.charAt(13) !== '-') {
      formateado = formateado.slice(0, 13) + '-' + formateado.slice(13);
    }
    
    return formateado;
  }
  /**
   * Acceso nuevo - Comenzar
   */
  comenzar(): void {
    if (this.loginForm.invalid) {
      this.mostrarError('Debe aceptar los t茅rminos y condiciones');
      return;
    }

    // Crear nueva sesi贸n
    const idAcceso = this.sesionService.crearNuevaSesion();
    // Mostrar mensaje con el ID generado
    this.mostrarMensajeExito(`Se ha generado su ID de acceso: ${idAcceso}. Gu谩rdelo para continuar m谩s tarde.`);
    
     // Redirigir al prelogin despu茅s de un breve delay
    setTimeout(() => {
      this.router.navigate(['/prelogin']);
    }, 1500);
  }

  /**
   * Acceso con ID existente
   */
  accederConId(): void {
    if (this.accesoForm.invalid) {
      this.mostrarError('Ingrese un ID de acceso v谩lido');
      return;
    }

    this.isLoading = true;
    const idAcceso = this.accesoForm.get('idAcceso')?.value?.toUpperCase() || '';

    // Validar formato b谩sico
    const regex = /^EXM-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/;
    if (!regex.test(idAcceso)) {
      this.mostrarError('Formato de ID inv谩lido. Debe ser: EXM-XXXX-XXXX-XXXX');
      this.isLoading = false;
      return;
    }
     // Intentar recuperar sesi贸n
    setTimeout(() => {
      try {
        const sesionRecuperada = this.sesionService.recuperarSesion(idAcceso);
        
        if (sesionRecuperada) {
          this.mostrarMensajeExito('Sesi贸n recuperada exitosamente');
          this.redirigirSegunPaso();
        } else {
          this.mostrarError('ID de acceso inv谩lido o expirado');
        }
      } catch (error) {
        this.mostrarError('Error al verificar el ID de acceso');
        console.error('Error en acceso con ID:', error);
      } finally {
        this.isLoading = false;
      }
    }, 1000);
  }

  /**
   * Redirigir seg煤n el paso actual de la sesi贸n
   */
   private redirigirSegunPaso(): void {
    const sesion = this.sesionService.getSesionActualValue();
    
    if (!sesion) {
      this.router.navigate(['/prelogin']);
      return;
    }

    switch (sesion.pasoActual) {
      case 0: // Prelogin
        this.router.navigate(['/prelogin']);
        break;
      case 1: // Empresa verificada
        // Cargar empresa si existe en datos parciales
        if (sesion.datosParciales?.empresa) {
          this.empresaService.guardarEmpresaExamen(sesion.datosParciales.empresa);
        }
        this.router.navigate(['/prelogin']);
        break;
      case 2: // Formulario de examen
        this.router.navigate(['/examen-preocupacional']);
        break;
      default:
        this.router.navigate(['/prelogin']);
    }
  }

  /**
   * Mostrar mensaje de 茅xito
   */
  private mostrarMensajeExito(mensaje: string): void {
    // En un sistema real, usar铆as un servicio de notificaciones
    console.log('', mensaje);

    alert(mensaje); // Temporal - reemplazar con toast
  }

 /**
   * Cambiar modo de acceso
   */
  cambiarModo(modo: 'nuevo' | 'recuperar'): void {
    this.modo = modo;
    this.mensajeError = '';
    this.accesoForm.reset();
    this.idEjemploGenerado = false;
  }
  /**
   * Mostrar error
   */
  private mostrarError(mensaje: string): void {
    this.mensajeError = mensaje;
    
    // Limpiar despu茅s de 5 segundos
    setTimeout(() => {
      if (this.mensajeError === mensaje) {
        this.mensajeError = '';
      }
    }, 5000);
  }

  /**
   * Copiar ID al portapapeles
   */
  copiarId(id: string): void {
    navigator.clipboard.writeText(id).then(() => {
      // Mostrar feedback
      console.log(' ID copiado al portapapeles');
    });
  }

  /**
   * Generar ejemplo de ID
   */
  generarEjemplo(): void {
    // Generar un ID de ejemplo v谩lido
    const ejemplo = this.generarIdEjemplo();
    
    this.accesoForm.patchValue({ idAcceso: ejemplo });
    this.idEjemploGenerado = true;
    
    // Mostrar mensaje informativo
    console.log(' Ejemplo de ID generado:', ejemplo);
    
    // Seleccionar todo el texto para facilitar copiar
    setTimeout(() => {
      const input = document.querySelector('input[formControlName="idAcceso"]') as HTMLInputElement;
      if (input) {
        input.select();
      }
    }, 100);
  }

  /**
   * Generar un ID de ejemplo v谩lido
   */
  private generarIdEjemplo(): string {
    const caracteres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    
    const generarParte = (longitud: number) => {
      let resultado = '';
      for (let i = 0; i < longitud; i++) {
        resultado += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
      }
      return resultado;
    };
    
    return `EXM-${generarParte(4)}-${generarParte(4)}-${generarParte(4)}`;
  }

  /**
   * M茅todo para el evento blur (cuando pierde el foco)
   */
  onIdBlur(): void {
    const control = this.accesoForm.get('idAcceso');
    if (!control) return;
    
    let valor = control.value?.trim();
    
    if (valor) {
      // Asegurar formato correcto
      valor = valor.toUpperCase();
      
      // Si no empieza con EXM, agregarlo
      if (!valor.startsWith('EXM')) {
        valor = 'EXM-' + valor.replace(/^EXM-?/i, '');
      }
      
      // Validar formato final
      const regex = /^EXM-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/;
      if (!regex.test(valor)) {
        // Intentar corregir formato
        valor = this.corregirFormatoId(valor);
      }
      
      if (valor !== control.value) {
        control.setValue(valor, { emitEvent: true });
      }
      
      // Marcar como tocado para mostrar errores
      control.markAsTouched();
    }
  }

  /**
   * Intentar corregir formato de ID
   */
  private corregirFormatoId(valor: string): string {
    // Remover todos los guiones y espacios
    let limpio = valor.replace(/[^A-Z0-9]/g, '');
    
    // Remover EXM si est谩 al inicio
    if (limpio.startsWith('EXM')) {
      limpio = limpio.substring(3);
    }
    
    // Tomar solo los primeros 12 caracteres (4+4+4)
    limpio = limpio.substring(0, 12);
    
    // Asegurar que tenga 12 caracteres rellenando con ceros
    while (limpio.length < 12) {
      limpio += '0';
    }
    
    // Formatear en grupos de 4
    const parte1 = limpio.substring(0, 4);
    const parte2 = limpio.substring(4, 8);
    const parte3 = limpio.substring(8, 12);
    
    return `EXM-${parte1}-${parte2}-${parte3}`;
  }

  /**
   * Copiar ID al portapapeles
   */
  copiarIdAlPortapapeles(): void {
    const id = this.accesoForm.get('idAcceso')?.value;
    
    if (id) {
      navigator.clipboard.writeText(id).then(() => {
        console.log(' ID copiado al portapapeles:', id);
        
        // Mostrar feedback visual
        const original = this.mensajeError;
        this.mensajeError = ' ID copiado al portapapeles';
        
        setTimeout(() => {
          if (this.mensajeError === ' ID copiado al portapapeles') {
            this.mensajeError = original || '';
          }
        }, 2000);
      }).catch(err => {
        console.error('Error al copiar:', err);
        this.mostrarError('No se pudo copiar el ID');
      });
    }
  }

  /**
   * Ver t茅rminos y condiciones
   */
  verTerminos(): void {
    const terminos = `
TRMINOS Y CONDICIONES - SISTEMA CNS

1. ACEPTACIN
Al utilizar este sistema, usted acepta estos t茅rminos y condiciones.

2. ID DE ACCESO NICO
- Se generar谩 un ID 煤nico para cada registro
- Es su responsabilidad guardar este ID
- El ID expira despu茅s de 7 d铆as
- Un ID solo puede ser usado por una persona

3. USO DEL SISTEMA
- Solo para registro de ex谩menes preocupacionales
- Informaci贸n veraz y completa requerida
- Respeto a la confidencialidad de datos

4. PROTECCIN DE DATOS
- Sus datos son tratados con confidencialidad
- Cumplimiento con ley de protecci贸n de datos
- No compartiremos su informaci贸n con terceros

5. RESPONSABILIDADES
- Verificar informaci贸n antes de enviar
- Notificar cualquier error en sus datos
- Mantener su ID de acceso seguro

Para preguntas: contacto@cns.gob.bo
    `;
    
    alert(terminos);
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\login\login.html 
============================================================================== 
<!-- login.component.html -->
<div class="login-container">
  <div class="login-card">
    <!-- Logo y t铆tulo -->
    <div class="login-header">
      <div class="logo-container">
        <mat-icon class="logo-icon">medical_services</mat-icon>
        <h1>Ex谩menes Preocupacionales</h1>
      </div>
      <p class="subtitle">Sistema de Registro CNS</p>
    </div>

    <!-- Selector de modo -->
    <div class="modo-selector">
      <button mat-button 
              [class.active]="modo === 'nuevo'"
              (click)="cambiarModo('nuevo')">
        <mat-icon>add_circle</mat-icon>
        Acceso Nuevo
      </button>
      <button mat-button 
              [class.active]="modo === 'recuperar'"
              (click)="cambiarModo('recuperar')">
        <mat-icon>restore</mat-icon>
        Registro En Proceso 
      </button>
    </div>

    <!-- Formulario seg煤n modo -->
    <div class="form-container">
      @if (modo === 'nuevo') {
        <!-- Acceso nuevo -->
        <div class="nuevo-acceso">
          <h2>Comenzar Registro</h2>
          <p class="descripcion">
            Genere un nuevo registro para realizar ex谩menes preocupacionales.
            Se le asignar谩 un ID 煤nico para poder continuar m谩s tarde si es necesario.
          </p>

          <form [formGroup]="loginForm">
            <div class="terminos-container">
              <mat-checkbox formControlName="aceptarTerminos" color="primary">
                Acepto los t茅rminos y condiciones del servicio
              </mat-checkbox>
              <a href="javascript:void(0)" 
                 class="ver-terminos" 
                 (click)="verTerminos()">
                Ver t茅rminos
              </a>
            </div>

            <button mat-raised-button 
                    color="primary"
                    class="comenzar-btn"
                    (click)="comenzar()"
                    [disabled]="!loginForm.valid || isLoading">
              @if (isLoading) {
                <mat-spinner diameter="20"></mat-spinner>
              } @else {
                <!-- <mat-icon>play_arrow</mat-icon> -->
              }
              Comenzar
            </button>
          </form>
        </div>
      } @else {
        <!-- Acceso con ID -->
        <div class="recuperar-acceso">
          <h2>Continuar Registro</h2>
          <p class="descripcion">
            Ingrese su ID de acceso para continuar con el registro desde donde lo dej贸.
            El ID fue generado al iniciar su registro.
          </p>

          <form [formGroup]="accesoForm">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>ID de Acceso</mat-label>
              <input matInput 
                     formControlName="idAcceso"
                     placeholder="Ej: EXM-ABC1-2345-DEF6"
                     (input)="onIdInput($event)"
                     (blur)="onIdBlur()"
                     [maxlength]="18">
              <mat-icon matSuffix>vpn_key</mat-icon>
              
              @if (accesoForm.get('idAcceso')?.hasError('required')) {
                <mat-error>El ID de acceso es requerido</mat-error>
              }
              @if (accesoForm.get('idAcceso')?.hasError('pattern')) {
                <mat-error>Formato: EXM-XXXX-XXXX-XXXX</mat-error>
              }
              
              <mat-hint>
                @if (idEjemploGenerado) {
                  <span class="ejemplo-hint">Ejemplo generado - puede editarlo</span>
                } @else {
                  <span>Ingrese el ID que recibi贸 al comenzar</span>
                }
              </mat-hint>
            </mat-form-field>

            <div class="form-actions">
              <button mat-stroked-button 
                      type="button"
                      (click)="generarEjemplo()"
                      class="ejemplo-btn">
                <mat-icon>content_copy</mat-icon>
                Ver Ejemplo
              </button>

              <button mat-stroked-button 
                      type="button"
                      (click)="copiarIdAlPortapapeles()"
                      [disabled]="!accesoForm.get('idAcceso')?.value">
                <mat-icon>content_paste</mat-icon>
                Copiar
              </button>

              <button mat-raised-button 
                      color="primary"
                      (click)="accederConId()"
                      [disabled]="!accesoForm.valid || isLoading"
                      class="continuar-btn">
                @if (isLoading) {
                  <mat-spinner diameter="20"></mat-spinner>
                } @else {
                  <mat-icon>login</mat-icon>
                }
                Continuar
              </button>
            </div>
          </form>

          <!-- Recordatorio -->
          <div class="recordatorio">
            <mat-icon>info</mat-icon>
            <div>
              <p><strong>驴No recuerda su ID?</strong></p>
              <p>Revise el correo electr贸nico o mensaje que recibi贸 al iniciar su registro.</p>
              <p class="formato-nota">Formato requerido: <code>EXM-XXXX-XXXX-XXXX</code></p>
            </div>
          </div>
        </div>
      }

      <!-- Mensaje de error -->
      @if (mensajeError) {
        <div class="mensaje-alerta" [class.error]="mensajeError.includes('Error') || mensajeError.includes('inv谩lido')">
          <mat-icon>
            @if (mensajeError.includes('')) {
              check_circle
            } @else {
              error
            }
          </mat-icon>
          <span [innerHTML]="mensajeError"></span>
        </div>
      }
    </div>

    <!-- Informaci贸n importante -->
    <div class="info-section">
      <h3><mat-icon>info</mat-icon> Informaci贸n Importante</h3>
      <ul>
        <li><strong>ID nico:</strong> Se genera autom谩ticamente al comenzar</li>
        <!-- <li><strong>Validez:</strong> Su ID expira despu茅s de 7 d铆as</li> -->
        <li><strong>Seguridad:</strong> Mantenga su ID en un lugar seguro</li>
        <li><strong>Personal:</strong> Un ID solo puede ser usado por una persona</li>
        <li><strong>Recuperaci贸n:</strong> Si pierde su ID, deber谩 comenzar nuevamente</li>
      </ul>
    </div>

    <!-- Footer -->
    <div class="login-footer">
      <div class="footer-content">
        <!-- <mat-icon>verified</mat-icon> -->
        <span>Sistema Examen Preocupacional CNS - Caja Nacional de Salud</span>
      </div>
      <div class="version">v1.0.0</div>
    </div>
  </div>
</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\login\login.css 
============================================================================== 
/* login.component.css */
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  padding: 20px;
}

.login-card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 15px 50px rgba(46, 125, 50, 0.15);
  width: 100%;
  max-width: 500px;
  overflow: hidden;
  animation: fadeIn 0.5s ease;
}

.login-header {
  background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
  color: white;
  padding: 40px 30px;
  text-align: center;
  border-bottom: 6px solid #66bb6a;
}

.logo-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.logo-icon {
  font-size: 64px;
  width: 64px;
  height: 64px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  padding: 12px;
}

.login-header h1 {
  margin: 0;
  font-size: 1.8rem;
  font-weight: 600;
}

.subtitle {
  margin: 8px 0 0 0;
  opacity: 0.9;
  font-size: 1rem;
}

/* Selector de modo */
.modo-selector {
  display: flex;
  border-bottom: 1px solid #e0e0e0;
  padding: 0 20px;
  margin-top: 20px;
}

.modo-selector button {
  flex: 1;
  padding: 20px;
  border-radius: 0;
  border-bottom: 3px solid transparent;
  font-weight: 500;
  color: #666;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.modo-selector button.active {
  color: #4caf50;
  border-bottom-color: #4caf50;
  background: rgba(76, 175, 80, 0.05);
}

.modo-selector button:hover:not(.active) {
  background: #f5f5f5;
}

/* Formulario */
.form-container {
  padding: 30px;
}

.nuevo-acceso h2,
.recuperar-acceso h2 {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #333;
  margin: 0 0 15px 0;
  font-size: 1.4rem;
}

.descripcion {
  color: #666;
  margin: 0 0 25px 0;
  line-height: 1.6;
  font-size: 15px;
}

/* T茅rminos y condiciones */
.terminos-container {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin: 25px 0;
  border: 1px solid #e0e0e0;
}

.ver-terminos {
  display: block;
  margin-top: 10px;
  color: #4caf50;
  text-decoration: none;
  font-size: 14px;
}

.ver-terminos:hover {
  text-decoration: underline;
}

/* Bot贸n comenzar */
.comenzar-btn {
  width: 100%;
  height: 52px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
}

/* Formulario ID */
.full-width {
  width: 100%;
  margin: 20px 0;
}

.form-actions {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}

.form-actions button {
  flex: 1;
  height: 48px;
  font-weight: 500;
}

/* Recordatorio */
.recordatorio {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 15px;
  background: #e3f2fd;
  border-radius: 8px;
  margin-top: 25px;
  border-left: 4px solid #2196f3;
}

.recordatorio mat-icon {
  color: #2196f3;
  margin-top: 2px;
}

.recordatorio p {
  margin: 0;
  font-size: 14px;
  color: #1565c0;
  line-height: 1.5;
}

/* Error message */
.error-message {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 15px;
  background: #ffebee;
  border-radius: 8px;
  margin-top: 20px;
  border: 1px solid #f44336;
  color: #c62828;
}

.error-message mat-icon {
  color: #f44336;
}

/* Informaci贸n importante */
.info-section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin: 0 30px 30px;
  border: 1px solid #e0e0e0;
}

.info-section h3 {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #333;
  margin: 0 0 15px 0;
  font-size: 1.1rem;
}

.info-section ul {
  margin: 0;
  padding-left: 20px;
}

.info-section li {
  margin-bottom: 8px;
  color: #666;
  font-size: 14px;
  line-height: 1.5;
}

/* Footer */
.login-footer {
  padding: 20px;
  background: #f5f5f5;
  border-top: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.footer-content {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #666;
  font-size: 14px;
}

.footer-content mat-icon {
  color: #4caf50;
}

.version {
  color: #999;
  font-size: 12px;
}

/* Animaciones */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Responsive */
@media (max-width: 600px) {
  .login-container {
    padding: 10px;
  }
  
  .login-card {
    max-width: 100%;
  }
  
  .login-header {
    padding: 30px 20px;
  }
  
  .login-header h1 {
    font-size: 1.5rem;
  }
  
  .form-container {
    padding: 20px;
  }
  
  .modo-selector {
    padding: 0 10px;
  }
  
  .modo-selector button {
    padding: 15px;
    font-size: 14px;
  }
  
  .info-section {
    margin: 0 20px 20px;
  }
  
  .login-footer {
    flex-direction: column;
    gap: 10px;
    text-align: center;
  }
}
/* login.component.css - Agregar estos estilos */

/* Hint para ejemplo */
.ejemplo-hint {
  color: #4caf50;
  font-weight: 500;
}

/* Bot贸n de ejemplo */
.ejemplo-btn {
  border-color: #4caf50;
  color: #4caf50;
}

.ejemplo-btn:hover {
  background: #e8f5e9;
}

/* Bot贸n copiar */
.form-actions button[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Mensajes de alerta */
.mensaje-alerta {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: 8px;
  margin-top: 20px;
  animation: fadeIn 0.3s ease;
}

.mensaje-alerta.error {
  background: #ffebee;
  border: 1px solid #f44336;
  color: #c62828;
}

.mensaje-alerta:not(.error) {
  background: #e8f5e9;
  border: 1px solid #4caf50;
  color: #2e7d32;
}

.mensaje-alerta mat-icon {
  flex-shrink: 0;
}

/* Formato nota */
.formato-nota {
  margin-top: 5px;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  color: #666;
  background: #f5f5f5;
  padding: 4px 8px;
  border-radius: 4px;
  display: inline-block;
}

/* Animaci贸n para fade in */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Mejoras responsive */
@media (max-width: 600px) {
  .form-actions {
    flex-direction: column;
  }
  
  .form-actions button {
    width: 100%;
  }
  
  .recordatorio {
    padding: 12px;
  }
  
  .recordatorio p {
    font-size: 13px;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\modal-asegurado\modal-asegurado.ts 
============================================================================== 

import { Component, Inject, OnInit, inject, ChangeDetectorRef } from '@angular/core';
import { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';
import { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';
import { AseguradoExamen, AseguradoBackend } from '../../../../interface/examen.interface'; // Cambiar import
import { AseguradosService } from '../../../../core/service/asegurados.service';
import { catchError, finalize, map } from 'rxjs/operators';
import { of } from 'rxjs';
import { MAT_DATE_FORMATS, MAT_DATE_LOCALE, DateAdapter } from '@angular/material/core';
import { MAT_MOMENT_DATE_ADAPTER_OPTIONS, MomentDateAdapter } from '@angular/material-moment-adapter';
import { SharedMaterialModule } from '../../../../shared/modules/material.module';
import { BusquedaAseguradoResponse } from '../../../../interface/asegurado.interface';
import { AseguradoCreateDTO } from '../../../../core/service/examen-preocupacional.service'; // A帽adir este import




export const MY_DATE_FORMATS = {
  parse: {
    dateInput: 'DD/MM/YYYY',
  },
  display: {
    dateInput: 'DD/MM/YYYY',
    monthYearLabel: 'MMM YYYY',
    dateA11yLabel: 'LL',
    monthYearA11yLabel: 'MMMM YYYY',
  },
};

@Component({
  selector: 'app-modal-asegurado',
  imports: [SharedMaterialModule,ReactiveFormsModule],

  standalone: true,
  templateUrl: './modal-asegurado.html',
  styleUrl: './modal-asegurado.css',
  providers: [
    { provide: DateAdapter, useClass: MomentDateAdapter, deps: [MAT_DATE_LOCALE] },
    { provide: MAT_DATE_FORMATS, useValue: MY_DATE_FORMATS },
    { provide: MAT_MOMENT_DATE_ADAPTER_OPTIONS, useValue: { useUtc: true } }
  ]
})
export class ModalAsegurado implements OnInit {
  private apiAseguradosService = inject(AseguradosService);
  private cdRef = inject(ChangeDetectorRef);

  aseguradoForm: FormGroup;
  isLoading = false;
  busquedaRealizada = false;
  errorBusqueda: string | null = null;
  datosAsegurado: AseguradoBackend | null = null; // Cambiar tipo a AseguradoBackend
  puedeAgregar = false;

  constructor(
    private fb: FormBuilder,
    public dialogRef: MatDialogRef<ModalAsegurado>,
    @Inject(MAT_DIALOG_DATA) public data: { 
      maxAsegurados?: number;
      empresaId?: number;
      empresaNombre?: string;
      empresaNit?: string;
    }
  ) {
    this.aseguradoForm = this.fb.group({
      ci: ['', [Validators.required, Validators.pattern('^[0-9]{7,10}[A-Za-z]?$')]],
      fechaNacimiento: ['', Validators.required],
      correoElectronico: ['', [Validators.required, Validators.email]],
      celular: ['', [Validators.required, Validators.pattern('^[0-9]{8}$')]],
      empresa: [data.empresaNombre || '', Validators.required], // A帽adir campo empresa
      nitEmpresa: [data.empresaNit || '', Validators.required] // A帽adir campo nitEmpresa
    });

    setTimeout(() => {
      this.aseguradoForm.get('correoElectronico')?.markAsTouched();
      this.aseguradoForm.get('celular')?.markAsTouched();
      this.actualizarPuedeAgregar();
    }, 100);
  }

  ngOnInit(): void {
    this.aseguradoForm.valueChanges.subscribe(() => {
      this.actualizarPuedeAgregar();
    });
  }

  get ciError(): string {
    const ciControl = this.aseguradoForm.get('ci');
    if (ciControl?.hasError('required')) {
      return 'El CI es requerido';
    }
    if (ciControl?.hasError('pattern')) {
      return 'Formato: 7-10 d铆gitos + letra opcional';
    }
    return '';
  }

  maxFechaNacimiento(): Date {
    const fecha = new Date();
    fecha.setFullYear(fecha.getFullYear() - 18);
    return fecha;
  }

  puedeBuscar(): boolean {
    const ciValid = this.aseguradoForm.get('ci')?.valid ?? false;
    const fechaValid = this.aseguradoForm.get('fechaNacimiento')?.valid ?? false;
    return ciValid && fechaValid;
  }

  /**
   * Formatea fecha para la API (formato YYYY-MM-DD)
   */
  private formatFechaParaAPI(fecha: Date | string): string {
    if (!fecha) return '';

    let date: Date;

    if (typeof fecha === 'string' && fecha.includes('/')) {
      const [dia, mes, anio] = fecha.split('/').map(Number);
      date = new Date(Date.UTC(anio, mes - 1, dia, 12, 0, 0));
    } else {
      date = new Date(fecha);
    }

    const year = date.getUTCFullYear();
    const month = String(date.getUTCMonth() + 1).padStart(2, '0');
    const day = String(date.getUTCDate()).padStart(2, '0');

    return `${year}-${month}-${day}`;
  }

  /**
   * Mapea la respuesta del servicio a la interfaz AseguradoBackend
   */
  private mapearRespuestaApi(apiResponse: BusquedaAseguradoResponse, documento: string): AseguradoBackend | null {
  if (!apiResponse.success || !apiResponse.data) {
    this.errorBusqueda = apiResponse.message || 'No se encontr贸 un asegurado con los datos proporcionados';
    return null;
  }

  const datos = apiResponse.data;

  const nombreCompleto = datos.nombreCompleto ||
                        `${datos.nombres || ''} ${datos.paterno || ''} ${datos.materno || ''}`.trim();

  // Retornar objeto AseguradoBackend
  return {
    id: datos.aseguradoId || 0, // ID del asegurado en el backend
    ci: datos.documentoIdentidad || documento,
    nombreCompleto: nombreCompleto || 'Nombre no disponible',
    documentoIdentidad: datos.documentoIdentidad || documento,
    fechaNacimiento: datos.fechaNacimiento || this.formatFechaParaAPI(this.aseguradoForm.get('fechaNacimiento')?.value),
    correoElectronico: datos.correoElectronico || '',
    celular: datos.celular || '',
    empresa: datos.razonSocial || this.data.empresaNombre || 'No especificada',
    nitEmpresa: datos.nroPatronal || this.data.empresaNit || '',
    genero: datos.genero || 'N/D',
    cargo: datos.cargo || '',
    area: datos.area || '',
    fechaIngreso: datos.fechaIngreso || '',
    primerApellido: datos.paterno,
    segundoApellido: datos.materno,
    nombres: datos.nombres,
    estado: datos.estadoAsegurado,
    codigoAsegurado: datos.matricula,
    edad: this.calcularEdad(datos.fechaNacimiento),
    empresaId: datos.empresaId || this.data.empresaId
  };
}

  /**
   * Calcula la edad a partir de la fecha de nacimiento
   */
  private calcularEdad(fechaNacimiento: string): number | undefined {
    if (!fechaNacimiento) return undefined;

    try {
      const fechaNac = new Date(fechaNacimiento);
      const hoy = new Date();
      let edad = hoy.getFullYear() - fechaNac.getFullYear();
      const mes = hoy.getMonth() - fechaNac.getMonth();

      if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
        edad--;
      }

      return edad;
    } catch {
      return undefined;
    }
  }

  /**
   * Obtiene mensaje de error
   */
  private obtenerMensajeError(error: any): string {
    if (error.status === 404) {
      return 'No se encontr贸 un asegurado con el CI y fecha de nacimiento proporcionados';
    } else if (error.status === 401) {
      return 'Error de autenticaci贸n. Verifique las credenciales del servicio';
    } else if (error.status === 500) {
      return 'Error interno del servidor. Intente nuevamente m谩s tarde';
    } else if (error.status === 0) {
      return 'Error de conexi贸n. Verifique su conexi贸n a internet';
    }
    return error.message || 'Error al buscar asegurado';
  }

  /**
   * Actualiza si se puede agregar el asegurado
   */
  actualizarPuedeAgregar(): void {
    const tieneDatos = !!this.datosAsegurado;

    const correoControl = this.aseguradoForm.get('correoElectronico');
    const celularControl = this.aseguradoForm.get('celular');

    const correoValido = Boolean(
      correoControl?.valid &&
      correoControl.value?.trim().length > 0
    );

    const celularValido = Boolean(
      celularControl?.valid &&
      celularControl.value?.toString().length === 8
    );

    const empresaValida = this.aseguradoForm.get('empresa')?.valid ?? false;
    const nitEmpresaValido = this.aseguradoForm.get('nitEmpresa')?.valid ?? false;

    this.puedeAgregar = tieneDatos && correoValido && celularValido && empresaValida && nitEmpresaValido;
    this.cdRef.detectChanges();
  }

  /**
   * Agrega el asegurado y cierra el modal
   */
  agregarAsegurado(): void {
  if (!this.puedeAgregar || !this.datosAsegurado) {
    return;
  }

  // Formatear fecha correctamente
  const fechaNacimiento = this.datosAsegurado.fechaNacimiento;
  const fechaFormateada = this.formatFechaParaAPI(fechaNacimiento);
  
  // Crear AseguradoCreateDTO para enviar al componente padre
  const aseguradoDTO: AseguradoCreateDTO = {
    aseguradoId: this.datosAsegurado.id || 0,
    ci: this.aseguradoForm.get('ci')?.value || '',
    nombreCompleto: this.datosAsegurado.nombreCompleto || '',
    fechaNacimiento: fechaFormateada, // Usar fecha formateada
    genero: this.datosAsegurado.genero,
    correoElectronico: this.aseguradoForm.get('correoElectronico')?.value?.trim() || '',
    celular: this.aseguradoForm.get('celular')?.value?.toString() || '',
    empresa: this.aseguradoForm.get('empresa')?.value || '',
    nitEmpresa: this.aseguradoForm.get('nitEmpresa')?.value || ''
  };

  this.dialogRef.close(aseguradoDTO);
}

  cancelar(): void {
    this.dialogRef.close();
  }

  /**
   * Busca asegurado en la API
   */
  buscarAsegurado(): void {
    if (!this.puedeBuscar()) return;

    this.isLoading = true;
    this.busquedaRealizada = false;
    this.errorBusqueda = null;
    this.datosAsegurado = null;
    this.puedeAgregar = false;

    this.cdRef.detectChanges();

    const documento = this.aseguradoForm.get('ci')?.value || '';
    const fechaNacimiento = this.aseguradoForm.get('fechaNacimiento')?.value;
    const fechaFormateada = this.formatFechaParaAPI(fechaNacimiento);

    this.apiAseguradosService.buscarAsegurado(documento, fechaFormateada)
      .pipe(
        map((response: BusquedaAseguradoResponse) => {
          return this.mapearRespuestaApi(response, documento);
        }),
        catchError(error => {
          this.errorBusqueda = this.obtenerMensajeError(error);
          return of(null);
        }),
        finalize(() => {
          this.isLoading = false;
          this.busquedaRealizada = true;
          
          // Si no se encontr贸 asegurado, habilitar campos para completar manualmente
          if (!this.datosAsegurado) {
            this.aseguradoForm.get('empresa')?.enable();
            this.aseguradoForm.get('nitEmpresa')?.enable();
          } else {
            // Si se encontr贸, completar los campos con los datos del backend
            this.aseguradoForm.patchValue({
              empresa: this.datosAsegurado.empresa || this.data.empresaNombre || '',
              nitEmpresa: this.datosAsegurado.nitEmpresa || this.data.empresaNit || ''
            });
          }
          
          this.actualizarPuedeAgregar();
          this.cdRef.detectChanges();
        })
      )
      .subscribe(asegurado => {
        if (asegurado) {
          this.datosAsegurado = asegurado;
          this.actualizarPuedeAgregar();
        }
      });
  }

  /**
   * Valida el campo de correo electr贸nico
   */
  validarCorreo(): void {
    const control = this.aseguradoForm.get('correoElectronico');
    const valor = control?.value?.trim();

    if (!valor || valor.length === 0) {
      control?.setErrors({ 'required': true });
    } else {
      const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      if (!emailRegex.test(valor)) {
        control?.setErrors({ 'email': true });
      } else {
        control?.setErrors(null);
      }
    }

    control?.markAsTouched();
    this.actualizarPuedeAgregar();
  }

  /**
   * Valida el celular
   */
  validarCelular(): void {
    const control = this.aseguradoForm.get('celular');
    let valor = control?.value?.toString().replace(/\D/g, '') || '';

    if (!valor || valor.length === 0) {
      control?.setErrors({ 'required': true });
    } else if (valor.length !== 8) {
      control?.setErrors({ 'pattern': true });
    } else {
      control?.setValue(valor, { emitEvent: true });
      control?.setErrors(null);
    }

    control?.markAsTouched();
    this.actualizarPuedeAgregar();
  }

  /**
   * Crea un nuevo asegurado si no existe en el backend
   */
  crearNuevoAsegurado(): void {
    if (!this.datosAsegurado) {
      // Si no se encontr贸 el asegurado, crear uno nuevo localmente
      this.datosAsegurado = {
        id: 0, // ID 0 indica que no existe en el backend
        ci: this.aseguradoForm.get('ci')?.value || '',
        nombreCompleto: '',
        documentoIdentidad: this.aseguradoForm.get('ci')?.value || '',
        fechaNacimiento: this.formatFechaParaAPI(this.aseguradoForm.get('fechaNacimiento')?.value),
        correoElectronico: '',
        celular: '',
        empresa: this.aseguradoForm.get('empresa')?.value || '',
        nitEmpresa: this.aseguradoForm.get('nitEmpresa')?.value || '',
        cargo: '',
        area: '',
        fechaIngreso: '',
        genero: 'N/D',
        estado: 'ACTIVO'
      };
      
      this.mostrarMensaje('Complete los datos del asegurado manualmente');
      this.actualizarPuedeAgregar();
    }
  }

  private mostrarMensaje(mensaje: string): void {
    // Puedes implementar un snackbar o simplemente mostrar en consola
    console.log(mensaje);
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\modal-asegurado\modal-asegurado.html 
============================================================================== 
<div class="modal-container">
  <!-- Encabezado -->
  <div mat-dialog-title class="modal-header">
    <h2>
      <mat-icon>person_add</mat-icon>
      Registrar Asegurado
    </h2>
    <button mat-icon-button mat-dialog-close aria-label="Cerrar">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Contenido -->
  <mat-dialog-content class="modal-content">
    
    <!-- Secci贸n de B煤squeda -->
    <div class="section">
      <div class="section-title">
        <mat-icon>search</mat-icon>
        Buscar Asegurado
      </div>
      <p class="section-description">
        Ingrese el CI y fecha de nacimiento para buscar en el sistema CNS
      </p>

      <form [formGroup]="aseguradoForm">
        <div class="form-row">
          <!-- CI -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>CI </mat-label>
            <input matInput formControlName="ci" 
                   placeholder="Ej: 1234567"
                   [maxlength]="11">
            <mat-icon matSuffix>badge</mat-icon>
            @if (aseguradoForm.get('ci')?.hasError('required')) {
              <mat-error>El CI es requerido</mat-error>
            }
            @if (aseguradoForm.get('ci')?.hasError('pattern')) {
              <mat-error>Formato inv谩lido</mat-error>
            }
          </mat-form-field>

          <!-- Fecha de Nacimiento -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Fecha de Nacimiento </mat-label>
            <input matInput [matDatepicker]="picker" 
                   formControlName="fechaNacimiento"
                   [max]="maxFechaNacimiento()"
                   placeholder="dd/mm/aaaa">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <!-- <mat-icon matSuffix></mat-icon> -->
            @if (aseguradoForm.get('fechaNacimiento')?.hasError('required')) {
              <mat-error>La fecha es requerida</mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Bot贸n de B煤squeda -->
        <div class="search-button-container">
          <button mat-raised-button color="primary" 
                  class="search-button"
                  (click)="buscarAsegurado()"
                  [disabled]="!puedeBuscar() || isLoading">
            @if (isLoading) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Buscando...</span>
            } @else {
              <mat-icon>search</mat-icon>
              <span>Buscar Asegurado</span>
            }
          </button>
        </div>
      </form>
    </div>

    <!-- Resultados de B煤squeda -->
    <div class="result-container">
      @if (isLoading) {
        <div class="loading-state">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Consultando informaci贸n del asegurado...</p>
        </div>
      }

      @if (errorBusqueda && busquedaRealizada) {
        <div class="section error-result">
          <div class="result-header">
            <mat-icon class="error-icon">error_outline</mat-icon>
            <h4>No se encontr贸 el asegurado</h4>
          </div>
          <p>{{ errorBusqueda }}</p>
        </div>
      }

      @if (datosAsegurado && !errorBusqueda) {
        <div class="section success-result">
          <div class="result-header">
            <mat-icon class="success-icon">check_circle</mat-icon>
            <h4>Asegurado Encontrado </h4>
          </div>

          <div class="result-details">
            <div class="detail-item">
              <mat-icon>person_outline</mat-icon>
              <div class="detail-content">
                <strong>Nombre Completo</strong>
                <span>{{ datosAsegurado.nombreCompleto }}</span>
              </div>
            </div>

            <div class="detail-item">
              <mat-icon>fingerprint</mat-icon>
              <div class="detail-content">
                <strong>CI</strong>
                <span>{{ datosAsegurado.ci }}</span>
              </div>
            </div>

            @if (datosAsegurado.empresa) {
              <div class="detail-item">
                <mat-icon>business</mat-icon>
                <div class="detail-content">
                  <strong>Empresa</strong>
                  <span>{{ datosAsegurado.empresa }}</span>
                </div>
              </div>
            }
          </div>

          <!-- Mensaje informativo -->
          <!-- <div class="info-message">
            <mat-icon>info</mat-icon>
            <p>Ahora complete los datos de contacto obligatorios para agregar el asegurado</p>
          </div> -->
        </div>
      }
    </div>

    <!-- Secci贸n de Contacto (SOLO se muestra si hay datos del API) -->
  <!-- En modal-asegurado.html, modifica la secci贸n de contacto: -->
@if (datosAsegurado && !errorBusqueda && busquedaRealizada) {
  <div class="section contact-section">
    <div class="section-title">
      <mat-icon>contact_mail</mat-icon>
      Datos de Contacto *
    </div>
    <p class="section-description">
      <strong>Complete estos datos obligatoriamente</strong> para registrar al asegurado
    </p>

    <form [formGroup]="aseguradoForm">
      <div class="form-row">
        <!-- Correo Electr贸nico -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Correo Electr贸nico </mat-label>
          <input matInput type="email" formControlName="correoElectronico"
                 placeholder="ejemplo@email.com"
                 (input)="validarCorreo()"
                 (blur)="validarCorreo()">
          <mat-icon matSuffix>alternate_email</mat-icon>
          
          @if (aseguradoForm.get('correoElectronico')?.hasError('required')) {
            <mat-error class="error-message">El correo es requerido</mat-error>
          }
          @if (aseguradoForm.get('correoElectronico')?.hasError('email')) {
            <mat-error class="error-message">Ingrese un correo v谩lido</mat-error>
          }
          <mat-hint>Ej: mariarosavedia@gmail.com</mat-hint>
        </mat-form-field>

        <!-- Celular -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Celular </mat-label>
          <input matInput formControlName="celular"
                 placeholder="77777777"
                 [maxlength]="8"
                 (input)="validarCelular()"
                 (blur)="validarCelular()">
          <mat-icon matSuffix>smartphone</mat-icon>
          
          @if (aseguradoForm.get('celular')?.hasError('required')) {
            <mat-error class="error-message">El celular es requerido</mat-error>
          }
          @if (aseguradoForm.get('celular')?.hasError('pattern')) {
            <mat-error class="error-message">Debe tener 8 d铆gitos</mat-error>
          }
          <mat-hint>8 d铆gitos sin espacios</mat-hint>
        </mat-form-field>
      </div>
    </form>

    <!-- Estado de validaci贸n con m谩s detalles -->
    <div class="validation-status" [class.valid]="puedeAgregar">
      @if (puedeAgregar) {
        <mat-icon class="status-icon">check_circle</mat-icon>
        <span> Todos los datos est谩n completos. Puede agregar el asegurado.</span>
      } @else {
        <mat-icon class="status-icon">error_outline</mat-icon>
        <span *ngIf="!aseguradoForm.get('correoElectronico')?.valid">
           Correo electr贸nico inv谩lido o faltante<br>
        </span>
        <span *ngIf="!aseguradoForm.get('celular')?.valid">
           Celular debe tener 8 d铆gitos<br>
        </span>
      }
    </div>
  </div>
}
  </mat-dialog-content>

  <!-- Acciones -->
  <mat-dialog-actions class="modal-actions">
    <button mat-button mat-dialog-close class="cancel-button action-button">
      <mat-icon>cancel</mat-icon>
      Cancelar
    </button>
    
    <button mat-raised-button color="primary"
            class="submit-button action-button"
            [disabled]="!puedeAgregar"
            (click)="agregarAsegurado()">
      <mat-icon>person_add_alt</mat-icon>
      Agregar Asegurado
    </button>
  </mat-dialog-actions>
</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\modal-asegurado\modal-asegurado.css 
============================================================================== 
/* ===== ESTILOS UNIFICADOS PARA MODAL ASEGURADO ===== */

:host {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Contenedor principal */
.modal-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  min-width: 600px;
  max-width: 800px;
  overflow: hidden;
  font-family: 'Roboto', 'Segoe UI', sans-serif;
}

/* Encabezado */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 30px;
  background: linear-gradient(135deg, #3f51b5 0%, #2196f3 100%);
  color: white;
  position: relative;
}

.modal-header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #ff4081, #ff9800);
}

.modal-header h2 {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 0;
  font-size: 1.8rem;
  font-weight: 500;
  letter-spacing: 0.5px;
}

.modal-header mat-icon {
  font-size: 28px;
  width: 28px;
  height: 28px;
}

.modal-header button {
  color: white;
  transition: transform 0.2s ease;
}

.modal-header button:hover {
  transform: scale(1.1);
  background: rgba(255, 255, 255, 0.1);
}

/* Contenido */
.modal-content {
  padding: 30px;
  max-height: 70vh;
  overflow-y: auto;
  background: #f8f9fa;
}

/* Secciones */
.section {
  background: white;
  border-radius: 10px;
  padding: 24px;
  margin-bottom: 24px;
  border: 1px solid #e0e0e0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  transition: box-shadow 0.3s ease;
}

.section:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.section-title {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #3f51b5;
  margin: 0 0 20px 0;
  font-size: 1.2rem;
  font-weight: 500;
  padding-bottom: 12px;
  border-bottom: 2px solid #e8eaf6;
}

.section-title mat-icon {
  font-size: 24px;
  width: 24px;
  height: 24px;
}

.section-description {
  color: #666;
  margin: 0 0 20px 0;
  font-size: 14px;
  line-height: 1.6;
  padding: 0 4px;
}

/* Formulario */
.form-row {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}

.form-field {
  flex: 1;
}

::ng-deep .mat-mdc-form-field {
  width: 100%;
}

::ng-deep .mat-mdc-text-field-wrapper {
  background: #f8f9fa !important;
  border-radius: 8px !important;
}

::ng-deep .mat-mdc-form-field-outline {
  border-radius: 8px !important;
}

::ng-deep .mat-mdc-form-field-outline-thick {
  color: #3f51b5 !important;
}

/* Bot贸n de b煤squeda */
.search-button-container {
  text-align: center;
  margin: 30px 0 20px;
}

.search-button {
  min-width: 220px;
  height: 48px;
  font-size: 16px;
  font-weight: 500;
  border-radius: 8px;
  background: linear-gradient(135deg, #3f51b5 0%, #2196f3 100%);
  color: white;
  transition: all 0.3s ease;
}

.search-button:hover:not([disabled]) {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(63, 81, 181, 0.3);
}

.search-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Estados de carga */
.loading-state {
  text-align: center;
  padding: 40px;
  color: #666;
  background: #f8f9fa;
  border-radius: 10px;
  margin: 20px 0;
}

.loading-state mat-spinner {
  margin: 0 auto 20px;
}

.loading-state p {
  margin: 0;
  font-size: 15px;
  font-weight: 500;
}

/* Resultados */
.result-container {
  animation: fadeInUp 0.5s ease;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.success-result,
.error-result {
  border-radius: 10px;
  padding: 24px;
  margin-bottom: 24px;
}

.success-result {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  border: 2px solid #4caf50;
}

.error-result {
  background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
  border: 2px solid #f44336;
}

.result-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.result-header h4 {
  margin: 0;
  font-size: 1.3rem;
  font-weight: 500;
}

.success-icon {
  color: #4caf50;
  font-size: 28px;
  width: 28px;
  height: 28px;
}

.error-icon {
  color: #f44336;
  font-size: 28px;
  width: 28px;
  height: 28px;
}

/* Detalles del asegurado */
.result-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
}

.detail-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 16px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease;
}

.detail-item:hover {
  transform: translateY(-2px);
}

.detail-item mat-icon {
  color: #3f51b5;
  font-size: 20px;
  width: 20px;
  height: 20px;
  margin-top: 2px;
}

.detail-content {
  flex: 1;
}

.detail-content strong {
  display: block;
  color: #555;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

.detail-content span {
  color: #333;
  font-size: 15px;
  font-weight: 500;
  line-height: 1.4;
}

/* Estados */
.estado-activo {
  color: #4caf50;
  font-weight: 600;
  padding: 4px 12px;
  background: #e8f5e9;
  border-radius: 20px;
  display: inline-block;
}

.estado-inactivo {
  color: #f44336;
  font-weight: 600;
  padding: 4px 12px;
  background: #ffebee;
  border-radius: 20px;
  display: inline-block;
}

/* Secci贸n de contacto */
.contact-section {
  background: linear-gradient(135deg, #f3e5f5 0%, #e8eaf6 100%);
}

/* Acciones del modal */
.modal-actions {
  padding: 20px 30px;
  background: #f5f5f5;
  border-top: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.action-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 24px;
  font-size: 15px;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.cancel-button {
  color: #666;
  background: #f0f0f0;
}

.cancel-button:hover {
  background: #e0e0e0;
  color: #333;
}

.submit-button {
  background: linear-gradient(135deg, #3f51b5 0%, #2196f3 100%);
  color: white;
  min-width: 180px;
}

.submit-button:hover:not([disabled]) {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(63, 81, 181, 0.3);
}

.submit-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Responsive */
@media (max-width: 768px) {
  .modal-container {
    min-width: 90vw;
    max-width: 95vw;
    margin: 10px;
  }
  
  .modal-content {
    padding: 20px;
  }
  
  .form-row {
    flex-direction: column;
    gap: 15px;
  }
  
  .result-details {
    grid-template-columns: 1fr;
  }
  
  .modal-actions {
    flex-direction: column;
    gap: 10px;
  }
  
  .modal-actions button {
    width: 100%;
  }
}

/* Animaciones */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.search-button:not([disabled]):hover {
  animation: pulse 2s infinite;
}

/* Scrollbar personalizado */
.modal-content::-webkit-scrollbar {
  width: 8px;
}

.modal-content::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

.modal-content::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.modal-content::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Mensaje informativo */
.info-message {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 15px;
  background: #e3f2fd;
  border-radius: 8px;
  margin-top: 20px;
  border-left: 4px solid #2196f3;
}

.info-message mat-icon {
  color: #2196f3;
}

.info-message p {
  margin: 0;
  font-size: 14px;
  color: #1565c0;
  font-weight: 500;
}

/* Estado de validaci贸n mejorado */
.validation-status {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: #fff3e0;
  border-radius: 8px;
  margin-top: 20px;
  font-size: 14px;
  border: 1px solid #ffb74d;
}

.validation-status.valid {
  background: #e8f5e9;
  border-color: #4caf50;
  color: #2e7d32;
}

.validation-status .status-icon {
  font-size: 24px;
  width: 24px;
  height: 24px;
}

.validation-status.valid .status-icon {
  color: #4caf50;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

/* Campos obligatorios con indicador m谩s claro */
.form-field.required label::after {
  content: " *";
  color: #f44336;
}

/* Mejor feedback para campos inv谩lidos */
mat-form-field.ng-invalid.ng-touched .mat-form-field-outline {
  border-color: #f44336 !important;
}

mat-form-field.ng-valid.ng-touched .mat-form-field-outline {
  border-color: #4caf50 !important;
}


/* A帽ade al final de modal-asegurado.css */

/* Mejor feedback visual para campos */
mat-form-field.ng-invalid.ng-touched .mat-form-field-outline {
  border-color: #f44336 !important;
  border-width: 2px !important;
}

mat-form-field.ng-valid.ng-touched .mat-form-field-outline {
  border-color: #4caf50 !important;
}

/* Bot贸n deshabilitado m谩s claro */
.submit-button:disabled {
  opacity: 0.5;
  background: #cccccc !important;
  color: #666666 !important;
  cursor: not-allowed;
}

/* Debug info */
.debug-info {
  background: #f8f9fa;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 10px;
  margin-top: 10px;
  font-size: 12px;
  color: #666;
}

.debug-info pre {
  margin: 5px 0;
  white-space: pre-wrap;
}

/* A帽ade al final de modal-asegurado.css */

/* Mejor feedback visual para campos */
mat-form-field.ng-invalid.ng-touched .mat-form-field-outline {
  border-color: #f44336 !important;
  border-width: 2px !important;
}

mat-form-field.ng-valid.ng-touched .mat-form-field-outline {
  border-color: #4caf50 !important;
}

/* Bot贸n deshabilitado m谩s claro */
.submit-button:disabled {
  opacity: 0.5;
  background: #cccccc !important;
  color: #666666 !important;
  cursor: not-allowed;
}

/* Debug info */
.debug-info {
  background: #f8f9fa;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 10px;
  margin-top: 10px;
  font-size: 12px;
  color: #666;
}

.debug-info pre {
  margin: 5px 0;
  white-space: pre-wrap;
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso1-datos-recibo\paso1-datos-recibo.ts 
============================================================================== 
// features/examen-preocupacional/components/paso1-datos-recibo/paso1-datos-recibo.component.ts
import { Component, Input, Output, EventEmitter, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { FormGroup } from '@angular/forms';
import { SharedMaterialModule } from '../../../../shared/modules/material.module';

@Component({
  selector: 'app-paso1-datos-recibo',
  standalone: true,
  imports: [CommonModule,SharedMaterialModule,ReactiveFormsModule],
  templateUrl: './paso1-datos-recibo.html',
  styleUrls: ['./paso1-datos-recibo.css']
})
export class Paso1DatosRecibo{
  @Input() form!: FormGroup;
  @Output() fileSelected = new EventEmitter<File>();
  @Output() fileRemoved = new EventEmitter<void>();
  
  imagenPreview: string | null = null;

  onFileSelected(event: any): void {
    const file = event.target.files[0];
    if (this.validateFile(file)) {
      this.fileSelected.emit(file);
      this.generatePreview(file);
    }
  }

  removeFile(): void {
    this.imagenPreview = null;
    this.fileRemoved.emit();
  }

  private validateFile(file: File): boolean {
    const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
    const maxSize = 5 * 1024 * 1024; // 5MB
    
    if (!validTypes.includes(file.type)) {
      alert('Solo se permiten im谩genes (JPG, PNG) o PDF');
      return false;
    }
    
    if (file.size > maxSize) {
      alert('El archivo no debe superar los 5MB');
      return false;
    }
    
    return true;
  }

  private generatePreview(file: File): void {
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = () => {
        this.imagenPreview = reader.result as string;
      };
      reader.readAsDataURL(file);
    }
  }

  getErrorMessage(controlName: string): string {
    const control = this.form.get(controlName);
    
    if (control?.hasError('required')) {
      return 'Este campo es obligatorio';
    }
    
    if (control?.hasError('pattern')) {
      return 'Formato inv谩lido';
    }
    
    if (control?.hasError('email')) {
      return 'Ingrese un correo v谩lido';
    }
    
    return '';
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso1-datos-recibo\paso1-datos-recibo.html 
============================================================================== 
<div class="paso1-container">
  
  <!-- T铆tulo del paso -->
  <div class="paso-header">
    <h3 class="paso-title">
      <mat-icon>receipt</mat-icon>
      Datos del Recibo
    </h3>
    <p class="paso-description">
      Complete la informaci贸n del recibo de examen preocupacional
    </p>
  </div>

  <!-- Formulario -->
  <form [formGroup]="form" class="paso-form">
    
    <!-- Fila 1: N煤mero de recibo y Total importe -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field required-field">
        <mat-label>N煤mero de Recibo</mat-label>
        <input matInput 
               formControlName="numeroRecibo" 
               placeholder="Ej: 019393">
        <mat-icon matSuffix>tag</mat-icon>
        
        @if (form.get('numeroRecibo')?.hasError('required')) {
          <mat-error>El n煤mero de recibo es requerido</mat-error>
        }
        @if (form.get('numeroRecibo')?.hasError('pattern')) {
          <mat-error>Formato inv谩lido (solo n煤meros y guiones)</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field required-field">
        <mat-label>Total Importe</mat-label>
        <input matInput 
               type="number" 
               formControlName="totalImporte" 
               placeholder="0.00">
        <span matPrefix> Bs. &nbsp;</span>
        <mat-icon matSuffix>attach_money</mat-icon>
        
        @if (form.get('totalImporte')?.hasError('required')) {
          <mat-error>El importe es requerido</mat-error>
        }
        @if (form.get('totalImporte')?.hasError('min')) {
          <mat-error>El importe debe ser mayor a 0</mat-error>
        }
      </mat-form-field>
    </div>

    <!-- Cantidad de asegurados -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field required-field">
        <mat-label>Cantidad de Asegurados</mat-label>
        <input matInput 
               type="number" 
               formControlName="cantidadAsegurados" 
               [min]="1"
               placeholder="Ej: 5">
        <mat-icon matSuffix>people</mat-icon>
        
        @if (form.get('cantidadAsegurados')?.hasError('required')) {
          <mat-error>La cantidad es requerida</mat-error>
        }
        @if (form.get('cantidadAsegurados')?.hasError('min')) {
          <mat-error>M铆nimo 1 asegurado</mat-error>
        }
        
        <mat-hint>
          @if (form.get('cantidadAsegurados')?.value > 1) {
            Requiere datos de contacto del empleador
          }
        </mat-hint>
      </mat-form-field>
    </div>

    <!-- Campos condicionales para m谩s de 1 asegurado -->
    @if (form.get('cantidadAsegurados')?.value > 1) {
      <div class="conditional-section">
        <div class="section-header">
          <mat-icon>info</mat-icon>
          <p>Para m煤ltiples asegurados, se requiere informaci贸n de contacto del empleador</p>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field required-field">
            <mat-label>Correo Electr贸nico del Empleador</mat-label>
            <input matInput 
                   type="email" 
                   formControlName="correoEmpleador" 
                   placeholder="empleador@empresa.com">
            <mat-icon matSuffix>email</mat-icon>
            
            @if (form.get('correoEmpleador')?.hasError('required')) {
              <mat-error>El correo es requerido</mat-error>
            }
            @if (form.get('correoEmpleador')?.hasError('email')) {
              <mat-error>Ingrese un correo v谩lido</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field required-field">
            <mat-label>Celular del Empleador</mat-label>
            <input matInput 
                   formControlName="celularEmpleador" 
                   placeholder="72882569">
            <mat-icon matSuffix>phone</mat-icon>
            
            @if (form.get('celularEmpleador')?.hasError('required')) {
              <mat-error>El celular es requerido</mat-error>
            }
            @if (form.get('celularEmpleador')?.hasError('pattern')) {
              <mat-error>Debe tener 8 d铆gitos</mat-error>
            }
          </mat-form-field>
        </div>
      </div>
    }

    <!-- Subida de archivo -->
    <div class="file-upload-section">
      <div class="section-header">
        <mat-icon>cloud_upload</mat-icon>
        <div>
          <h4>Subir Imagen del Recibo</h4>
          <p class="section-description">Formato: JPG, PNG o PDF (M谩ximo 5MB)</p>
        </div>
      </div>

      <div class="upload-container">
        <!-- Input file oculto -->
        <input type="file" 
               #fileInput
               hidden
               (change)="onFileSelected($event)"
               accept="image/*,.pdf">
        
        <!-- Bot贸n de selecci贸n -->
        <button mat-raised-button 
                color="primary" 
                type="button"
                (click)="fileInput.click()"
                class="upload-button">
          <mat-icon>upload</mat-icon>
          Seleccionar Archivo
        </button>

        <!-- Informaci贸n del archivo -->
        @if (form.get('imagenRecibo')?.value) {
          <div class="file-info">
            <div class="file-details">
              <mat-icon>description</mat-icon>
              <div>
                <span class="file-name">{{ form.get('imagenRecibo')?.value?.name }}</span>
                <span class="file-size">
                  {{ (form.get('imagenRecibo')?.value?.size / 1024 / 1024).toFixed(2) }} MB
                </span>
              </div>
            </div>
            <button mat-icon-button 
                    color="warn" 
                    type="button"
                    (click)="removeFile()"
                    matTooltip="Eliminar archivo">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        }
      </div>

      <!-- Preview de imagen -->
      @if (imagenPreview && form.get('imagenRecibo')?.value?.type?.startsWith('image/')) {
        <div class="image-preview">
          <p class="preview-label">Vista previa:</p>
          <div class="preview-container">
            <img [src]="imagenPreview" alt="Preview del recibo">
            <button mat-icon-button 
                    color="warn" 
                    class="preview-close"
                    (click)="removeFile()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      }

      <!-- Mensajes de error -->
      @if (form.get('imagenRecibo')?.invalid && form.get('imagenRecibo')?.touched) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>La imagen del recibo es obligatoria</span>
        </div>
      }
    </div>

  </form>
</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso1-datos-recibo\paso1-datos-recibo.css 
============================================================================== 
/* features/examen-preocupacional/components/paso1-datos-recibo/paso1-datos-recibo.component.css */

.paso1-container {
  padding: 20px;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.paso-header {
  margin-bottom: 30px;
}

.paso-title {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #3f51b5;
  margin: 0 0 10px 0;
  font-size: 1.3rem;
  font-weight: 500;
}

.paso-title mat-icon {
  font-size: 28px;
  width: 28px;
  height: 28px;
}

.paso-description {
  color: #666;
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
}

/* Formulario */
.paso-form {
  margin-top: 20px;
}

.form-row {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.form-field {
  flex: 1;
  min-width: 250px;
}

.full-width {
  width: 100%;
}

.required-field .mat-mdc-form-field-label::after {
  content: " *";
  color: #f44336;
}

/* Campos condicionales */
.conditional-section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin: 25px 0;
  border-left: 4px solid #2196f3;
}

.section-header {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 15px;
}

.section-header mat-icon {
  color: #2196f3;
  margin-top: 2px;
}

.section-header p {
  margin: 0;
  color: #1565c0;
  font-size: 14px;
  line-height: 1.5;
}

/* Subida de archivos */
.file-upload-section {
  margin-top: 30px;
  padding: 25px;
  background: #f5f5f5;
  border-radius: 10px;
  border: 2px dashed #ddd;
  transition: all 0.3s ease;
}

.file-upload-section:hover {
  border-color: #3f51b5;
  background: #f8f9fa;
}

.section-description {
  color: #666;
  font-size: 13px;
  margin: 5px 0 0 0;
}

.upload-container {
  display: flex;
  align-items: center;
  gap: 15px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.upload-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.upload-button:hover:not([disabled]) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(63, 81, 181, 0.2);
}

.file-info {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: white;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
  min-width: 300px;
}

.file-details {
  display: flex;
  align-items: center;
  gap: 12px;
}

.file-details mat-icon {
  color: #3f51b5;
}

.file-name {
  display: block;
  font-weight: 500;
  color: #333;
  margin-bottom: 4px;
  max-width: 250px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-size {
  display: block;
  font-size: 12px;
  color: #666;
}

/* Preview de imagen */
.image-preview {
  margin-top: 20px;
  animation: fadeIn 0.5s ease;
}

.preview-label {
  color: #666;
  font-size: 14px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.preview-container {
  position: relative;
  max-width: 300px;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid #ddd;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.preview-container img {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.3s ease;
}

.preview-container:hover img {
  transform: scale(1.02);
}

.preview-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.preview-close:hover {
  background: white;
  transform: scale(1.1);
}

/* Mensajes de error */
.error-message {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  background: #ffebee;
  border-radius: 6px;
  border: 1px solid #f44336;
  color: #c62828;
  font-size: 14px;
  margin-top: 10px;
  animation: shake 0.5s ease;
}

.error-message mat-icon {
  font-size: 20px;
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

/* Responsive */
@media (max-width: 768px) {
  .paso1-container {
    padding: 15px;
  }
  
  .form-row {
    flex-direction: column;
    gap: 15px;
  }
  
  .form-field {
    width: 100%;
    min-width: unset;
  }
  
  .upload-container {
    flex-direction: column;
    align-items: stretch;
  }
  
  .file-info {
    min-width: unset;
    width: 100%;
  }
  
  .preview-container {
    max-width: 100%;
  }
  
  .file-name {
    max-width: 200px;
  }
}

@media (max-width: 480px) {
  .paso-title {
    font-size: 1.1rem;
  }
  
  .paso-title mat-icon {
    font-size: 24px;
    width: 24px;
    height: 24px;
  }
  
  .upload-button {
    width: 100%;
    justify-content: center;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso2-asegurados\paso2-asegurados.ts 
============================================================================== 
// features/examen-preocupacional/components/paso2-asegurados/paso2-asegurados.component.ts
import { Component, Input, Output, EventEmitter, inject } from '@angular/core';
import { MatDialog } from '@angular/material/dialog';
import { AseguradoExamen } from '../../../../interface/examen.interface';
import { ModalAsegurado } from '../modal-asegurado/modal-asegurado';
import { SharedMaterialModule } from '../../../../shared/modules/material.module';

@Component({
  selector: 'app-paso2-asegurados',
  standalone: true,
  imports: [SharedMaterialModule],
  templateUrl: './paso2-asegurados.html',
  styleUrls: ['./paso2-asegurados.css']
})
export class Paso2Asegurados {
  @Input() asegurados: AseguradoExamen[] = [];
  @Input() archivosAsegurados: { [key: number]: { anverso: File | null, reverso: File | null } } = {};
  @Input() cantidadPermitida: number = 0;
  
  @Output() agregarAsegurado = new EventEmitter<any>();
  @Output() eliminarAsegurado = new EventEmitter<number>();
  @Output() fileSelected = new EventEmitter<{ aseguradoId: number, tipo: 'anverso' | 'reverso', file: File }>();

  private readonly dialog = inject(MatDialog);
  
  readonly displayedColumns = ['nombre', 'ci', 'correo', 'celular', 'archivos', 'acciones'];

  openAddAseguradoModal(): void {
    if (this.asegurados.length >= this.cantidadPermitida) {
      alert(`No puede agregar m谩s de ${this.cantidadPermitida} asegurados`);
      return;
    }

    const dialogRef = this.dialog.open(ModalAsegurado, {
      width: '700px',
      data: {
        maxAsegurados: this.cantidadPermitida - this.asegurados.length
      }
    });

    dialogRef.afterClosed().subscribe(result => {
      if (result) {
        this.agregarAsegurado.emit(result);
      }
    });
  }

  onFileSelected(event: any, aseguradoId: number, tipo: 'anverso' | 'reverso'): void {
    const file = event.target.files[0];
    if (file && this.validateFile(file)) {
      this.fileSelected.emit({ aseguradoId, tipo, file });
    }
  }

  private validateFile(file: File): boolean {
    const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
    const maxSize = 5 * 1024 * 1024;
    
    return validTypes.includes(file.type) && file.size <= maxSize;
  }

  getFileName(aseguradoId: number, tipo: 'anverso' | 'reverso'): string {
  // Manejar el caso donde aseguradoId podr铆a ser undefined
  if (!aseguradoId) return 'Sin archivo';
  
  const archivos = this.archivosAsegurados[aseguradoId];
  if (!archivos) return 'Sin archivo';
  
  const file = tipo === 'anverso' ? archivos.anverso : archivos.reverso;
  return file?.name || 'Sin archivo';
}

  contarCompletos(): number {
    return this.asegurados.filter(a => 
      a.correoElectronico?.trim() && a.celular?.trim()
    ).length;
  }

  contarConArchivos(): number {
    return this.asegurados.filter(asegurado => {
      const archivos = this.archivosAsegurados[asegurado.idTemporal || asegurado.aseguradoId];
      return archivos?.anverso && archivos?.reverso;
    }).length;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso2-asegurados\paso2-asegurados.html 
============================================================================== 
<div class="paso2-container">

    <!-- T铆tulo y agregar asegurados -->
    <div class="paso-header">
        <div class="header-content">
            <h3 class="paso-title">
                <mat-icon>person_add</mat-icon>
                Agregar Asegurados
            </h3>
            <div class="header-stats">
                <span class="stat-item">
                    <span class="stat-number">{{ asegurados.length }}</span>
                    <span class="stat-label">agregados</span>
                </span>
                <span class="stat-item">
                    <span class="stat-number">{{ cantidadPermitida }}</span>
                    <span class="stat-label">requeridos</span>
                </span>
            </div>
        </div>

        <p class="paso-description">
            Agregue los asegurados que realizar谩n el examen preocupacional
        </p>
    </div>

    <!-- Bot贸n para agregar -->
    <div class="add-button-container">
        <button mat-raised-button color="primary" (click)="openAddAseguradoModal()"
            [disabled]="asegurados.length >= cantidadPermitida" class="add-button">
            <mat-icon>add</mat-icon>
            Agregar Asegurado
            <!-- @if (cantidadPermitida > 0) {
            <span class="counter">({{ asegurados.length }}/{{ cantidadPermitida }})</span>
            } -->
        </button>
    </div>

    <!-- Tabla de asegurados -->
    @if (asegurados.length > 0) {
    <div class="table-container mat-elevation-z2">
        <table mat-table [dataSource]="asegurados" class="asegurados-table">

            <!-- Columna: Nombre -->
            <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef>Nombre Completo</th>
                <td mat-cell *matCellDef="let asegurado" class="nombre-cell">
                    <div class="nombre-content">
                        <mat-icon class="person-icon">person</mat-icon>
                        <span class="nombre-text">{{ asegurado.nombreCompleto }}</span>
                    </div>
                </td>
            </ng-container>

            <!-- Columna: CI -->
            <ng-container matColumnDef="ci">
                <th mat-header-cell *matHeaderCellDef>CI/NIT</th>
                <td mat-cell *matCellDef="let asegurado" class="ci-cell">
                    <span class="ci-text">{{ asegurado.ci }}</span>
                </td>
            </ng-container>

            <!-- Columna: Correo -->
            <ng-container matColumnDef="correo">
                <th mat-header-cell *matHeaderCellDef>Correo</th>
                <td mat-cell *matCellDef="let asegurado">
                    <div class="contact-cell">
                        <mat-icon class="contact-icon" [class.missing]="!asegurado.correoElectronico">
                            email
                        </mat-icon>
                        <span [class.missing]="!asegurado.correoElectronico">
                            {{ asegurado.correoElectronico || 'No asignado' }}
                        </span>
                    </div>
                </td>
            </ng-container>

            <!-- Columna: Celular -->
            <ng-container matColumnDef="celular">
                <th mat-header-cell *matHeaderCellDef>Celular</th>
                <td mat-cell *matCellDef="let asegurado">
                    <div class="contact-cell">
                        <mat-icon class="contact-icon" [class.missing]="!asegurado.celular">
                            phone
                        </mat-icon>
                        <span [class.missing]="!asegurado.celular">
                            {{ asegurado.celular || 'No asignado' }}
                        </span>
                    </div>
                </td>
            </ng-container>

            <!-- Columna: Archivos -->
            <ng-container matColumnDef="archivos">
                <th mat-header-cell *matHeaderCellDef>Formulario Gestora</th>
                <td mat-cell *matCellDef="let asegurado" class="archivos-cell">
                    <div class="archivos-container">
                        <!-- Anverso -->
                        <div class="archivo-item">
                            <input type="file" #anversoInput hidden
                                (change)="onFileSelected($event, asegurado.idTemporal || asegurado.aseguradoId, 'anverso')"
                                accept="image/*,.pdf">
                            <button mat-mini-fab color="primary" size="small"
                                [matTooltip]="getFileName(asegurado.idTemporal || asegurado.aseguradoId, 'anverso')"
                                (click)="anversoInput.click()" class="archivo-button">
                                <mat-icon>cloud_upload</mat-icon>
                            </button>
                            <div class="archivo-status">
                                <span class="archivo-label">A</span>
                                <span class="archivo-indicator"
                                    [class.complete]="getFileName(asegurado.idTemporal || asegurado.aseguradoId, 'anverso') !== 'Sin archivo'">
                                </span>
                            </div>
                        </div>

                        <!-- Reverso -->
                        <div class="archivo-item">
                            <input type="file" #reversoInput hidden
                                (change)="onFileSelected($event, asegurado.idTemporal || asegurado.aseguradoId, 'reverso')"
                                accept="image/*,.pdf">
                            <button mat-mini-fab color="primary" size="small"
                                [matTooltip]="getFileName(asegurado.idTemporal || asegurado.aseguradoId, 'reverso')"
                                (click)="reversoInput.click()" class="archivo-button">
                                <mat-icon>cloud_upload</mat-icon>
                            </button>
                            <div class="archivo-status">
                                <span class="archivo-label">R</span>
                                <span class="archivo-indicator"
                                    [class.complete]="getFileName(asegurado.idTemporal || asegurado.aseguradoId, 'reverso') !== 'Sin archivo'">
                                </span>
                            </div>
                        </div>
                    </div>
                </td>
            </ng-container>

            <!-- Columna: Acciones -->
            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let asegurado" class="acciones-cell">
                    <button mat-icon-button color="warn"
                        (click)="eliminarAsegurado.emit(asegurado.idTemporal || asegurado.aseguradoId)"
                        matTooltip="Eliminar asegurado" class="delete-button">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <!-- Header y rows -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>
    }

    <!-- Estado vac铆o -->
    @if (asegurados.length === 0) {
    <div class="empty-state">
        <mat-icon class="empty-icon">group</mat-icon>
        <h4 class="empty-title">No hay asegurados agregados</h4>
        <p class="empty-description">
            Use el bot贸n "Agregar Asegurado" para comenzar
        </p>
    </div>
    }

    <!-- Resumen de estado -->
    <!-- @if (asegurados.length > 0) {
    <div class="status-summary">
        <div class="summary-grid">
            <div class="summary-item">
                <span class="summary-number">{{ asegurados.length }}</span>
                <span class="summary-label">Total</span>
            </div>
            <div class="summary-item">
                <span class="summary-number">{{ contarCompletos() }}</span>
                <span class="summary-label">Con contacto</span>
            </div>
            <div class="summary-item">
                <span class="summary-number">{{ contarConArchivos() }}</span>
                <span class="summary-label">Con archivos</span>
            </div>
            <div class="summary-item">
                <span class="summary-number">{{ cantidadPermitida }}</span>
                <span class="summary-label">Requeridos</span>
            </div>
        </div>
    </div>
    } -->

</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso2-asegurados\paso2-asegurados.css 
============================================================================== 
/* features/examen-preocupacional/components/paso2-asegurados/paso2-asegurados.component.css */

.paso2-container {
  padding: 20px;
  animation: fadeIn 0.5s ease;
}

/* Header */
.paso-header {
  margin-bottom: 30px;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  flex-wrap: wrap;
  gap: 15px;
}

.paso-title {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #3f51b5;
  margin: 0;
  font-size: 1.3rem;
  font-weight: 500;
}

.paso-title mat-icon {
  font-size: 28px;
  width: 28px;
  height: 28px;
}

.header-stats {
  display: flex;
  gap: 20px;
  align-items: center;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #f5f5f5;
  padding: 8px 16px;
  border-radius: 8px;
  min-width: 80px;
}

.stat-number {
  font-size: 20px;
  font-weight: bold;
  color: #3f51b5;
  line-height: 1;
}

.stat-label {
  font-size: 11px;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 4px;
}

.paso-description {
  color: #666;
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
}

/* Bot贸n agregar */
.add-button-container {
  margin: 25px 0;
  text-align: center;
}

.add-button {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 28px;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.3s ease;
  margin: 0 auto;
}

.add-button:hover:not([disabled]) {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(63, 81, 181, 0.2);
}

.add-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.counter {
  font-size: 12px;
  background: rgba(255, 255, 255, 0.2);
  padding: 2px 8px;
  border-radius: 10px;
  margin-left: 5px;
}

/* Tabla */
.table-container {
  margin: 30px 0;
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
  background: white;
}

.asegurados-table {
  width: 100%;
  min-width: 800px;
}

/* Estilos de columnas */
.nombre-cell {
  min-width: 200px;
}

.nombre-content {
  display: flex;
  align-items: center;
  gap: 10px;
}

.person-icon {
  color: #3f51b5;
  font-size: 20px;
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

.nombre-text {
  font-weight: 500;
  color: #333;
}

.ci-cell {
  min-width: 120px;
}

.ci-text {
  font-family: 'Courier New', monospace;
  font-weight: 600;
  color: #666;
  background: #f5f5f5;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 13px;
}

.contact-cell {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 150px;
}

.contact-icon {
  font-size: 18px;
  width: 18px;
  height: 18px;
  color: #4caf50;
  flex-shrink: 0;
}

.contact-icon.missing {
  color: #f44336;
}

.missing {
  color: #f44336;
  font-style: italic;
}

/* Columna de archivos */
.archivos-cell {
  min-width: 180px;
}

.archivos-container {
  display: flex;
  gap: 15px;
  align-items: center;
}

.archivo-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

.archivo-button {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.archivo-button:hover {
  transform: scale(1.1);
}

.archivo-status {
  display: flex;
  align-items: center;
  gap: 4px;
}

.archivo-label {
  font-size: 11px;
  font-weight: bold;
  color: #666;
  text-transform: uppercase;
}

.archivo-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #f44336;
  transition: background 0.3s ease;
}

.archivo-indicator.complete {
  background: #4caf50;
}

/* Columna de acciones */
.acciones-cell {
  min-width: 80px;
}

.delete-button {
  color: #f44336;
  transition: all 0.3s ease;
}

.delete-button:hover {
  background: #ffebee;
  transform: scale(1.1);
}

/* Estado vac铆o */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #666;
  border: 2px dashed #ddd;
  border-radius: 12px;
  margin: 30px 0;
  background: #fafafa;
  animation: fadeIn 0.5s ease;
}

.empty-icon {
  font-size: 56px;
  width: 56px;
  height: 56px;
  color: #ccc;
  margin-bottom: 15px;
  opacity: 0.7;
}

.empty-title {
  margin: 0 0 10px 0;
  color: #666;
  font-size: 1.2rem;
  font-weight: 500;
}

.empty-description {
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
  max-width: 400px;
  margin: 0 auto;
}

/* Resumen de estado */
.status-summary {
  margin-top: 30px;
  padding: 20px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 10px;
  border: 1px solid #dee2e6;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
}

.summary-item {
  text-align: center;
  padding: 15px;
  background: white;
  border-radius: 8px;
  border: 2px solid #e0e0e0;
  transition: all 0.3s ease;
}

.summary-item:hover {
  border-color: #3f51b5;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.summary-number {
  display: block;
  font-size: 28px;
  font-weight: bold;
  color: #3f51b5;
  line-height: 1;
  margin-bottom: 5px;
}

.summary-label {
  display: block;
  font-size: 12px;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Animaciones */
@keyframes fadeIn {
  from { 
    opacity: 0;
    transform: translateY(20px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.add-button:not([disabled]):hover {
  animation: pulse 2s infinite;
}

/* Tooltip personalizado */
::ng-deep .mat-mdc-tooltip {
  font-size: 12px !important;
  padding: 8px 12px !important;
  border-radius: 6px !important;
}

/* Responsive */
@media (max-width: 1024px) {
  .header-content {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .header-stats {
    width: 100%;
    justify-content: space-between;
  }
  
  .stat-item {
    flex: 1;
  }
}

@media (max-width: 768px) {
  .paso2-container {
    padding: 15px;
  }
  
  .summary-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .archivos-container {
    flex-direction: column;
    gap: 10px;
  }
  
  .contact-cell {
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
  }
  
  .empty-state {
    padding: 40px 15px;
  }
  
  .empty-icon {
    font-size: 48px;
    width: 48px;
    height: 48px;
  }
}

@media (max-width: 480px) {
  .paso-title {
    font-size: 1.1rem;
  }
  
  .paso-title mat-icon {
    font-size: 24px;
    width: 24px;
    height: 24px;
  }
  
  .summary-grid {
    grid-template-columns: 1fr;
  }
  
  .stat-item {
    min-width: 60px;
    padding: 6px 12px;
  }
  
  .stat-number {
    font-size: 18px;
  }
  
  .summary-number {
    font-size: 24px;
  }
}

/* Estados de hover en filas */
::ng-deep .mat-mdc-row {
  transition: background-color 0.2s ease;
}

::ng-deep .mat-mdc-row:hover {
  background-color: #f5f5f5;
}

/* Estilos para filas con datos incompletos */
::ng-deep .mat-mdc-row.incomplete {
  background-color: #fff3e0;
}

::ng-deep .mat-mdc-row.incomplete:hover {
  background-color: #ffe0b2;
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso3-finalizar\paso3-finalizar.ts 
============================================================================== 
// features/examenes-preocupacionales/components/paso3-finalizar/paso3-finalizar.ts
import { Component, Input, Output, EventEmitter, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormGroup } from '@angular/forms';
import { SharedMaterialModule } from '../../../../shared/modules/material.module';
import { AseguradoExamen } from '../../../../interface/examen.interface';
import { ExamenExitoModal } from '../examen-exito-modal/examen-exito-modal';
import { MatDialog } from '@angular/material/dialog';

@Component({
  selector: 'app-paso3-finalizar',
  standalone: true,
  imports: [CommonModule, SharedMaterialModule],
  templateUrl: './paso3-finalizar.html',
  styleUrls: ['./paso3-finalizar.css']
})
export class Paso3Finalizar {
  @Input() empresa: any = null;
  @Input() paso1Form!: FormGroup;
  @Input() asegurados: AseguradoExamen[] = [];
  @Input() archivosAsegurados: { [key: number]: { anverso: File | null, reverso: File | null } } = {};
  @Input() idIngresoGenerado: string = '';
  @Input() isLoading: boolean = false;
  @Input() canProceedToStep2: boolean = false;
  @Output() finalizarRegistro = new EventEmitter<void>();
  @Output() abrirModalExito = new EventEmitter<any>(); 

    private readonly dialog = inject(MatDialog);

  
   // M茅todos para estad铆sticas
  contarAseguradosCompletos(): number {
    return this.asegurados.filter(a => 
      a.correoElectronico?.trim() && a.celular?.trim()
    ).length;
  }

  contarAseguradosConArchivos(): number {
    return this.asegurados.filter(asegurado => {
      const archivos = this.archivosAsegurados[asegurado.idTemporal || asegurado.aseguradoId];
      return archivos?.anverso && archivos?.reverso;
    }).length;
  }

  tieneArchivosCompletos(aseguradoId: number): boolean {
    const asegurado = this.asegurados.find(a => 
      a.aseguradoId === aseguradoId || a.idTemporal === aseguradoId
    );

    if (!asegurado) return false;

    const idParaArchivos = asegurado.idTemporal || asegurado.aseguradoId;
    const archivos = this.archivosAsegurados[idParaArchivos];
    return !!archivos?.anverso && !!archivos?.reverso;
  }

  onFinalizar(): void {
    this.finalizarRegistro.emit();
  }

  // M茅todo para abrir el modal de 茅xito (llamado desde el padre)
  mostrarModalExito(response: any): void {
    const modalData = {
      idIngreso: this.idIngresoGenerado,
      fechaRegistro: new Date(),
      numeroRecibo: this.paso1Form.get('numeroRecibo')?.value,
      totalAsegurados: this.asegurados.length,
      importeTotal: this.paso1Form.get('totalImporte')?.value,
      empresa: {
        razonSocial: this.empresa?.razonSocial || '',
        nit: this.empresa?.nit || this.empresa?.NIT || '',
        numeroPatronal: this.empresa?.numeroPatronal || this.empresa?.nroPatronal || ''
      }
    };

    const dialogRef = this.dialog.open(ExamenExitoModal, {
      width: '700px',
      maxWidth: '95vw',
      data: modalData,
      disableClose: true,
      panelClass: 'exito-modal-dialog'
    });

    dialogRef.afterClosed().subscribe((result: any) => {
      if (result?.action === 'salir') {
        // El modal ya maneja la redirecci贸n
      } else if (result?.action === 'nuevo') {
        // Reiniciar formulario para nuevo registro
        this.abrirModalExito.emit({ action: 'reiniciar' });
      }
    });
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso3-finalizar\paso3-finalizar.html 
============================================================================== 
<!-- features/examenes-preocupacionales/components/paso3-finalizar/paso3-finalizar.html -->
<div class="paso3-container">
  
  <!-- T铆tulo del paso -->
  <div class="paso-header">
    <h3 class="paso-title">
      <mat-icon>checklist</mat-icon>
      Resumen y Finalizaci贸n
    </h3>
    <p class="paso-description">
      Verifique toda la informaci贸n antes de finalizar el registro
    </p>
  </div>

  <!-- Resumen del examen -->
  <div class="resumen-section">
    
    <!-- Tarjeta de empresa -->
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title class="summary-title">
          <mat-icon>business</mat-icon>
          Datos de la Empresa
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="summary-grid">
          <div class="summary-item">
            <strong>Raz贸n Social:</strong>
            <span>{{ empresa?.razonSocial || 'No disponible' }}</span>
          </div>
          <div class="summary-item">
            <strong>NIT:</strong>
            <span>{{ empresa?.nit || empresa?.NIT || 'No disponible' }}</span>
          </div>
          <div class="summary-item">
            <strong>N煤mero Patronal:</strong>
            <span>{{ empresa?.nroPatronal || empresa?.numeroPatronal || 'No disponible' }}</span>
          </div>
          <div class="summary-item">
            <strong>ID de Registro:</strong>
            <span class="id-highlight">{{ idIngresoGenerado }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Tarjeta de recibo -->
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title class="summary-title">
          <mat-icon>receipt</mat-icon>
          Datos del Recibo
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="summary-grid">
          <div class="summary-item">
            <strong>N煤mero de Recibo:</strong>
            <span>{{ paso1Form.get('numeroRecibo')?.value }}</span>
          </div>
          <div class="summary-item">
            <strong>Total Importe:</strong>
            <span>Bs. {{ paso1Form.get('totalImporte')?.value | number:'1.2-2' }}</span>
          </div>
          <div class="summary-item">
            <strong>Cantidad de Asegurados:</strong>
            <span>{{ paso1Form.get('cantidadAsegurados')?.value }}</span>
          </div>
          @if (paso1Form.get('cantidadAsegurados')?.value > 1) {
            <div class="summary-item">
              <strong>Correo Empleador:</strong>
              <span>{{ paso1Form.get('correoEmpleador')?.value }}</span>
            </div>
            <div class="summary-item">
              <strong>Celular Empleador:</strong>
              <span>{{ paso1Form.get('celularEmpleador')?.value }}</span>
            </div>
          }
          <div class="summary-item">
            <strong>Recibo Cargado:</strong>
            @if (paso1Form.get('imagenRecibo')?.value) {
              <span class="status-success">
                <mat-icon>check_circle</mat-icon> S铆
              </span>
            } @else {
              <span class="status-error">
                <mat-icon>error</mat-icon> No
              </span>
            }
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Tarjeta de asegurados -->
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title class="summary-title">
          <mat-icon>people</mat-icon>
          Asegurados Registrados ({{ asegurados.length }})
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="asegurados-summary">
          @for (asegurado of asegurados; track asegurado.aseguradoId; let i = $index) {
            <div class="asegurado-summary-item">
              <div class="asegurado-header">
                <mat-icon>person</mat-icon>
                <span class="asegurado-nombre">{{ asegurado.nombreCompleto }}</span>
              </div>
              <div class="asegurado-details">
                <div class="detail-row">
                  <span class="detail-label">CI/NIT:</span>
                  <span class="detail-value">{{ asegurado.ci }}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Correo:</span>
                  <span [class]="asegurado.correoElectronico ? 'detail-value' : 'detail-missing'">
                    {{ asegurado.correoElectronico || 'No asignado' }}
                  </span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Celular:</span>
                  <span [class]="asegurado.celular ? 'detail-value' : 'detail-missing'">
                    {{ asegurado.celular || 'No asignado' }}
                  </span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Formularios:</span>
                  @if (tieneArchivosCompletos(asegurado.aseguradoId)) {
                    <span class="status-success">
                      <mat-icon>check_circle</mat-icon> Completos
                    </span>
                  } @else {
                    <span class="status-error">
                      <mat-icon>error</mat-icon> Incompletos
                    </span>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Indicadores de estado -->
  <div class="status-indicators">
    <div class="status-indicator" [class.complete]="asegurados.length === paso1Form.get('cantidadAsegurados')?.value">
      <span class="indicator-number">{{ asegurados.length }}</span>
      <span class="indicator-label">Asegurados</span>
    </div>
    <div class="status-indicator" [class.complete]="contarAseguradosCompletos() === asegurados.length">
      <span class="indicator-number">{{ contarAseguradosCompletos() }}</span>
      <span class="indicator-label">Con contacto</span>
    </div>
    <div class="status-indicator" [class.complete]="contarAseguradosConArchivos() === asegurados.length">
      <span class="indicator-number">{{ contarAseguradosConArchivos() }}</span>
      <span class="indicator-label">Con archivos</span>
    </div>
  </div>

  <!-- Advertencia final -->
  <div class="final-warning">
    <mat-icon>warning</mat-icon>
    <p>Verifique que toda la informaci贸n sea correcta antes de finalizar el registro.</p>
  </div>

  <!-- Acciones finales -->
  <div class="step-actions">
    <button mat-raised-button 
            color="primary"
            [disabled]="isLoading || !canProceedToStep2"
            (click)="onFinalizar()"
            class="finalizar-button">
      @if (isLoading) {
        <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
        <span>Guardando...</span>
      } @else {
        <!-- <mat-icon>check_circle</mat-icon> -->
        <span>Finalizar Registro</span>
      }
    </button>
  </div>

</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\paso3-finalizar\paso3-finalizar.css 
============================================================================== 
/* features/examenes-preocupacionales/components/paso3-finalizar/paso3-finalizar.css */
.paso3-container {
  padding: 20px;
}

.paso-header {
  margin-bottom: 30px;
}

.paso-title {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #3f51b5;
  margin: 0 0 10px 0;
  font-size: 1.3rem;
  font-weight: 500;
}

.paso-title mat-icon {
  font-size: 28px;
  width: 28px;
  height: 28px;
}

.paso-description {
  color: #666;
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
}

/* Resumen section */
.resumen-section {
  margin-bottom: 30px;
}

.summary-card {
  margin-bottom: 20px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
}

.summary-title {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #3f51b5;
  font-weight: 500;
}

.summary-title mat-icon {
  color: #3f51b5;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 12px;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #f0f0f0;
}

.summary-item:last-child {
  border-bottom: none;
}

.summary-item strong {
  color: #555;
  font-weight: 500;
  min-width: 150px;
}

.summary-item span {
  color: #333;
  text-align: right;
  word-break: break-word;
}

.id-highlight {
  font-family: 'Courier New', monospace;
  font-weight: bold;
  color: #2196f3;
  background: #e3f2fd;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 14px;
}

.status-success {
  color: #4caf50;
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-error {
  color: #f44336;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Asegurados summary */
.asegurados-summary {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 10px;
}

.asegurado-summary-item {
  padding: 16px;
  margin-bottom: 12px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.asegurado-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid #e0e0e0;
}

.asegurado-header mat-icon {
  color: #3f51b5;
}

.asegurado-nombre {
  font-weight: 600;
  color: #333;
  font-size: 15px;
}

.asegurado-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
}

.detail-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.detail-label {
  color: #666;
  font-size: 14px;
  min-width: 80px;
  font-weight: 500;
}

.detail-value {
  color: #333;
  font-weight: 500;
}

.detail-missing {
  color: #f44336;
  font-style: italic;
}

/* Status indicators */
.status-indicators {
  display: flex;
  gap: 16px;
  margin: 30px 0;
  flex-wrap: wrap;
}

.status-indicator {
  flex: 1;
  min-width: 150px;
  text-align: center;
  padding: 16px;
  background: white;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.status-indicator.complete {
  border-color: #4caf50;
  background: #e8f5e9;
}

.indicator-number {
  display: block;
  font-size: 24px;
  font-weight: bold;
  color: #333;
  margin-bottom: 8px;
}

.status-indicator.complete .indicator-number {
  color: #2e7d32;
}

.indicator-label {
  display: block;
  font-size: 13px;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Final warning */
.final-warning {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 16px;
  background: #fff3e0;
  border-left: 4px solid #ff9800;
  border-radius: 8px;
  margin: 24px 0;
}

.final-warning mat-icon {
  color: #ff9800;
}

.final-warning p {
  margin: 0;
  font-weight: 500;
  color: #e65100;
}

/* Actions */
.step-actions {
  display: flex;
  justify-content: center;
  margin-top: 32px;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

.finalizar-button {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 32px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 4px;
  min-width: 200px;
  justify-content: center;
  background: #3f51b5;
  color: white;
  transition: all 0.2s ease;
}

.finalizar-button:hover:not([disabled]) {
  background: #303f9f;
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
}

.finalizar-button[disabled] {
  opacity: 0.6;
  cursor: not-allowed;
}

.button-spinner {
  margin-right: 12px;
}

/* Responsive */
@media (max-width: 768px) {
  .paso3-container {
    padding: 15px;
  }
  
  .status-indicators {
    flex-direction: column;
  }
  
  .status-indicator {
    min-width: 100%;
  }
  
  .summary-grid {
    grid-template-columns: 1fr;
  }
  
  .asegurado-details {
    grid-template-columns: 1fr;
  }
  
  .detail-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
  }
  
  .detail-label {
    min-width: unset;
  }
  
  .final-warning {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  
  .step-actions {
    flex-direction: column;
    gap: 15px;
  }
  
  .finalizar-button {
    width: 100%;
    min-width: unset;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\prelogin\prelogin.ts 
============================================================================== 

import { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';
import { Router } from '@angular/router';
import { EmpresaService } from '../../../../core/service/empresa.service';
import { Component, OnInit, OnDestroy, inject,ChangeDetectorRef} from '@angular/core';
import { MatSnackBar } from '@angular/material/snack-bar';
import { SesionService } from '../../../../core/service/sesion.service';
import { SharedMaterialModule } from '../../../../shared/modules/material.module'; //Angular Material m贸dulos compartidos


@Component({
  selector: 'app-prelogin',
  standalone: true,
  imports: [ SharedMaterialModule,ReactiveFormsModule ],
  templateUrl: './prelogin.html',
  styleUrl: './prelogin.css',
})
export class Prelogin implements OnInit,OnDestroy  {
  preloginForm: FormGroup;
  isLoading = false;
  empresaEncontrada: any = null;
  mensajeError: string = '';
  busquedaRealizada = false;
  debugMode = false; // Cambiar a true solo para desarrollo

   // Estados para redirecci贸n manual
  redireccionEnProgreso = false;
  redireccionando = false;



  contadorRedireccion = 3;

  constructor(
    private fb: FormBuilder,
    private empresaService: EmpresaService,
    private router: Router,
    private snackBar: MatSnackBar,
    private cdRef: ChangeDetectorRef,
    private sesionService: SesionService
  ) {
    this.preloginForm = this.fb.group({
      numeroPatronal: ['', [
        Validators.required,
        Validators.minLength(10),
        Validators.maxLength(12),
        Validators.pattern(/^\d{2}-\d{3}-\d{5}$/)
      ]]
    });

    // Verificar si ya hay una empresa verificada
    this.verificarEmpresaAlmacenada();
  }

  ngOnInit(): void {
    console.log(' Prelogin inicializado');

    // Auto-cargar ejemplo para pruebas
    // setTimeout(() => {
    //   if (this.debugMode) {
    //     this.cargarEjemplo('01-730-00001');
    //   }
    // }, 100);
  }

  ngOnDestroy(): void {
    // Limpiar cualquier timeout pendiente
    this.redireccionEnProgreso = false;
  }


  /**
   * Verificar si ya hay una empresa almacenada
   */
  private verificarEmpresaAlmacenada(): void {
    const empresa = this.empresaService.getEmpresaExamen();
    if (empresa && this.empresaService.estaActiva(empresa)) {
      console.log(' Empresa ya verificada encontrada:', empresa.razonSocial);

      // Mostrar informaci贸n de la empresa ya verificada
      this.empresaEncontrada = empresa;
      this.busquedaRealizada = true;

       this.mostrarMensaje(`Empresa ${empresa.razonSocial} ya verificada`, 'info');

      // Forzar actualizaci贸n de UI
      this.cdRef.detectChanges();
    }
  }
  /**
   * Enviar formulario
   */
  onSubmit(): void {
    console.log(' Enviando formulario...');

    if (this.preloginForm.invalid) {
      this.mostrarMensaje('Ingrese un n煤mero patronal v谩lido', 'error');

      // Marcar todos los campos como tocados para mostrar errores
      Object.keys(this.preloginForm.controls).forEach(key => {
        this.preloginForm.get(key)?.markAsTouched();
      });

      return;
    }

    const numeroPatronal = this.preloginForm.get('numeroPatronal')?.value;
    this.buscarEmpresa(numeroPatronal);
  }

  /**
   * Buscar empresa en el sistema CNS
   */
  private buscarEmpresa(numeroPatronal: string): void {
    console.log(' Buscando empresa:', numeroPatronal);

    this.isLoading = true;
    this.mensajeError = '';
    this.empresaEncontrada = null;
    this.busquedaRealizada = false;
    this.redireccionEnProgreso = false;

    // Forzar actualizaci贸n de UI
    this.cdRef.detectChanges();

    this.empresaService.buscarEmpresa(numeroPatronal).subscribe({
      next: (response) => {
        console.log(' Respuesta exitosa:', response);
        if (response.success) {
          this.empresaEncontrada = response.empresa;
           // Guardar empresa (esto emitir谩 el cambio al header)
          this.empresaService.guardarEmpresaExamen(response.empresa);
          this.sesionService.actualizarPaso(1, { empresa: response.empresa });
        }


        this.isLoading = false;
        this.busquedaRealizada = true;

        if (response.success) {
          this.empresaEncontrada = response.empresa;

          // Guardar empresa en localStorage y sessionStorage
          this.empresaService.guardarEmpresaExamen(response.empresa);

          this.mostrarMensaje(response.mensaje, 'success');

           }

        this.cdRef.detectChanges();
      },
      error: (error) => {
        console.error(' Error en b煤squeda:', error);

        this.isLoading = false;
        this.busquedaRealizada = true;
        this.empresaEncontrada = null;
        this.mensajeError = error.mensaje || 'Error desconocido al buscar empresa';

        this.mostrarMensaje(this.mensajeError, 'error');
        this.cdRef.detectChanges();
      }
    });
  }


  /**
   * Redirigir manualmente al examen
   */
  redirigirAhora(): void {
    if (this.redireccionando) {
      console.log(' Redirecci贸n ya en progreso...');
      return;
    }

    if (!this.empresaEncontrada) {
      this.mostrarMensaje('Primero debe verificar una empresa', 'error');
      return;
    }

    if (!this.empresaActiva) {
      this.mostrarMensaje('La empresa no est谩 activa', 'error');
      return;
    }

    console.log(' Usuario solicit贸 redirecci贸n manual');

    // Cambiar estado para mostrar feedback
    this.redireccionando = true;
    this.cdRef.detectChanges();

    // Peque帽o delay para feedback visual
    setTimeout(() => {
      this.ejecutarRedireccion();
    }, 300);
  }

  /**
   * Ejecutar redirecci贸n real
   */
  private ejecutarRedireccion(): void {
    // Verificar nuevamente con el servicio
    this.empresaService.redirigirAExamen()
      .then(() => {
        console.log(' Redirigiendo a examen-preocupacional...');

        // Navegar a la ruta
        this.router.navigate(['/examen-preocupacional']).then(success => {
          this.redireccionando = false;

          if (success) {
            console.log(' Redirecci贸n exitosa');
          } else {
            console.error(' Error en redirecci贸n');
            this.mostrarMensaje('Error al acceder al examen. Intente nuevamente.', 'error');
            this.cdRef.detectChanges();
          }
        });
      })
      .catch(error => {
        console.error(' Error en verificaci贸n:', error);
        this.redireccionando = false;
        this.mostrarMensaje(error || 'No se puede acceder al examen', 'error');
        this.cdRef.detectChanges();
      });
  }



  /**
   * Cargar ejemplo
   */
  cargarEjemplo(numero: string): void {
    console.log(' Cargando ejemplo:', numero);
    this.preloginForm.patchValue({ numeroPatronal: numero });
    this.preloginForm.get('numeroPatronal')?.markAsDirty();
    this.mostrarMensaje(`Ejemplo cargado: ${numero}`, 'info');
  }

  /**
   * Limpiar formulario
   */
  limpiar(): void {
    console.log(' Limpiando formulario...');

    this.preloginForm.reset();
    this.empresaEncontrada = null;
    this.mensajeError = '';
    this.busquedaRealizada = false;
    this.redireccionando = false;

    // Limpiar datos almacenados
    this.empresaService.limpiarDatosExamen();
    this.mostrarMensaje('Formulario limpiado', 'info');
    this.cdRef.detectChanges();
  }

 /**
   * Mostrar mensaje toast
   */
  private mostrarMensaje(mensaje: string, tipo: 'success' | 'error' | 'info' = 'info'): void {
    this.snackBar.open(mensaje, 'Cerrar', {
      duration: 5000,
      panelClass: [`snackbar-${tipo}`]
    });
  }

  /**
   * Getters
   */
  get empresaActiva(): boolean {
    return this.empresaService.estaActiva(this.empresaEncontrada);
  }

  get textoBotonPrincipal(): string {
    if (this.isLoading) return 'Verificando...';
    if (this.empresaEncontrada && this.empresaActiva) return 'Empresa Verificada';
    if (this.empresaEncontrada && !this.empresaActiva) return 'Empresa Inactiva';
    return 'Verificar Empresa';
  }

  get botonPrincipalHabilitado(): boolean {
    return this.preloginForm.valid && !this.isLoading;
  }

  /**
   * Texto del bot贸n "Ingresar Ahora"
   */
  get textoBotonIngresar(): string {
    if (this.redireccionando) {
      return 'Redirigiendo...';
    }
    return 'Ingresar Ahora';
  }

  /**
   * Estado del bot贸n "Ingresar Ahora"
   */
  get botonIngresarHabilitado(): boolean {
    return this.empresaEncontrada &&
           this.empresaActiva &&
           !this.redireccionando &&
           !this.isLoading;
  }

  /**
   * Verificar errores del formulario
   */
  tieneError(controlName: string, errorType: string): boolean {
    const control = this.preloginForm.get(controlName);
    return control ? control.hasError(errorType) && (control.touched || control.dirty) : false;
  }

  /**
   * Evento onBlur
   */
  onBlur(): void {
    const control = this.preloginForm.get('numeroPatronal');

    if (!control) {
      console.error(' Control "numeroPatronal" no encontrado');
      return;
    }

    let valor = control.value;

    if (valor) {
      valor = valor.trim().toUpperCase();

      if (valor !== control.value) {
        control.setValue(valor, { emitEvent: false });
      }

      control.markAsTouched();
      control.updateValueAndValidity();
    }
  }

  /**
   * Evento onKeyPress
   */
  onKeyPress(event: KeyboardEvent): void {
    const allowed = /[0-9-]|Backspace|Delete|Tab|ArrowLeft|ArrowRight/;
    if (!allowed.test(event.key)) {
      event.preventDefault();
    }
  }

  /**
   * Evento onInput
   */
  onInput(event: Event): void {
    const input = event.target as HTMLInputElement;
    let value = input.value.replace(/[^\d-]/g, '');

    // Autoformatear
    if (value.length > 2 && value.charAt(2) !== '-') {
      value = value.slice(0, 2) + '-' + value.slice(2);
    }
    if (value.length > 6 && value.charAt(6) !== '-') {
      value = value.slice(0, 6) + '-' + value.slice(6);
    }

    if (value.length > 12) {
      value = value.slice(0, 12);
    }

    this.preloginForm.patchValue({ numeroPatronal: value });
  }

}
..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\prelogin\prelogin.html 
============================================================================== 
<!-- features/prelogin/prelogin.html -->
<div class="prelogin-container">
  <mat-card class="card-prelogin">
    
    <!-- Encabezado COMPACTADO -->
    <mat-card-header class="card-header compact-header">
      <mat-card-title>
        <div class="title-container">
          <mat-icon class="title-icon">medical_services</mat-icon>
          <div class="title-content">
            <h1>Verificaci贸n de Empresa</h1>
            <p class="subtitle">Ingrese el n煤mero patronal para verificar la afiliaci贸n al CNS</p>
          </div>
        </div>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="card-content">
      
      <!-- Secci贸n de b煤squeda -->
      <div class="search-section">
        <div class="section-header">
         
          <div class="section-title">
            <!-- <h2>Verificaci贸n de Empresa</h2>
            <p class="section-description">
              Ingrese el n煤mero patronal para verificar la afiliaci贸n al CNS
            </p> -->
          </div>
        </div>

        <form [formGroup]="preloginForm" (ngSubmit)="onSubmit()">
          
          <!-- Campo de n煤mero patronal -->
          <mat-form-field appearance="outline" class="full-width input-field">
            <mat-label>N煤mero Patronal</mat-label>
            <input matInput 
                   formControlName="numeroPatronal"
                   placeholder="00-700-00001"
                   [maxlength]="12"
                   (keypress)="onKeyPress($event)"
                   (input)="onInput($event)"
                   (blur)="onBlur()">
            <mat-icon matSuffix>format_list_numbered_rtl</mat-icon>
            
            <!-- Errores de validaci贸n -->
            @if (tieneError('numeroPatronal', 'required')) {
              <mat-error>El n煤mero patronal es obligatorio</mat-error>
            }
            @if (tieneError('numeroPatronal', 'pattern')) {
              <mat-error>Formato: "00-700-00001</mat-error>
            }
            @if (tieneError('numeroPatronal', 'minlength')) {
              <mat-error>M铆nimo 10 caracteres</mat-error>
            }
            @if (tieneError('numeroPatronal', 'maxlength')) {
              <mat-error>M谩ximo 12 caracteres</mat-error>
            }
            
            <mat-hint>Formato: "00-700-00001</mat-hint>
          </mat-form-field>

          <!-- Estado de validaci贸n -->
          @if (preloginForm.dirty) {
            <div class="validation-status" [class.valid]="preloginForm.valid">
              <mat-icon class="status-icon">
                {{ preloginForm.valid ? 'check_circle' : 'error_outline' }}
              </mat-icon>
              <span class="status-text">
                @if (preloginForm.valid) {
                  Formato v谩lido
                } @else {
                  Formato inv谩lido
                }
              </span>
            </div>
          }

          <!-- Botones de acci贸n - Centrados -->
          <div class="action-buttons">
            <button mat-raised-button 
                    color="primary"
                    class="search-button"
                    type="submit"
                    [disabled]="!botonPrincipalHabilitado">
              @if (isLoading) {
                <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
                <span>Verificando...</span>
              } @else {
                <span>{{ textoBotonPrincipal }}</span>
              }
            </button>

            <button mat-button 
                    type="button"
                    class="clear-button"
                    (click)="limpiar()"
                    [disabled]="isLoading">
              <mat-icon>clear_all</mat-icon>
              Limpiar
            </button>
          </div>
        </form>
      </div>

      <!-- Resultados de b煤squeda -->
      <div class="result-section">
        
        <!-- Estado de carga -->
        @if (isLoading) {
          <div class="loading-state">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Buscando empresa en el sistema CNS...</p>
          </div>
        }

        <!-- Error -->
        @if (mensajeError && busquedaRealizada && !isLoading) {
          <div class="error-result">
            <div class="result-header">
              <mat-icon class="error-icon">error_outline</mat-icon>
              <h3>No se pudo verificar la empresa</h3>
            </div>
            <p><strong>{{ mensajeError }}</strong></p>
            <div class="error-advice">
              <p>Verifique el formato: <strong>"00-700-00001</strong></p>
            </div>
            <div class="error-actions">
              <button mat-button (click)="limpiar()">
                <mat-icon>refresh</mat-icon>
                Intentar nuevamente
              </button>
            </div>
          </div>
        }

        <!-- Empresa encontrada -->
        @if (empresaEncontrada && busquedaRealizada && !isLoading) {
          <div class="success-result">
            <div class="result-header">
              @if (empresaActiva) {
                   <div class="result-title">
                  <h3>隆Empresa Verificada!</h3>
                  <p class="result-subtitle">{{ empresaEncontrada.razonSocial }}</p>
                </div>
              } @else {
                <mat-icon class="warning-icon">warning</mat-icon>
                <div class="result-title">
                  <h3>Empresa Encontrada (Inactiva)</h3>
                  <p class="result-subtitle">{{ empresaEncontrada.razonSocial }}</p>
                </div>
              }
            </div>

            <!-- Informaci贸n de la empresa -->
            <div class="empresa-details">
              <!-- <div class="empresa-id">
                <span class="label">N煤mero Patronal:</span>
                <span class="value">{{ empresaEncontrada.numeroPatronal }}</span>
              </div> -->
              
              <!-- Estado destacado -->
              <div class="estado-destacado" [class.activo]="empresaActiva" [class.inactivo]="!empresaActiva">
                <mat-icon>{{ empresaActiva ? 'check_circle' : 'block' }}</mat-icon>
                <span>
                  <strong>Estado:</strong> 
                  {{ empresaEncontrada.estado || 'DESCONOCIDO' }}
                </span>
              </div>
            </div>

            <!-- Acciones seg煤n estado -->
            @if (empresaActiva) {
              <div class="accion-activa">
                <!-- Bot贸n centrado y m谩s destacado -->
                <button mat-raised-button 
                        color="primary"
                        class="ingresar-button"
                        (click)="redirigirAhora()"
                        [disabled]="redireccionando">
                  @if (redireccionando) {
                    <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
                    <span>Redirigiendo...</span>
                  } @else {
                    
                    <span>Ingresar Ahora</span>
                  }
                </button>
                <p class="accion-subtext">
                  Contin煤e al registro de ex谩menes preocupacionales
                </p>
              </div>
            } @else {
              <div class="accion-inactiva">
                <div class="accion-content">
                  <mat-icon>info</mat-icon>
                  <p><strong>Esta empresa no est谩 activa en el sistema CNS.</strong></p>
                  <p class="accion-subtext">Contacte a la oficina de afiliaciones para regularizar su situaci贸n.</p>
                </div>
                <button mat-stroked-button (click)="limpiar()">
                  <mat-icon>search</mat-icon>
                  Buscar otra empresa
                </button>
              </div>
            }
          </div>
        }
      </div>

      <!-- Informaci贸n adicional -->
      <div class="info-section">
        <div class="info-card">
          <div class="info-header">
            <mat-icon>info</mat-icon>
            <h4>Informaci贸n Importante</h4>
          </div>
          <div class="info-content">
            <ul>
              <li>Formato requerido: <strong>"00-700-00001</strong></li>
              <li>Solo empresas afiliadas y activas pueden registrar ex谩menes</li>
              <li>Los datos se mantendr谩n durante toda la sesi贸n</li>
              <li>Sistema CNS - Versi贸n 1.0.0</li>
            </ul>
          </div>
        </div>
      </div>
    </mat-card-content>

  </mat-card>
</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\components\prelogin\prelogin.css 
============================================================================== 
/* ===== ESTILOS PRELOGIN - VERSIN MEJORADA Y COMPACTA ===== */

/* Contenedor principal */
.prelogin-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  padding: 20px;
  font-family: 'Roboto', 'Segoe UI', sans-serif;
}

/* Tarjeta principal */
.card-prelogin {
  background: white;
  border-radius: 16px;
  box-shadow: 0 15px 50px rgba(46, 125, 50, 0.15);
  width: 100%;
  max-width: 600px; /* M谩s compacta */
  overflow: hidden;
  animation: fadeIn 0.5s ease;
  border: 1px solid #c8e6c9;
}

/* Animaciones */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== ENCABEZADO COMPACTO ===== */
.card-header.compact-header {
  background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
  color: white;
  padding: 20px 30px !important; /* Reducido a煤n m谩s */
  border-bottom: 4px solid #2e7d32;
  text-align: center;
}

.title-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  width: 100%;
}

.title-icon {
  font-size: 36px !important; /* M谩s peque帽o */
  width: 36px;
  height: 36px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  padding: 8px;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.title-content h1 {
  margin: 0;
  font-size: 1.4rem !important; /* T铆tulo m谩s peque帽o */
  font-weight: 600;
  letter-spacing: 0.2px;
  line-height: 1.2;
}

.subtitle {
  margin: 4px 0 0 0;
  opacity: 0.9;
  font-size: 0.9rem; /* Subt铆tulo m谩s peque帽o */
  font-weight: 400;
}

/* ===== CONTENIDO DEL CARD ===== */
.card-content {
  padding: 25px 30px;
}

/* Secci贸n de b煤squeda */
.section-header {
  text-align: center;
  margin-bottom: 25px;
}

.section-icon {
  color: #4caf50;
  font-size: 32px;
  width: 32px;
  height: 32px;
  margin-bottom: 10px;
}

.section-title h2 {
  margin: 0;
  color: #2e7d32;
  font-size: 1.2rem;
  font-weight: 600;
}

.section-description {
  margin: 8px 0 0 0;
  color: #666;
  font-size: 0.9rem;
}

/* Campo de entrada */
.input-field {
  width: 100%;
  margin-bottom: 20px;
}

::ng-deep .mat-mdc-form-field {
  width: 100%;
}

/* Estado de validaci贸n */
.validation-status {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 20px;
  border-radius: 8px;
  margin: 20px auto;
  max-width: 300px;
  background: #ffebee;
  border: 1px solid #f44336;
}

.validation-status.valid {
  background: #e8f5e9;
  border: 1px solid #4caf50;
  animation: pulse 2s infinite;
}

.status-icon {
  font-size: 20px;
  width: 20px;
  height: 20px;
}

.validation-status.valid .status-icon {
  color: #4caf50;
}

.status-text {
  font-weight: 500;
  font-size: 0.9rem;
}

.validation-status.valid .status-text {
  color: #2e7d32;
}

/* ===== BOTONES DE ACCIN ===== */
.action-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  margin-top: 25px;
}

.search-button {
  min-width: 220px;
  height: 48px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 12px;
  background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  box-shadow: 0 6px 12px rgba(76, 175, 80, 0.2);
  transition: all 0.3s ease;
}

.search-button:hover:not([disabled]) {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
}

.clear-button {
  color: #666;
  font-size: 14px;
  padding: 8px 20px;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.clear-button:hover:not([disabled]) {
  background: #f8f9fa;
  color: #4caf50;
}

/* ===== RESULTADOS ===== */
.result-section {
  margin: 30px 0;
}

/* Estado de carga */
.loading-state {
  text-align: center;
  padding: 30px;
}

.loading-state p {
  margin: 15px 0 0 0;
  font-size: 14px;
  font-weight: 500;
  color: #4caf50;
}

/* Resultado de error */
.error-result {
  background: #ffebee;
  border: 1px solid #f44336;
  border-radius: 12px;
  padding: 25px;
  text-align: center;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

.result-header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin-bottom: 15px;
}

.error-icon {
  color: #f44336;
  font-size: 32px;
  width: 32px;
  height: 32px;
}

.error-result h3 {
  margin: 0;
  color: #c62828;
  font-size: 1.1rem;
}

.error-result p {
  margin: 10px 0;
  color: #666;
  font-size: 0.9rem;
}

.error-actions {
  margin-top: 20px;
}

/* Resultado exitoso */
.success-result {
  background: white;
  border: 2px solid #81c784;
  border-radius: 12px;
  padding: 25px;
  text-align: center;
  box-shadow: 0 8px 16px rgba(129, 199, 132, 0.15);
  animation: slideIn 0.3s ease;
}

.result-title {
  margin-bottom: 20px;
}

.success-result h3 {
  margin: 0 0 5px 0;
  color: #2e7d32;
  font-size: 1.2rem;
}

.result-subtitle {
  margin: 0;
  color: #666;
  font-size: 0.95rem;
  font-weight: 500;
}

.success-icon {
  color: #4caf50;
  font-size: 40px;
  width: 40px;
  height: 40px;
}

.warning-icon {
  color: #ff9800;
  font-size: 40px;
  width: 40px;
  height: 40px;
}

/* Detalles de la empresa */
.empresa-details {
  margin: 20px 0;
}

.empresa-id {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.empresa-id .label {
  color: #666;
  font-weight: 500;
  font-size: 14px;
}

.empresa-id .value {
  color: #4caf50;
  font-weight: 700;
  font-size: 15px;
  padding: 6px 12px;
  background: #e8f5e9;
  border-radius: 20px;
}

/* Estado destacado */
.estado-destacado {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 20px;
  border-radius: 10px;
  margin: 0 auto;
  max-width: 250px;
  font-size: 14px;
  font-weight: 500;
}

.estado-destacado.activo {
  background: #e8f5e9;
  color: #2e7d32;
  border: 2px solid #66bb6a;
}

.estado-destacado.inactivo {
  background: #ffebee;
  color: #c62828;
  border: 2px solid #f44336;
}

.estado-destacado mat-icon {
  font-size: 18px;
  width: 18px;
  height: 18px;
}

/* ===== BOTN INGRESAR AHORA (CENTRADO Y DESTACADO) ===== */
.accion-activa {
  text-align: center;
  padding: 20px 0 0 0;
}

.ingresar-button {
  min-width: 220px !important; /* M谩s ancho para mejor visibilidad */
  height: 50px !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  border-radius: 12px !important;
  background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%) !important; /* Verde m谩s oscuro para destacar */
  color: white !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 10px !important;
  margin: 0 auto !important; /* Centrado autom谩tico */
  box-shadow: 0 8px 20px rgba(46, 125, 50, 0.3) !important; /* Sombra m谩s pronunciada */
  transition: all 0.3s ease !important;
  border: none !important;
}

.ingresar-button:hover:not([disabled]) {
  transform: translateY(-4px) !important;
  box-shadow: 0 12px 25px rgba(46, 125, 50, 0.4) !important;
}

.ingresar-button[disabled] {
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}

.accion-subtext {
  margin: 12px 0 0 0 !important;
  color: #666 !important;
  font-size: 13px !important;
  font-style: italic;
}

/* Estado inactivo */
.accion-inactiva {
  text-align: center;
  padding: 20px 0;
}

.accion-inactiva .accion-content {
  margin-bottom: 20px;
}

.accion-inactiva mat-icon {
  color: #ff9800;
  font-size: 40px;
  width: 40px;
  height: 40px;
  margin-bottom: 10px;
}

.accion-inactiva p {
  margin: 10px 0;
  color: #666;
  font-size: 14px;
}

/* ===== INFORMACIN ADICIONAL ===== */
.info-section {
  margin-top: 30px;
}

.info-card {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 20px;
  border-left: 4px solid #66bb6a;
}

.info-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.info-header mat-icon {
  color: #4caf50;
  font-size: 22px;
  width: 22px;
  height: 22px;
}

.info-header h4 {
  margin: 0;
  color: #2e7d32;
  font-size: 1rem;
  font-weight: 600;
}

.info-content ul {
  margin: 0;
  padding-left: 20px;
}

.info-content li {
  margin-bottom: 8px;
  color: #666;
  font-size: 0.9rem;
  line-height: 1.4;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .prelogin-container {
    padding: 15px;
  }
  
  .card-prelogin {
    max-width: 95vw;
    margin: 10px;
  }
  
  .card-content {
    padding: 20px;
  }
  
  .card-header.compact-header {
    padding: 15px 20px !important;
  }
  
  .title-container {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  
  .title-content h1 {
    font-size: 1.2rem !important;
  }
  
  .subtitle {
    font-size: 0.85rem;
  }
  
  .title-icon {
    font-size: 32px !important;
    width: 32px;
    height: 32px;
  }
  
  .section-title h2 {
    font-size: 1.1rem;
  }
  
  .section-description {
    font-size: 0.85rem;
  }
  
  .search-button,
  .ingresar-button {
    min-width: 200px !important;
    width: 100%;
    max-width: 300px;
  }
  
  .action-buttons {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .card-content {
    padding: 15px;
  }
  
  .card-header.compact-header {
    padding: 12px 15px !important;
  }
  
  .title-content h1 {
    font-size: 1.1rem !important;
  }
  
  .result-header {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  
  .estado-destacado {
    flex-direction: column;
    text-align: center;
    gap: 5px;
  }
  
  .empresa-id {
    flex-direction: column;
    gap: 5px;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\examen-preocupacional\examen-preocupacional.ts 
============================================================================== 
// features/examen-preocupacional/examen-preocupacional.component.ts
import { Component, OnInit, ViewChild, inject } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { Router } from '@angular/router';
import { MatStepper } from '@angular/material/stepper';
import { MatDialog } from '@angular/material/dialog';
import { finalize, take } from 'rxjs/operators';

import { SharedMaterialModule } from '../../../shared/modules/material.module';
import { Paso1DatosRecibo } from '../components/paso1-datos-recibo/paso1-datos-recibo';
import { Paso2Asegurados } from '../components/paso2-asegurados/paso2-asegurados';
import { Paso3Finalizar } from '../components/paso3-finalizar/paso3-finalizar'

import { EmpresaService } from '../../../core/service/empresa.service';
import { NotificationService } from '../../../core/service/notification.service';
import { AseguradoExamen } from '../../../interface/examen.interface';
import { ExamenExitoModal } from '../components/examen-exito-modal/examen-exito-modal';

import { ExamenRequest } from '../../../interface/examen.interface';

import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { ExamenPreocupacionalService } from '../../../core/service/examen-preocupacional.service';
import { Header } from "../../../shared/components/header/header";



@Component({
  selector: 'app-examen-preocupacional',
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    SharedMaterialModule,
    Paso1DatosRecibo,
    Paso2Asegurados,
    Paso3Finalizar,
    Header
],
  templateUrl: './examen-preocupacional.html',
  styleUrls: ['./examen-preocupacional.css']
})
export class ExamenPreocupacional implements OnInit {
  @ViewChild('stepper') stepper!: MatStepper;
  
  private readonly fb = inject(FormBuilder);
  private readonly router = inject(Router);
  private readonly examenService = inject(ExamenPreocupacionalService);
  private readonly empresaService = inject(EmpresaService);
  private readonly notification = inject(NotificationService);
  private readonly dialog = inject(MatDialog);

  // Formularios
  paso1Form: FormGroup;
  paso2Form: FormGroup;

  // Data
  empresa: any = null;
  asegurados: AseguradoExamen[] = [];
  archivosAsegurados: { [key: number]: { anverso: File | null, reverso: File | null } } = {};
  
  // State
  isLoading = false;
  idIngresoGenerado = '';

  constructor() {
    this.paso1Form = this.createPaso1Form();
    this.paso2Form = this.fb.group({});
  }

  ngOnInit(): void {
    // CORRECCIN: Usar getEmpresaExamen() en lugar de getEmpresa()
    this.empresa = this.empresaService.getEmpresaExamen();
    
    if (!this.empresa) {
      this.notification.error('Debe verificar su empresa primero');
      this.router.navigate(['/prelogin']);
      return;
    }

    this.idIngresoGenerado = this.generateIdIngreso();
    this.setupFormListeners();
  }

  private createPaso1Form(): FormGroup {
    return this.fb.group({
      numeroRecibo: ['', [Validators.required, Validators.pattern('^[0-9\\-]+$')]],
      totalImporte: ['', [Validators.required, Validators.min(0)]],
      cantidadAsegurados: ['', [Validators.required, Validators.min(1)]],
      imagenRecibo: [null, Validators.required],
      correoEmpleador: ['', [Validators.email]],
      celularEmpleador: ['', [Validators.pattern('^[0-9]{8}$')]]
    });
  }

  private setupFormListeners(): void {
    this.paso1Form.get('cantidadAsegurados')?.valueChanges.subscribe(cantidad => {
      this.updateContactoValidations(cantidad);
    });
  }

  private updateContactoValidations(cantidad: number): void {
    const correoControl = this.paso1Form.get('correoEmpleador');
    const celularControl = this.paso1Form.get('celularEmpleador');

    if (cantidad > 1) {
      correoControl?.setValidators([Validators.required, Validators.email]);
      celularControl?.setValidators([Validators.required, Validators.pattern('^[0-9]{8}$')]);
    } else {
      correoControl?.clearValidators();
      celularControl?.clearValidators();
    }

    correoControl?.updateValueAndValidity();
    celularControl?.updateValueAndValidity();
  }

  private generateIdIngreso(): string {
    const timestamp = Date.now();
    const random = Math.floor(Math.random() * 10000);
    const empresaId = this.empresa?.id?.toString().substr(0, 4) || '0000';
    return `ING-${empresaId}-${timestamp}-${random}`;
  }

  // M茅todos para manejar eventos de componentes hijos
  onFileReciboSelected(file: File): void {
    this.paso1Form.patchValue({ imagenRecibo: file });
  }

  onAseguradoAdded(aseguradoData: any): void {
    const asegurado: AseguradoExamen = {
      ...aseguradoData,
      idTemporal: Date.now() + Math.random()
    };

    this.asegurados = [...this.asegurados, asegurado];
    
    // CORRECCIN: Manejar idTemporal undefined
    const idParaArchivos = asegurado.idTemporal || asegurado.aseguradoId || Date.now();
    
    this.archivosAsegurados[idParaArchivos] = { 
      anverso: null, 
      reverso: null 
    };
    
    this.notification.success(`Asegurado "${asegurado.nombreCompleto}" agregado`);
  }

  onAseguradoDeleted(aseguradoId: number): void {
    this.asegurados = this.asegurados.filter(a => 
      a.aseguradoId !== aseguradoId && a.idTemporal !== aseguradoId
    );
    
    // CORRECCIN: Solo eliminar si existe
    if (aseguradoId in this.archivosAsegurados) {
      delete this.archivosAsegurados[aseguradoId];
    }
    
    this.notification.info('Asegurado eliminado');
  }

  onFileAseguradoSelected(data: { aseguradoId: number, tipo: 'anverso' | 'reverso', file: File }): void {
    const { aseguradoId, tipo, file } = data;
    
    // CORRECCIN: Inicializar si no existe
    if (!this.archivosAsegurados[aseguradoId]) {
      this.archivosAsegurados[aseguradoId] = { anverso: null, reverso: null };
    }
    
    this.archivosAsegurados[aseguradoId][tipo] = file;
    
    this.notification.success(`Archivo ${tipo} cargado`);
  }

  // M茅todos helper para UI
  contarAseguradosCompletos(): number {
    return this.asegurados.filter(a => 
      a.correoElectronico?.trim() && a.celular?.trim()
    ).length;
  }

  contarAseguradosConArchivos(): number {
    return this.asegurados.filter(asegurado => {
      const id = asegurado.idTemporal || asegurado.aseguradoId;
      const archivos = this.archivosAsegurados[id];
      return archivos?.anverso && archivos?.reverso;
    }).length;
  }

  tieneArchivosCompletos(aseguradoId: number): boolean {
    const asegurado = this.asegurados.find(a => 
      a.aseguradoId === aseguradoId || a.idTemporal === aseguradoId
    );

    if (!asegurado) return false;

    const idParaArchivos = asegurado.idTemporal || asegurado.aseguradoId;
    const archivos = this.archivosAsegurados[idParaArchivos];
    return !!archivos?.anverso && !!archivos?.reverso;
  }

  // Validaciones
  canProceedToStep2(): boolean {
    const cantidadPermitida = this.paso1Form.get('cantidadAsegurados')?.value || 0;
    
    if (this.asegurados.length !== cantidadPermitida) return false;
    
    return this.asegurados.every(asegurado => {
      const id = asegurado.idTemporal || asegurado.aseguradoId;
      const archivos = this.archivosAsegurados[id];
      return asegurado.correoElectronico?.trim() && 
             asegurado.celular?.trim() && 
             archivos?.anverso && 
             archivos?.reverso;
    });
  }

  // Finalizaci贸n
  finalizarRegistro(): void {
    if (!this.canProceedToStep2()) {
      this.notification.warning('Complete todos los requisitos antes de continuar');
      return;
    }

    this.isLoading = true;
    
    const examenData = this.prepareExamenData();
    
    // CORRECCIN: Usar createExamen() en lugar de create()
    this.examenService.createExamen(examenData)
      .pipe(
        take(1),
        finalize(() => this.isLoading = false)
      )
      .subscribe({
        next: (response) => this.handleSuccess(response),
        error: (error) => this.handleError(error)
      });
  }

  private prepareExamenData(): ExamenRequest {
    return {
      numeroPatronal: this.empresa.numeroPatronal,
      razonSocial: this.empresa.razonSocial,
      nit: this.empresa.nit || this.empresa.ruc || '',
      observaciones: `Recibo: ${this.paso1Form.get('numeroRecibo')?.value}`,
      Asegurados: this.asegurados.map(asegurado => ({
        aseguradoId: asegurado.aseguradoId || 0,
        ci: asegurado.ci,
        nombreCompleto: asegurado.nombreCompleto,
        fechaNacimiento: this.formatDate(asegurado.fechaNacimiento),
        genero: asegurado.genero,
        correoElectronico: asegurado.correoElectronico,
        celular: asegurado.celular,
        empresa: asegurado.empresa || this.empresa.razonSocial,
        nitEmpresa: asegurado.nitEmpresa || this.empresa.nit
      }))
    };
  }

  private formatDate(date: any): string {
    if (!date) return '';
    const d = new Date(date);
    return d.toISOString().split('T')[0];
  }

   private handleSuccess(response: any): void {
    this.notification.success('Examen registrado exitosamente');
    
    // Obtener el componente Paso3Finalizar para mostrar el modal
    const paso3Component = this.getPaso3Component();
    if (paso3Component) {
      paso3Component.mostrarModalExito(response);
    } else {
      // Fallback: mostrar el modal directamente
      this.mostrarModalExito(response);
    }
  }

  private getPaso3Component(): Paso3Finalizar | null {
    // Este m茅todo depende de c贸mo est茅s obteniendo la referencia al componente
    // En una implementaci贸n real, podr铆as usar @ViewChild
    return null; // Implementa seg煤n tu estructura
  }

  mostrarModalExito(response: any): void {
  const modalData = {
    idIngreso: this.idIngresoGenerado,
    fechaRegistro: new Date(),
    numeroRecibo: this.paso1Form.get('numeroRecibo')?.value,
    totalAsegurados: this.asegurados.length,
    importeTotal: this.paso1Form.get('totalImporte')?.value,
    empresa: {
      razonSocial: this.empresa?.razonSocial || '',
      nit: this.empresa?.nit || this.empresa?.NIT || '',
      numeroPatronal: this.empresa?.numeroPatronal || this.empresa?.nroPatronal || ''
    }
  };

  const dialogRef = this.dialog.open(ExamenExitoModal, {
    width: '700px',
    maxWidth: '95vw',
    maxHeight: '90vh', // Altura m谩xima
    height: 'auto', // Altura autom谩tica
    data: modalData,
    disableClose: false, // PERMITIR cerrar con ESC y clic fuera
    panelClass: 'exito-modal-dialog',
    autoFocus: false,
    hasBackdrop: true, // Fondo oscuro
    backdropClass: 'modal-backdrop'
  });

  dialogRef.afterClosed().subscribe((result: any) => {
    if (result?.action === 'salir') {
      // El modal ya maneja la redirecci贸n
    } else if (result?.action === 'nuevo') {
      // Reiniciar formulario
      this.resetForm();
      if (this.stepper) {
        this.stepper.selectedIndex = 0;
      }
    } else if (result?.action === 'close') {
      // Solo cerrar el modal, sin acci贸n adicional
      console.log('Modal cerrado por el usuario');
    }
  });
}

  // M茅todo para manejar el evento de reinicio desde el modal
  onReiniciarRegistro(): void {
    this.resetForm();
    if (this.stepper) {
      this.stepper.selectedIndex = 0;
    }
  }

  private handleError(error: any): void {
    console.error('Error al guardar examen:', error);
    this.notification.error(this.getErrorMessage(error));
  }

  private getErrorMessage(error: any): string {
    if (error.status === 400) {
      return error.error?.detail || 'Error en los datos enviados';
    }
    if (error.status === 409) {
      return 'Ya existe un examen pendiente para esta empresa';
    }
    return 'Error al procesar la solicitud';
  }

  private showSuccessModal(): void {
    // Aqu铆 podr铆as implementar un modal de 茅xito
    setTimeout(() => {
      this.resetForm();
      this.stepper.selectedIndex = 0;
    }, 2000);
  }

  private resetForm(): void {
    this.paso1Form.reset();
    this.asegurados = [];
    this.archivosAsegurados = {};
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\examen-preocupacional\examen-preocupacional.html 
============================================================================== 
<!-- features/examenes-preocupacionales/examen-preocupacional/examen-preocupacional.html -->
<div class="examen-container">

    <!-- Header Component -->
    <app-header></app-header>

    <mat-card class="examen-card">

        <!-- Header interno del card -->
        <mat-card-header>
            <mat-card-title class="examen-title">
                Registro de Examen Preocupacional
            </mat-card-title>
            <mat-card-subtitle class="examen-subtitle">
                Complete los datos en los siguientes pasos
            </mat-card-subtitle>
        </mat-card-header>


        <mat-card-content>
            <!-- Stepper -->
            <mat-stepper #stepper linear>

                <!-- PASO 1: Datos del Recibo -->
                <mat-step [stepControl]="paso1Form" label="Datos del Recibo">

                    <!-- Componente hijo para Paso 1 -->
                    <app-paso1-datos-recibo [form]="paso1Form" (fileSelected)="onFileReciboSelected($event)"
                        (fileRemoved)="paso1Form.get('imagenRecibo')?.setValue(null)">
                    </app-paso1-datos-recibo>

                    <!-- Acciones del paso -->
                    <div class="step-actions">
                        <button mat-button matStepperNext [disabled]="!paso1Form.valid" color="primary"
                            class="next-button">
                            Siguiente
                            <mat-icon>arrow_forward</mat-icon>
                        </button>
                    </div>

                </mat-step>

                <!-- PASO 2: Asegurados -->
                <mat-step [stepControl]="paso2Form" label="Asegurados">


                    <!-- Componente hijo para Paso 2 -->
                    <app-paso2-asegurados [asegurados]="asegurados" [archivosAsegurados]="archivosAsegurados"
                        [cantidadPermitida]="paso1Form.get('cantidadAsegurados')?.value || 0"
                        (agregarAsegurado)="onAseguradoAdded($event)" (eliminarAsegurado)="onAseguradoDeleted($event)"
                        (fileSelected)="onFileAseguradoSelected($event)">
                    </app-paso2-asegurados>

                    <!-- Estado de validaci贸n -->
                    <div class="validation-status" [class.valid]="canProceedToStep2()">
                        <mat-icon>{{ canProceedToStep2() ? 'check_circle' : 'error_outline' }}</mat-icon>
                        <div class="status-details">
                            @if (canProceedToStep2()) {
                            <span class="status-text valid-text"> Todos los requisitos est谩n completos</span>
                            } @else {
                            <span class="status-text error-text">Requisitos pendientes:</span>
                            <ul class="requirements-list">
                                <li>
                                    Asegurados: {{ asegurados.length }} de {{ paso1Form.get('cantidadAsegurados')?.value
                                    }}
                                </li>
                                <li>
                                    Con contacto completo: {{ contarAseguradosCompletos() }} de {{ asegurados.length }}
                                </li>
                                <li>
                                    Con archivos completos: {{ contarAseguradosConArchivos() }} de {{ asegurados.length
                                    }}
                                </li>
                            </ul>
                            }
                        </div>
                    </div>

                    <!-- Acciones del paso -->
                    <div class="step-actions">
                        <button mat-button matStepperPrevious color="basic">
                            <mat-icon>arrow_back</mat-icon>
                            Anterior
                        </button>

                        <button mat-button matStepperNext [disabled]="!canProceedToStep2()" color="primary"
                            class="next-button">
                            Siguiente
                            <mat-icon>arrow_forward</mat-icon>
                        </button>
                    </div>

                </mat-step>

                <!-- PASO 3: Resumen y Finalizar -->
                <mat-step label="Resumen y Finalizar">

                    <!-- Componente hijo para Paso 3 -->
                    <app-paso3-finalizar 
                        [empresa]="empresa" 
                        [paso1Form]="paso1Form" 
                        [asegurados]="asegurados"
                        [archivosAsegurados]="archivosAsegurados" 
                        [idIngresoGenerado]="idIngresoGenerado"
                        [isLoading]="isLoading" [canProceedToStep2]="canProceedToStep2()"
                        (finalizarRegistro)="finalizarRegistro()"
                        (abrirModalExito)="onReiniciarRegistro()">
                    </app-paso3-finalizar>
                    
                    <!-- Acciones del paso -->
                    <div class="step-actions">
                        <button mat-button matStepperPrevious color="basic">
                            <mat-icon>arrow_back</mat-icon>
                            Anterior
                        </button>
                    </div>

                </mat-step>

            </mat-stepper>
        </mat-card-content>

        <!-- Footer informativo -->
        <!-- <mat-card-footer class="examen-footer">
            <div class="footer-content">
                <mat-icon>info</mat-icon>
                <div class="footer-text">
                    <p>Si necesita ayuda, contacte al 谩rea de inform谩tica del CNS.</p>
                    <p class="footer-subtext">Sistema CNS - Versi贸n 1.0.0</p>
                </div>
            </div>
        </mat-card-footer> -->

    </mat-card>
</div>..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\examen-preocupacional\examen-preocupacional.css 
============================================================================== 
/* features/examenes-preocupacionales/examen-preocupacional/examen-preocupacional.css */
.examen-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* Ajuste para el Header */
app-header {
  display: block;
  margin-bottom: 20px;
}

.examen-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

.empresa-banner {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 24px;
  background: #e8f5e9;
  border-bottom: 1px solid #c8e6c9;
}

.empresa-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.empresa-nombre {
  font-weight: 600;
  color: #2e7d32;
}

.empresa-detalle {
  font-size: 14px;
  color: #666;
}

.id-ingreso {
  font-family: 'Courier New', monospace;
  font-weight: 600;
  color: #2196f3;
  background: #e3f2fd;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 14px;
}

/* Stepper */
::ng-deep .mat-step-header {
  background: #f8f9fa !important;
}

/* Recibo info */
.recibo-info {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid #e0e0e0;
}

.recibo-info h4 {
  color: #3f51b5;
  margin: 0 0 15px 0;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
}

.recibo-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}

.detail-item:last-child {
  border-bottom: none;
}

.detail-item .label {
  color: #555;
  font-weight: 500;
}

.detail-item .value {
  color: #333;
  font-weight: 600;
}

/* Validation status */
.validation-status {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
  background: #ffebee;
  border: 1px solid #f44336;
}

.validation-status.valid {
  background: #e8f5e9;
  border: 1px solid #4caf50;
}

.validation-status mat-icon {
  color: #f44336;
  font-size: 24px;
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  margin-top: 2px;
}

.validation-status.valid mat-icon {
  color: #4caf50;
}

.status-details {
  flex: 1;
}

.status-text {
  display: block;
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 8px;
}

.valid-text {
  color: #2e7d32;
}

.error-text {
  color: #c62828;
}

.requirements-list {
  margin: 10px 0 0 0;
  padding-left: 20px;
  color: #666;
  font-size: 14px;
}

.requirements-list li {
  margin-bottom: 5px;
}

/* Step actions */
.step-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 32px;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

.step-actions button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  font-weight: 500;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.step-actions button:hover:not([disabled]) {
  transform: translateY(-1px);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.step-actions button[disabled] {
  opacity: 0.6;
  cursor: not-allowed;
}

.next-button {
  background: #3f51b5;
  color: white !important;
}

.next-button:hover:not([disabled]) {
  background: #303f9f;
}

/* Footer */
.examen-footer {
  padding: 16px 24px;
  background: #f5f5f5;
  border-top: 1px solid #e0e0e0;
}

.footer-content {
  display: flex;
  align-items: center;
  gap: 12px;
}

.footer-content mat-icon {
  color: #666;
}

.footer-text p {
  margin: 0;
  color: #666;
  font-size: 14px;
}

.footer-subtext {
  font-size: 12px;
  color: #999;
  margin-top: 4px;
}

/* Responsive */
@media (max-width: 768px) {
  .examen-container {
    padding: 10px;
  }
  
  .empresa-banner {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .recibo-details {
    grid-template-columns: 1fr;
  }
  
  .step-actions {
    flex-direction: column;
    gap: 12px;
  }
  
  .step-actions button {
    width: 100%;
    justify-content: center;
  }
  
  .validation-status {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
}..
============================================================================== 
ARCHIVO : src\app\features\examenes-preocupacionales\services\examen.service.ts 
============================================================================== 
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { BusquedaAseguradoResponse } from '../../../interface/asegurado.interface';
import { AseguradoExamen } from '../../../interface/examen.interface';
import { AseguradosService } from '../../../core/service/asegurados.service';


@Injectable({
  providedIn: 'root'
})
export class ExamenService {
  
  constructor(private apiAseguradosService: AseguradosService) {}

  /**
   * Buscar asegurado por CI y fecha de nacimiento usando el API service existente
   */
  buscarAsegurado(ci: string, fechaNacimiento: Date): Observable<{success: boolean, data?: AseguradoExamen, mensaje?: string}> {
    // Formatear fecha como YYYY-MM-DD
    const fechaFormateada = this.formatearFecha(fechaNacimiento);
    
    return this.apiAseguradosService.buscarAsegurado(ci, fechaFormateada).pipe(
      map((response: BusquedaAseguradoResponse) => {
        
        // Mapear la respuesta del API a nuestro formato
        return this.mapearRespuestaAsegurado(response, ci, fechaNacimiento);
      }),
      catchError((error) => {
        return of({
          success: false,
          mensaje: this.obtenerMensajeError(error)
        });
      })
    );
  }

  /**
   * Mapear respuesta del API a nuestro formato
   */
  private mapearRespuestaAsegurado(response: BusquedaAseguradoResponse, ci: string, fechaNacimiento: Date): 
    {success: boolean, data?: AseguradoExamen, mensaje?: string} {
    
    // Si la respuesta est谩 vac铆a o no tiene datos
    if (!response || !response.success || !response.data) {
      return {
        success: false,
        mensaje: response?.message || 'Asegurado no encontrado con los datos proporcionados'
      };
    }

    const datosAsegurado = response.data;
    
    // Crear objeto AseguradoExamen
    const asegurado: AseguradoExamen = {
      aseguradoId: datosAsegurado.aseguradoId || 0,
      ci: datosAsegurado.documentoIdentidad || ci,
      nombreCompleto: datosAsegurado.nombreCompleto || `${datosAsegurado.nombres} ${datosAsegurado.paterno} ${datosAsegurado.materno}`.trim(),
      fechaNacimiento: datosAsegurado.fechaNacimiento || this.formatearFecha(fechaNacimiento),
      correoElectronico: datosAsegurado.correoElectronico || '',
      celular: datosAsegurado.celular || '',
      empresa: datosAsegurado.razonSocial || '',
      nitEmpresa: datosAsegurado.nroPatronal || '',
      genero: datosAsegurado.genero,
      // Campos opcionales
      ...(datosAsegurado.cargo && { cargo: datosAsegurado.cargo }),
      ...(datosAsegurado.area && { area: datosAsegurado.area }),
      ...(datosAsegurado.fechaIngreso && { fechaIngreso: datosAsegurado.fechaIngreso }),
      // Campos de la interfaz AseguradoExamen
      idTemporal: Date.now() // ID temporal para la UI
    };

    return {
      success: true,
      data: asegurado,
      mensaje: response.message || 'Asegurado encontrado exitosamente'
    };
  }

  /**
   * Formatear fecha a YYYY-MM-DD
   */
  private formatearFecha(fecha: Date | string): string {
    if (!fecha) return '';
    
    let date: Date;
    
    if (typeof fecha === 'string') {
      if (fecha.includes('/')) {
        const [dia, mes, anio] = fecha.split('/').map(Number);
        date = new Date(Date.UTC(anio, mes - 1, dia, 12, 0, 0));
      } else {
        date = new Date(fecha);
      }
    } else {
      date = fecha;
    }
    
    const year = date.getUTCFullYear();
    const month = String(date.getUTCMonth() + 1).padStart(2, '0');
    const day = String(date.getUTCDate()).padStart(2, '0');
    
    return `${year}-${month}-${day}`;
  }

  /**
   * Obtener mensaje de error amigable
   */
  private obtenerMensajeError(error: any): string {
    if (error.status === 404) {
      return 'Asegurado no encontrado en el sistema';
    } else if (error.status === 401 || error.status === 403) {
      return 'Error de autenticaci贸n. Token inv谩lido o expirado.';
    } else if (error.status === 0) {
      return 'Error de conexi贸n con el servidor';
    } else if (error.error?.message) {
      return error.error.message;
    }
    return 'Error al buscar el asegurado';
  }

  /**
   * Guardar examen preocupacional
   */
  guardarExamen(data: any): Observable<any> {
    // Simulaci贸n de guardado
    return of({
      success: true,
      mensaje: 'Examen preocupacional registrado exitosamente',
      id: Math.floor(Math.random() * 1000)
    }).pipe(map(response => {
      return new Promise(resolve => {
        setTimeout(() => resolve(response), 1500);
      });
    }));
  }
}..
============================================================================== 
ARCHIVO : src\app\features\home\home.ts 
============================================================================== 
// src/app/features/home/home.component.ts
import { Component, OnInit, inject } from '@angular/core';
import { Router, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import { MatButtonModule } from '@angular/material/button';
import { MatCardModule } from '@angular/material/card';
import { MatIconModule } from '@angular/material/icon';
import { MatDividerModule } from '@angular/material/divider';
import { MatGridListModule } from '@angular/material/grid-list';
import { MatListModule } from '@angular/material/list';
import { SesionService } from '../../core/service/sesion.service';
import { EmpresaService } from '../../core/service/empresa.service';
import { SharedMaterialModule } from '../../shared/modules/material.module';
import { MatExpansionModule } from '@angular/material/expansion';

@Component({
  selector: 'app-home',
  standalone: true,
  imports: [
    CommonModule,
    RouterModule,
    SharedMaterialModule,
    MatButtonModule,
    MatCardModule,
    MatIconModule,
    MatDividerModule,
    MatGridListModule,
    MatListModule,
    MatExpansionModule  
  ],
  templateUrl: './home.html',
  styleUrls: ['./home.css']
})
export class Home implements OnInit {
  private readonly router = inject(Router);
  private readonly sesionService = inject(SesionService);
  private readonly empresaService = inject(EmpresaService);

  tieneSesionActiva = false;
  empresaNombre = '';
  idAcceso = '';

  ngOnInit(): void {
    this.verificarSesion();
  }

  private verificarSesion(): void {
    const idAcceso = this.sesionService.getIdAcceso();
    const empresa = this.empresaService.getEmpresaExamen();
    
    this.tieneSesionActiva = !!idAcceso && !!empresa;
    
    if (this.tieneSesionActiva) {
      this.idAcceso = idAcceso || '';
      this.empresaNombre = empresa?.razonSocial || 'Empresa afiliada';
    }
  }

  irAPrelogin(): void {
    this.router.navigate(['/prelogin']);
  }

  irAExamen(): void {
    if (this.tieneSesionActiva) {
      this.router.navigate(['/examen-preocupacional']);
    } else {
      this.irAPrelogin();
    }
  }

  cerrarSesion(): void {
    if (confirm('驴Est谩 seguro de cerrar la sesi贸n?')) {
      this.sesionService.limpiarSesion();
      this.empresaService.limpiarDatosExamen();
      this.verificarSesion();
      this.router.navigate(['/home']);
    }
  }

  scrollToSection(sectionId: string): void {
    const element = document.getElementById(sectionId);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
}..
============================================================================== 
ARCHIVO : src\app\features\home\home.html 
============================================================================== 
<!-- src/app/features/home/home.component.html -->
<div class="home-container">
  
  <!-- ===== CABECERA SUPERIOR INFORMATIVA ===== -->
  <header class="top-info-header">
    <div class="container">
      <div class="info-items">
        <span class="info-item">
          <mat-icon class="info-icon">email</mat-icon>
          contacto@cns.gov.bo
        </span>
        <span class="info-item">
          <mat-icon class="info-icon">phone</mat-icon>
          (591-2) 222-3333
        </span>
      </div>
    </div>
  </header>

  <!-- ===== MEN DE NAVEGACIN PRINCIPAL ===== -->
  <nav class="main-navbar">
    <div class="container">
      <div class="nav-content">
        <!-- Logo e cono -->
        <div class="nav-brand">
          <mat-icon class="brand-icon">medical_services</mat-icon>
          <span class="brand-text">CNS Medicina del Trabajo</span>
        </div>

        <!-- Opciones del Men煤 -->
        <div class="nav-menu">
          <a href="#inicio" class="nav-link active">Inicio</a>
          <a href="#servicios" class="nav-link">Servicios</a>
          <a href="#regionales" class="nav-link">Regionales</a>
          <a href="#requisitos" class="nav-link">Requisitos</a>
          <a [routerLink]="['/login']" class="nav-link">Reserva de Cita</a>
          <a [routerLink]="['admin/login']" class="nav-link">Administrar</a>
        </div>

        <!-- Bot贸n Programar -->
        <button mat-raised-button color="primary" class="programar-btn" [routerLink]="['/login']">
          <mat-icon>schedule</mat-icon>
          Programar
        </button>
      </div>
    </div>
  </nav>

  <!-- ===== HERO SECTION ===== -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Medicina del Trabajo</h1>
        <p class="hero-subtitle">
          Garantizando la salud y seguridad de los trabajadores bolivianos
        </p>
        <p class="hero-description">
          Especializados en ex谩menes m茅dicos ocupacionales, evaluaciones de puestos 
          de trabajo y seguimiento de la salud laboral en cumplimiento con la normativa nacional.
        </p>
        <div class="hero-actions">
          <button mat-raised-button color="primary" class="hero-btn" [routerLink]="['/login']">
            <mat-icon>schedule</mat-icon>
            Reservar Cita
          </button>
          <button mat-stroked-button class="hero-btn secondary" (click)="scrollToSection('servicios')">
            <mat-icon>info</mat-icon>
            Conocer Servicios
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== SECCIN DE TARJETAS INFORMATIVAS ===== -->
  <section class="cards-section" id="servicios">
    <div class="container">
      <h2 class="section-title">Nuestros Servicios Especializados</h2>
      <p class="section-subtitle">
        Evaluaciones m茅dicas integrales para el bienestar laboral
      </p>

      <div class="cards-grid">
        <!-- Tarjeta 1: Examen Preocupacional -->
        <mat-card class="service-card">
          <mat-card-header>
            <div mat-card-avatar class="card-icon">
              <mat-icon>assignment</mat-icon>
            </div>
            <mat-card-title>Examen Preocupacional</mat-card-title>
            <mat-card-subtitle>Ingreso laboral</mat-card-subtitle>
          </mat-card-header>
          <div class="card-image-placeholder">
            <mat-icon class="placeholder-icon">assignment</mat-icon>
          </div>
          <mat-card-content>
            <p>
              Evaluaci贸n m茅dica completa para nuevos ingresos laborales. 
              Garantiza la aptitud del trabajador para sus funciones.
            </p>
            <ul class="card-features">
              <li><mat-icon>check</mat-icon> Evaluaci贸n integral</li>
              <li><mat-icon>check</mat-icon> Historia cl铆nica laboral</li>
              <li><mat-icon>check</mat-icon> Ex谩menes complementarios</li>
            </ul>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" [routerLink]="['/login']">Solicitar</button>
            <button mat-button>M谩s info</button>
          </mat-card-actions>
        </mat-card>

        <!-- Tarjeta 2: Examen Ocupacional -->
        <mat-card class="service-card">
          <mat-card-header>
            <div mat-card-avatar class="card-icon">
              <mat-icon>monitor_heart</mat-icon>
            </div>
            <mat-card-title>Examen Ocupacional</mat-card-title>
            <mat-card-subtitle>Control peri贸dico</mat-card-subtitle>
          </mat-card-header>
          <div class="card-image-placeholder">
            <mat-icon class="placeholder-icon">monitor_heart</mat-icon>
          </div>
          <mat-card-content>
            <p>
              Seguimiento de la salud de trabajadores expuestos a factores de riesgo laboral.
              Prevenci贸n de enfermedades profesionales.
            </p>
            <ul class="card-features">
              <li><mat-icon>check</mat-icon> Monitoreo continuo</li>
              <li><mat-icon>check</mat-icon> Detecci贸n temprana</li>
              <li><mat-icon>check</mat-icon> Prevenci贸n de riesgos</li>
            </ul>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" [routerLink]="['/login']">Solicitar</button>
            <button mat-button>M谩s info</button>
          </mat-card-actions>
        </mat-card>

        <!-- Tarjeta 3: Evaluaci贸n de Puesto de Trabajo -->
        <mat-card class="service-card">
          <mat-card-header>
            <div mat-card-avatar class="card-icon">
              <mat-icon>engineering</mat-icon>
            </div>
            <mat-card-title>Evaluaci贸n de Puesto de Trabajo</mat-card-title>
            <mat-card-subtitle>An谩lisis ergon贸mico</mat-card-subtitle>
          </mat-card-header>
          <div class="card-image-placeholder">
            <mat-icon class="placeholder-icon">engineering</mat-icon>
          </div>
          <mat-card-content>
            <p>
              An谩lisis m茅dico-t茅cnico del puesto de trabajo. Recomendaciones para 
              adaptaci贸n y prevenci贸n de riesgos ergon贸micos.
            </p>
            <ul class="card-features">
              <li><mat-icon>check</mat-icon> An谩lisis ergon贸mico</li>
              <li><mat-icon>check</mat-icon> Recomendaciones t茅cnicas</li>
              <li><mat-icon>check</mat-icon> Reubicaci贸n laboral</li>
            </ul>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" [routerLink]="['/login']">Solicitar</button>
            <button mat-button>M谩s info</button>
          </mat-card-actions>
        </mat-card>

        <!-- Tarjeta 4: Tr谩mite Gestora por Invalidez -->
        <mat-card class="service-card">
          <mat-card-header>
            <div mat-card-avatar class="card-icon">
              <mat-icon>verified</mat-icon>
            </div>
            <mat-card-title>Tr谩mite Gestora por Invalidez</mat-card-title>
            <mat-card-subtitle>Procesos especiales</mat-card-subtitle>
          </mat-card-header>
          <div class="card-image-placeholder">
            <mat-icon class="placeholder-icon">verified</mat-icon>
          </div>
          <mat-card-content>
            <p>
              Gesti贸n de tr谩mites por invalidez laboral. Evaluaci贸n m茅dica 
              y documentaci贸n para procesos de pensi贸n por invalidez.
            </p>
            <ul class="card-features">
              <li><mat-icon>check</mat-icon> Evaluaci贸n m茅dica</li>
              <li><mat-icon>check</mat-icon> Gesti贸n documental</li>
              <li><mat-icon>check</mat-icon> Acompa帽amiento</li>
            </ul>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" [routerLink]="['/login']">Solicitar</button>
            <button mat-button>M谩s info</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </section>

  <!-- ===== SECCIN VISUAL DESTACADA ===== -->
  <section class="featured-section">
    <div class="container">
      <div class="featured-content">
        <h2 class="featured-title">Profesionales Especializados</h2>
        <p class="featured-description">
          Contamos con un equipo de m茅dicos especialistas en medicina del trabajo, 
          comprometidos con la salud preventiva y la excelencia en el servicio.
        </p>
        <div class="doctor-images">
          <div class="doctor-card">
            <div class="doctor-icon">
              <mat-icon>medical_services</mat-icon>
            </div>
            <h4>Dr. Juan P茅rez</h4>
            <p>Especialista en Medicina Ocupacional</p>
          </div>
          <div class="doctor-card">
            <div class="doctor-icon">
              <mat-icon>stethoscope</mat-icon>
            </div>
            <h4>Dra. Mar铆a L贸pez</h4>
            <p>Especialista en Ergonom铆a</p>
          </div>
          <div class="doctor-card">
            <div class="doctor-icon">
              <mat-icon>health_and_safety</mat-icon>
            </div>
            <h4>Dr. Carlos Rodr铆guez</h4>
            <p>Especialista en Seguridad Laboral</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== SECCIN EMPRESAS ASOCIADAS ===== -->
  <section class="companies-section" id="regionales">
    <div class="container">
      <h2 class="section-title">Empresas que conf铆an en nosotros</h2>
      <p class="section-subtitle">
        M谩s de 500 empresas realizan sus ex谩menes preocupacionales con nosotros
      </p>
      
      <div class="companies-grid">
        <div class="company-logo">
          <div class="logo-icon"></div>
          <span>Industrias Nacionales</span>
        </div>
        <div class="company-logo">
          <div class="logo-icon"></div>
          <span>Corporaci贸n Andina</span>
        </div>
        <div class="company-logo">
          <div class="logo-icon">锔</div>
          <span>Tecnolog铆a Avanzada S.A.</span>
        </div>
        <div class="company-logo">
          <div class="logo-icon">锔</div>
          <span>Constructora Boliviana</span>
        </div>
        <div class="company-logo">
          <div class="logo-icon"></div>
          <span>Agroindustria del Valle</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="main-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="footer-brand">
            <mat-icon class="footer-logo">medical_services</mat-icon>
            <div>
              <h3>CNS Medicina del Trabajo</h3>
              <p>Especializados en salud ocupacional</p>
            </div>
          </div>
        </div>
        
        <div class="footer-section">
          <h3 class="footer-title">Contacto</h3>
          <p><mat-icon>location_on</mat-icon> Calle Corneta Mamani N掳 1994, La Paz</p>
          <p><mat-icon>phone</mat-icon> (591-2) 222-2222</p>
          <p><mat-icon>email</mat-icon> medicinadeltrabajo@cns.gov.bo</p>
        </div>
        
        <div class="footer-section">
          <h3 class="footer-title">Horarios</h3>
          <p>Lunes a Viernes: 8:00 - 16:00</p>
          <p>S谩bados: 8:00 - 12:00</p>
          <button mat-raised-button color="primary" class="footer-btn" [routerLink]="['/login']">
            <mat-icon>schedule</mat-icon>
            Reservar Cita
          </button>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>漏 2024 Caja Nacional de Salud - Medicina del Trabajo. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>
</div>..
============================================================================== 
ARCHIVO : src\app\features\home\home.css 
============================================================================== 
/* ===== ESTILOS GENERALES ===== */
.home-container {
  font-family: 'Roboto', sans-serif;
  color: #333;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* ===== CABECERA INFORMATIVA ===== */
.top-info-header {
  background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
  color: white;
  padding: 10px 0;
  font-size: 0.9rem;
}

.info-items {
  display: flex;
  justify-content: flex-end;
  gap: 30px;
  flex-wrap: wrap;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 8px;
  opacity: 0.9;
  transition: opacity 0.3s ease;
}

.info-item:hover {
  opacity: 1;
}

.info-icon {
  font-size: 18px;
  width: 18px;
  height: 18px;
}

/* ===== MEN DE NAVEGACIN ===== */
.main-navbar {
  background: white;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 15px 0;
  position: sticky;
  top: 0;
  z-index: 1000;
  transition: all 0.3s ease;
}

.nav-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
}

.nav-brand {
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 700;
  color: #2e7d32;
  font-size: 1.3rem;
  text-decoration: none;
}

.brand-icon {
  font-size: 36px;
  width: 36px;
  height: 36px;
  color: #4caf50;
  background: #e8f5e9;
  padding: 8px;
  border-radius: 50%;
}

.nav-menu {
  display: flex;
  gap: 30px;
  align-items: center;
  margin: 0 auto;
}

.nav-link {
  color: #555;
  text-decoration: none;
  font-weight: 500;
  padding: 8px 16px;
  border-radius: 6px;
  transition: all 0.3s ease;
  position: relative;
}

.nav-link:hover {
  color: #2e7d32;
  background: #f1f8e9;
}

.nav-link.active {
  color: #2e7d32;
  background: #e8f5e9;
  font-weight: 600;
}

.nav-link.active::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 3px;
  background: #4caf50;
  border-radius: 2px;
}

.programar-btn {
  background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
  color: white;
  font-weight: 600;
  padding: 12px 28px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

.programar-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
}

/* ===== HERO SECTION ===== */
.hero-section {
  background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
  color: white;
  padding: 100px 0;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.hero-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
}

.hero-content {
  position: relative;
  z-index: 1;
  max-width: 800px;
  margin: 0 auto;
}

.hero-title {
  font-size: 3.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: white;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.hero-subtitle {
  font-size: 1.5rem;
  margin-bottom: 30px;
  color: #e8f5e9;
  font-weight: 300;
}

.hero-description {
  font-size: 1.1rem;
  line-height: 1.6;
  color: #f1f8e9;
  margin-bottom: 40px;
  opacity: 0.9;
}

.hero-actions {
  display: flex;
  gap: 20px;
  justify-content: center;
  flex-wrap: wrap;
}

.hero-btn {
  padding: 14px 32px;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
}

.hero-btn.secondary {
  background: transparent;
  border: 2px solid white;
  color: white;
}

.hero-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* ===== SECCIN DE TARJETAS ===== */
.cards-section {
  padding: 100px 0;
  background: #f8f9fa;
}

.section-title {
  text-align: center;
  font-size: 2.8rem;
  color: #1b5e20;
  margin-bottom: 15px;
  font-weight: 700;
}

.section-subtitle {
  text-align: center;
  color: #666;
  font-size: 1.2rem;
  margin-bottom: 60px;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.6;
}

.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.service-card {
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.3s ease;
  border: 1px solid #e0e0e0;
  background: white;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.service-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  border-color: #4caf50;
}

.card-icon {
  background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
  color: white;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 15px;
}

.card-icon mat-icon {
  font-size: 28px;
  width: 28px;
  height: 28px;
}

.card-image-placeholder {
  height: 200px;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
}

.placeholder-icon {
  font-size: 80px;
  width: 80px;
  height: 80px;
  color: #2e7d32;
  opacity: 0.3;
}

mat-card-title {
  color: #1b5e20 !important;
  font-weight: 700 !important;
  font-size: 1.4rem !important;
  margin-bottom: 5px !important;
}

mat-card-subtitle {
  color: #4caf50 !important;
  font-weight: 500 !important;
  font-size: 1rem !important;
}

mat-card-content {
  padding: 24px !important;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

mat-card-content p {
  color: #555;
  line-height: 1.6;
  margin-bottom: 20px;
  font-size: 1rem;
  flex-grow: 1;
}

.card-features {
  list-style: none;
  padding: 0;
  margin: 20px 0 0 0;
}

.card-features li {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
  color: #555;
  font-size: 0.95rem;
}

.card-features mat-icon {
  color: #4caf50;
  font-size: 20px;
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

mat-card-actions {
  padding: 16px 24px !important;
  border-top: 1px solid #f1f8e9;
  margin-top: auto;
}

/* ===== SECCIN VISUAL DESTACADA ===== */
.featured-section {
  padding: 100px 0;
  background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e9 100%);
}

.featured-content {
  text-align: center;
  max-width: 800px;
  margin: 0 auto;
}

.featured-title {
  font-size: 2.8rem;
  color: #1b5e20;
  margin-bottom: 20px;
  font-weight: 700;
}

.featured-description {
  font-size: 1.2rem;
  color: #388e3c;
  line-height: 1.6;
  margin-bottom: 60px;
  opacity: 0.9;
}

.doctor-images {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.doctor-card {
  background: white;
  padding: 40px 30px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.doctor-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
  border-color: #4caf50;
}

.doctor-icon {
  width: 100px;
  height: 100px;
  background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 25px;
}

.doctor-icon mat-icon {
  font-size: 48px;
  width: 48px;
  height: 48px;
  color: white;
}

.doctor-card h4 {
  margin: 0 0 10px 0;
  color: #1b5e20;
  font-size: 1.3rem;
  font-weight: 600;
}

.doctor-card p {
  margin: 0;
  color: #666;
  font-size: 1rem;
}

/* ===== SECCIN EMPRESAS ASOCIADAS ===== */
.companies-section {
  padding: 80px 0;
  background: white;
}

.companies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 30px;
  margin-top: 50px;
}

.company-logo {
  background: white;
  padding: 30px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
  border: 1px solid #e8f5e9;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.company-logo:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  border-color: #4caf50;
}

.logo-icon {
  font-size: 48px;
  margin-bottom: 10px;
}

.company-logo span {
  color: #1b5e20;
  font-weight: 600;
  font-size: 1rem;
}

/* ===== FOOTER ===== */
.main-footer {
  background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
  color: white;
  padding: 80px 0 30px;
}

.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 50px;
  margin-bottom: 60px;
}

.footer-section h3 {
  color: white;
  margin-bottom: 25px;
  font-size: 1.4rem;
  font-weight: 600;
}

.footer-section p {
  margin-bottom: 15px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  opacity: 0.9;
  line-height: 1.6;
}

.footer-section mat-icon {
  margin-top: 3px;
  flex-shrink: 0;
  opacity: 0.8;
}

.footer-brand {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}

.footer-logo {
  font-size: 48px;
  width: 48px;
  height: 48px;
  color: #4caf50;
  background: white;
  padding: 10px;
  border-radius: 50%;
}

.footer-brand h3 {
  margin: 0;
  font-size: 1.4rem;
}

.footer-brand p {
  margin: 5px 0 0 0;
  opacity: 0.8;
}

.footer-btn {
  margin-top: 20px;
  background: white;
  color: #2e7d32;
  font-weight: 600;
  padding: 12px 28px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
}

.footer-btn:hover {
  background: #f1f8e9;
  transform: translateY(-2px);
}

.footer-bottom {
  text-align: center;
  padding-top: 30px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  opacity: 0.7;
  font-size: 0.9rem;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 992px) {
  .hero-title {
    font-size: 2.8rem;
  }
  
  .hero-subtitle {
    font-size: 1.3rem;
  }
  
  .section-title {
    font-size: 2.4rem;
  }
  
  .nav-menu {
    display: none; /* En m贸vil necesitar谩s un men煤 hamburguesa */
  }
  
  .nav-content {
    justify-content: space-between;
  }
}

@media (max-width: 768px) {
  .hero-section {
    padding: 70px 0;
  }
  
  .hero-title {
    font-size: 2.2rem;
  }
  
  .hero-subtitle {
    font-size: 1.1rem;
  }
  
  .hero-actions {
    flex-direction: column;
    align-items: center;
  }
  
  .hero-btn {
    width: 100%;
    max-width: 300px;
    justify-content: center;
  }
  
  .cards-section,
  .featured-section {
    padding: 60px 0;
  }
  
  .section-title {
    font-size: 2rem;
  }
  
  .section-subtitle {
    font-size: 1.1rem;
  }
  
  .companies-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
  
  .footer-content {
    grid-template-columns: 1fr;
    gap: 40px;
  }
}

@media (max-width: 480px) {
  .hero-title {
    font-size: 1.8rem;
  }
  
  .brand-text {
    display: none;
  }
  
  .info-items {
    justify-content: center;
  }
  
  .cards-grid {
    grid-template-columns: 1fr;
  }
  
  .companies-grid {
    grid-template-columns: 1fr;
  }
  
  .doctor-images {
    grid-template-columns: 1fr;
  }
}..
============================================================================== 
ARCHIVO : src\app\interceptors\auth.guard.ts 
============================================================================== 
// auth.guard.ts
import { Injectable } from '@angular/core';
import { Router, CanActivate } from '@angular/router';
import { EmpresaService } from '../core/service/empresa.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {
  
   constructor(
    private empresaService: EmpresaService,
    private router: Router
  ) {}

  canActivate(): boolean {
    console.log('Verificando acceso a examen-preocupacional...');
    
    // Verificar si hay una empresa verificada y activa
    const puedeAcceder = this.empresaService.puedeAccederExamen();
    
    if (!puedeAcceder) {
      console.warn(' Acceso denegado. Redirigiendo a prelogin...');
      
      // Redirigir al prelogin
      this.router.navigate(['/prelogin']);
      return false;
    }
    
    console.log(' Acceso permitido');
    return true;
  }
}..
============================================================================== 
ARCHIVO : src\app\interceptors\auth.interceptor.ts 
============================================================================== 
import { Injectable } from '@angular/core';
import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpErrorResponse } from '@angular/common/http';
import { Observable, throwError } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Router } from '@angular/router';
import { EmpresaService } from '../core/service/empresa.service';
import { STORAGE_KEYS } from '../shared/config/api.config';


@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  constructor(
    private empresaService: EmpresaService,
    private router: Router
  ) {}

  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    // Obtener token del servicio
    const token = this.empresaService.getToken();

    // Clonar request y agregar headers de autorizaci贸n si existe token
    let authReq = req;

    if (token) {
      authReq = req.clone({
        setHeaders: {
          'Authorization': `Bearer ${token}`
        }
      });
    }

    // Manejar respuesta
    return next.handle(authReq).pipe(
      catchError((error: HttpErrorResponse) => this.handleHttpError(error))
    );
  }

  /**
   * Maneja errores HTTP de manera centralizada
   */
  private handleHttpError(error: HttpErrorResponse): Observable<never> {
    if (error.status === 401) {
      this.handleUnauthorizedError();
    }

    // Reenviar el error para que lo maneje el componente o servicio
    return throwError(() => error);
  }

  /**
   * Maneja errores de autenticaci贸n (401)
   */
  private handleUnauthorizedError(): void {
    // Limpiar datos de sesi贸n
    localStorage.removeItem(STORAGE_KEYS.jwtToken);
    this.empresaService.limpiarDatosExamen();

    // Redirigir a la p谩gina de inicio con par谩metros de error
    this.router.navigate(['/'], {
      queryParams: {
        sessionExpired: 'true',
        message: 'Su sesi贸n ha expirado. Por favor, verifique nuevamente su empresa.'
      }
    });
  }
}
..
============================================================================== 
ARCHIVO : src\app\interceptors\truncate.pipe.ts 
============================================================================== 
// pipes/truncate.pipe.ts
import { Pipe, PipeTransform } from '@angular/core';

@Pipe({
  name: 'truncate',
  standalone: true
})
export class TruncatePipe implements PipeTransform {
  transform(value: string, limit: number = 25, completeWords: boolean = false, ellipsis: string = '...'): string {
    if (!value) return '';
    
    if (value.length <= limit) {
      return value;
    }
    
    if (completeWords) {
      limit = value.substr(0, limit).lastIndexOf(' ');
    }
    
    return value.substr(0, limit) + ellipsis;
  }
}..
============================================================================== 
ARCHIVO : src\app\interface\asegurado.interface.ts 
============================================================================== 
export interface Asegurado {
  aseguradoId: number;
  matricula: string;
  estadoAsegurado: string;
  documentoIdentidad: string;
  extencion: string;
  complemento: string;
  fechaNacimiento: string;
  paterno: string;
  materno: string;
  nombres: string;
  genero: string;
  tipoAsegurado: string;
  razonSocial: string;
  nroPatronal: string;
  estadoMora: string;
  grupoFamiliarId: number;
  
  // Hacer estos campos opcionales si no siempre vienen de la API
  correoElectronico?: string;
  celular?: string;
  area?: string;
  cargo?: string;
  fechaIngreso?: Date | string;
  empresaId?: number;
  
  // Campo calculado
  nombreCompleto?: string;
}

export interface BusquedaAseguradoRequest {
  documentoIdentidad: string;
  fechaNacimiento: string;
}

export interface BusquedaAseguradoResponse {
  success: boolean;
  data?: Asegurado;
  message?: string;
}..
============================================================================== 
ARCHIVO : src\app\interface\empresa.interface.ts 
============================================================================== 

export interface Empresa {
  id: number;
  numeroPatronal: string;
  razonSocial: string;
  ruc: string;
  direccion: string;
  telefono: string;
  estado: string;
  email: string;
  fechaAfiliacion: Date;
  tipoEmpresa: string;
}

export interface VerificacionEmpresaResponse {
  success: boolean;
  mensaje: string;
  codigo: string;
  empresa: Empresa;
  token?: string;//tr
  expiracion?: string;//rt
}

export interface EmpresaAfiliada {
  ID: number;
  NIT: string;
  NumeroPatronal: string;
  RazonSocial: string;
  Estado: string;
  Direccion: string;
  Telefono: string;
  Email: string;
  FechaAfiliacion: string;
  TipoEmpresa: string;
}

export interface EmpresaSearchResponse {
  success: boolean;
  message: string;
  data: EmpresaAfiliada[];
  total: number;
}

export interface EmpresaStorage extends Empresa {
  fechaVerificacion: string;
  verificada: boolean;
  puedeAcceder: boolean;
}



..
============================================================================== 
ARCHIVO : src\app\interface\examen.interface.ts 
============================================================================== 
import { AseguradoCreateDTO } from "../core/service/examen-preocupacional.service";


export interface ExamenRequest {
  numeroPatronal: string;
  razonSocial: string;
  nit: string;
  observaciones?: string;
  Asegurados: AseguradoCreateDTO[];
}

/**
 * Respuesta del API al crear un examen
 */
export interface ExamenResponse {
  id: number;
  numeroPatronal: string;
  razonSocial: string;
  nit: string;
  fechaSolicitud: string;
  estado: string;
  observaciones?: string;
}

// Interfaz para asegurados que vienen del backend
export interface AseguradoBackend {
  id: number; // ID en la tabla asegurados
  ci: string;
  nombreCompleto: string;
  documentoIdentidad: string;
  fechaNacimiento: Date | string;
  
  // Campos laborales
  cargo: string;
  area: string;
  fechaIngreso: Date | string;
  nitEmpresa: string;
  empresa: string;
   empresaId?: number;
  
  // Campos de contacto
  correoElectronico: string;
  celular: string;
  
  // Campos adicionales
  genero?: string;
  primerApellido?: string;
  segundoApellido?: string;
  nombres?: string;
  estado?: string;
  codigoAsegurado?: string;
  edad?: number;
  fechaAfiliacion?: Date;
  
  // Campos para el formulario gestora
  formularioAnversoUrl?: string;
  formularioReversoUrl?: string;
}

// Interfaz para usar en el examen preocupacional
export interface AseguradoExamen extends AseguradoCreateDTO {
  // Campos adicionales para el UI
  formularioAnversoUrl?: string;
  formularioReversoUrl?: string;
  idTemporal?: number; // Para manejo temporal en UI
  fechaRegistro?: string;
  estado?: string;
}

// Nueva interfaz para el modal (sin id)
export interface AseguradoModal {
  ci: string;
  fechaNacimiento: Date;
  nombreCompleto: string;
  documentoIdentidad: string;
  correoElectronico: string;
  celular: string;
}..
============================================================================== 
ARCHIVO : src\app\interface\sesion-acceso.interface.ts 
============================================================================== 
// interfaces/sesion.interface.ts
export interface SesionAcceso {
  id: string; // ID 煤nico generado
  empresaId: string;
  razonSocial: string;
  estado: 'ACTIVO' | 'EN_PROCESO' | 'COMPLETADO' | 'EXPIRADO';
  fechaCreacion: Date;
  fechaExpiracion: Date;
  ultimoAcceso: Date;
  pasoActual: number; // 0: prelogin, 1: datos empresa, 2: formulario, etc.
  datosParciales: any; // Datos guardados hasta el momento
  ipOrigen?: string;
  userAgent?: string;
}

export interface CredencialesAcceso {
  idAcceso: string;
  empresaId?: string;
}..
============================================================================== 
ARCHIVO : src\app\models\PaginationDTO.ts 
============================================================================== 
export interface PaginationDTO{ 
    Pagina: number;
    recordsPerPage: number;
}..
============================================================================== 
ARCHIVO : src\app\shared\components\acceso-denegado\acceso-denegado.ts 
============================================================================== 
// shared/components/acceso-denegado/acceso-denegado.ts
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { CommonModule } from '@angular/common';
import { SharedMaterialModule } from '../../modules/material.module';

@Component({
  selector: 'app-acceso-denegado',
  standalone: true,
  imports: [CommonModule, SharedMaterialModule],
  templateUrl: './acceso-denegado.html',
  styleUrls: ['./acceso-denegado.css']
})
export class AccesoDenegado implements OnInit {
  // Informaci贸n del usuario para mostrar contexto
  userInfo: any = null;
  requiredRoles: string[] = ['admin', 'administrador_citas'];
  requiredPermissions: string[] = ['administrar_citas'];
  
  constructor(private router: Router) {}
  
  ngOnInit(): void {
    // Obtener informaci贸n del usuario desde localStorage
    this.loadUserInfo();
  }
  
  private loadUserInfo(): void {
    try {
      const userData = localStorage.getItem('cns_auth_data');
      if (userData) {
        this.userInfo = JSON.parse(userData);
      }
    } catch (error) {
      console.error('Error cargando informaci贸n del usuario:', error);
    }
  }
  
  // M茅todos para obtener informaci贸n 煤til
  getUsuarioNombre(): string {
    return this.userInfo?.nombreCompleto || this.userInfo?.username || 'Usuario';
  }
  
  getUsuarioRoles(): string[] {
    return this.userInfo?.roles || [];
  }
  
  getUsuarioPermisos(): string[] {
    return this.userInfo?.permisos || [];
  }
  
  getRolesFaltantes(): string[] {
    const userRoles = this.getUsuarioRoles();
    return this.requiredRoles.filter(role => !userRoles.includes(role));
  }
  
  getPermisosFaltantes(): string[] {
    const userPermisos = this.getUsuarioPermisos();
    return this.requiredPermissions.filter(permiso => !userPermisos.includes(permiso));
  }
  
  // Navegaci贸n
  volverAlInicio(): void {
    this.router.navigate(['/']);
  }
  
  irALogin(): void {
    this.router.navigate(['/login']);
  }
  
  contactarSoporte(): void {
    // Puedes abrir email o redirigir a p谩gina de contacto
    window.location.href = 'mailto:soporte.sistemas@cns.gob.bo';
  }
  
  cerrarSesion(): void {
    localStorage.clear();
    sessionStorage.clear();
    this.router.navigate(['/login']);
  }
}..
============================================================================== 
ARCHIVO : src\app\shared\components\acceso-denegado\acceso-denegado.html 
============================================================================== 
<!-- shared/components/acceso-denegado/acceso-denegado.html -->
<div class="acceso-denegado-container">
  <mat-card class="denegado-card">
    <mat-card-header>
      <mat-card-title class="titulo-principal">
        <mat-icon class="icono-titulo">block</mat-icon>
        Acceso Denegado
      </mat-card-title>
      <mat-card-subtitle class="subtitulo">
        No tiene los permisos necesarios para acceder a esta secci贸n
      </mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Mensaje principal -->
      <div class="mensaje-principal">
        <mat-icon class="icono-error">warning</mat-icon>
        <div class="texto-mensaje">
          <h3>Acceso Restringido</h3>
          <p>
            Estimado <strong>{{ getUsuarioNombre() }}</strong>, 
            su cuenta no cuenta con los permisos necesarios para acceder al sistema de administraci贸n de citas.
          </p>
        </div>
      </div>
      
      <!-- Informaci贸n detallada -->
      <div class="info-detallada">
        <!-- Roles del usuario -->
        <mat-card class="info-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>badge</mat-icon>
              Roles de su cuenta
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (getUsuarioRoles().length > 0) {
              <div class="lista-items">
                @for (rol of getUsuarioRoles(); track rol) {
                  <mat-chip class="rol-chip">{{ rol }}</mat-chip>
                }
              </div>
            } @else {
              <p class="sin-datos">No tiene roles asignados</p>
            }
          </mat-card-content>
        </mat-card>
        
        <!-- Permisos del usuario -->
        <mat-card class="info-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>security</mat-icon>
              Permisos de su cuenta
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (getUsuarioPermisos().length > 0) {
              <div class="lista-items">
                @for (permiso of getUsuarioPermisos(); track permiso) {
                  <mat-chip class="permiso-chip">{{ permiso }}</mat-chip>
                }
              </div>
            } @else {
              <p class="sin-datos">No tiene permisos asignados</p>
            }
          </mat-card-content>
        </mat-card>
        
        <!-- Requisitos faltantes -->
        <mat-card class="info-card requerido">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>error_outline</mat-icon>
              Requisitos Faltantes
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <!-- Roles requeridos -->
            <div class="requisito-section">
              <h4>Roles requeridos:</h4>
              <div class="lista-requisitos">
                @for (rol of requiredRoles; track rol) {
                  <div class="requisito-item" [class.faltante]="getRolesFaltantes().includes(rol)">
                    <mat-icon>
                      {{ getRolesFaltantes().includes(rol) ? 'close' : 'check' }}
                    </mat-icon>
                    <span>{{ rol }}</span>
                  </div>
                }
              </div>
            </div>
            
            <!-- Permisos requeridos -->
            <div class="requisito-section">
              <h4>Permisos requeridos:</h4>
              <div class="lista-requisitos">
                @for (permiso of requiredPermissions; track permiso) {
                  <div class="requisito-item" [class.faltante]="getPermisosFaltantes().includes(permiso)">
                    <mat-icon>
                      {{ getPermisosFaltantes().includes(permiso) ? 'close' : 'check' }}
                    </mat-icon>
                    <span>{{ permiso }}</span>
                  </div>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      
      <!-- Instrucciones -->
      <div class="instrucciones">
        <mat-icon>info</mat-icon>
        <div class="instrucciones-contenido">
          <h4>驴Necesita acceso a esta secci贸n?</h4>
          <p>
            Para solicitar permisos de administraci贸n de citas, contacte al 谩rea de Sistemas del CNS 
            o solicite a su supervisor que le asigne los roles correspondientes.
          </p>
        </div>
      </div>
    </mat-card-content>
    
    <mat-card-actions class="acciones">
      <div class="acciones-primarias">
        <button mat-raised-button color="primary" (click)="volverAlInicio()">
          <mat-icon>home</mat-icon>
          Volver al Inicio
        </button>
        
        <button mat-button (click)="contactarSoporte()">
          <mat-icon>support_agent</mat-icon>
          Contactar Soporte
        </button>
      </div>
      
      <div class="acciones-secundarias">
        <button mat-stroked-button color="warn" (click)="cerrarSesion()">
          <mat-icon>logout</mat-icon>
          Cerrar Sesi贸n
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>..
============================================================================== 
ARCHIVO : src\app\shared\components\acceso-denegado\acceso-denegado.css 
============================================================================== 
/* shared/components/acceso-denegado/acceso-denegado.css */
.acceso-denegado-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.denegado-card {
  max-width: 800px;
  width: 100%;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  border-left: 6px solid #dc3545;
}

/* Header */
.titulo-principal {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #dc3545;
  margin: 0;
  font-size: 1.8rem;
  font-weight: 600;
}

.icono-titulo {
  font-size: 32px;
  width: 32px;
  height: 32px;
}

.subtitulo {
  color: #666;
  font-size: 1rem;
  margin-top: 8px;
}

/* Mensaje principal */
.mensaje-principal {
  display: flex;
  align-items: flex-start;
  gap: 20px;
  padding: 25px;
  background: #fff3e0;
  border-radius: 12px;
  margin: 20px 0;
  border: 1px solid #ff9800;
}

.icono-error {
  font-size: 40px;
  width: 40px;
  height: 40px;
  color: #ff9800;
  flex-shrink: 0;
}

.texto-mensaje h3 {
  margin: 0 0 10px 0;
  color: #e65100;
  font-size: 1.3rem;
}

.texto-mensaje p {
  margin: 0;
  color: #666;
  line-height: 1.6;
}

/* Informaci贸n detallada */
.info-detallada {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.info-card {
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.3s ease;
}

.info-card:hover {
  transform: translateY(-5px);
}

.info-card.requerido {
  border: 2px solid #dc3545;
  background: #fff5f5;
}

/* Chips */
.rol-chip {
  background: #e3f2fd !important;
  color: #1976d2 !important;
  font-weight: 500;
}

.permiso-chip {
  background: #e8f5e9 !important;
  color: #2e7d32 !important;
  font-weight: 500;
}

.sin-datos {
  color: #999;
  font-style: italic;
  text-align: center;
  padding: 20px;
}

/* Requisitos */
.requisito-section {
  margin-bottom: 20px;
}

.requisito-section h4 {
  margin: 0 0 15px 0;
  color: #333;
  font-size: 1rem;
}

.lista-requisitos {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.requisito-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 15px;
  background: white;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
  transition: all 0.3s ease;
}

.requisito-item.faltante {
  background: #ffebee;
  border-color: #f44336;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.8; }
  100% { opacity: 1; }
}

.requisito-item mat-icon {
  font-size: 20px;
  width: 20px;
  height: 20px;
}

.requisito-item:not(.faltante) mat-icon {
  color: #4caf50;
}

.requisito-item.faltante mat-icon {
  color: #f44336;
}

/* Instrucciones */
.instrucciones {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  padding: 20px;
  background: #e3f2fd;
  border-radius: 12px;
  border-left: 4px solid #2196f3;
  margin: 25px 0;
}

.instrucciones mat-icon {
  color: #2196f3;
  font-size: 28px;
  width: 28px;
  height: 28px;
  flex-shrink: 0;
  margin-top: 2px;
}

.instrucciones-contenido h4 {
  margin: 0 0 10px 0;
  color: #1565c0;
  font-size: 1.1rem;
}

.instrucciones-contenido p {
  margin: 0;
  color: #1976d2;
  line-height: 1.6;
  font-size: 0.95rem;
}

/* Acciones */
.acciones {
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px;
  border-top: 1px solid #e0e0e0;
}

.acciones-primarias {
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
}

.acciones-secundarias {
  display: flex;
  justify-content: center;
}

/* Responsive */
@media (max-width: 768px) {
  .acceso-denegado-container {
    padding: 10px;
  }
  
  .titulo-principal {
    font-size: 1.4rem;
  }
  
  .info-detallada {
    grid-template-columns: 1fr;
  }
  
  .mensaje-principal {
    flex-direction: column;
    text-align: center;
  }
  
  .acciones-primarias {
    flex-direction: column;
  }
  
  .acciones-primarias button {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .denegado-card {
    margin: 10px;
  }
  
  .titulo-principal {
    font-size: 1.2rem;
  }
  
  .subtitulo {
    font-size: 0.9rem;
  }
  
  .texto-mensaje h3 {
    font-size: 1.1rem;
  }
  
  .instrucciones {
    flex-direction: column;
    text-align: center;
  }
}..
============================================================================== 
ARCHIVO : src\app\shared\components\error-modal\error-modal.ts 
============================================================================== 
import { Component, Inject } from '@angular/core';
import { MAT_DIALOG_DATA, MatDialogRef, MatDialogModule } from '@angular/material/dialog';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';

@Component({
  selector: 'app-error-modal',
  imports: [MatDialogModule, MatButtonModule, MatIconModule],
  templateUrl: './error-modal.html',
  styleUrl: './error-modal.css',
})
export class ErrorModal {

 constructor(
    public dialogRef: MatDialogRef<ErrorModal>,
    @Inject(MAT_DIALOG_DATA) public data: { mensaje: string }
  ) {}

  onCerrar(): void {
    this.dialogRef.close();
  }

  onReintentar(): void {
    this.dialogRef.close('reintentar');
  }
}
..
============================================================================== 
ARCHIVO : src\app\shared\components\error-modal\error-modal.html 
============================================================================== 
<h2 mat-dialog-title>
      <mat-icon color="warn">error</mat-icon>
      Error en el Registro
    </h2>
    <mat-dialog-content>
      <p>{{ data.mensaje }}</p>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button mat-button (click)="onCerrar()">Cerrar</button>
      <button mat-raised-button color="primary" (click)="onReintentar()">
        Reintentar
      </button>
    </mat-dialog-actions>..
============================================================================== 
ARCHIVO : src\app\shared\components\error-modal\error-modal.css 
============================================================================== 
..
============================================================================== 
ARCHIVO : src\app\shared\components\header\header.ts 
============================================================================== 

import { RouterModule } from '@angular/router';
import { Component, OnInit, OnDestroy, ChangeDetectorRef, inject } from '@angular/core';
import { SesionService } from '../../../core/service/sesion.service';
import { EmpresaService } from '../../../core/service/empresa.service';
import { Subscription } from 'rxjs';
import { MatIcon } from "@angular/material/icon";
import { SharedMaterialModule } from '../../modules/material.module'; //Angular Material m贸dulos compartidos


@Component({
  selector: 'app-header',
  standalone: true,
  imports: [
    SharedMaterialModule,
    RouterModule, 
    MatIcon
  ],
  templateUrl: './header.html',
  styleUrl: './header.css',
})
export class Header implements OnInit, OnDestroy {
  // Propiedades inicializadas
  idAcceso: string | null = null;
  empresa: any = null;
  diasRestantes: number = 0;
  expiraPronto: boolean = false;
  copiado: boolean = false;
  porcentajeProgreso: number = 0;
  
  // Subscripciones inicializadas
  private sesionSubscription: Subscription | null = null;
  private authSubscription: Subscription | null = null;
  private copiadoTimeout: any = null;

  private sesionService = inject(SesionService);
  private empresaService = inject(EmpresaService);
  private cdRef = inject(ChangeDetectorRef);

  ngOnInit(): void {
    console.log('SessionHeader inicializado');
    
    // Obtener ID de acceso inicial
    this.idAcceso = this.sesionService.getIdAcceso();
    
    // Obtener empresa inicial
    this.empresa = this.empresaService.getEmpresaExamen();
    
    console.log(' Estado inicial header:', {
      idAcceso: this.idAcceso,
      empresa: this.empresa?.razonSocial || 'No hay empresa'
    });
    
    
    
    // Suscribirse a cambios en la sesi贸n
    this.sesionSubscription = this.sesionService.getSesionActual()
      .subscribe(sesion => {
        console.log(' Cambio en sesi贸n detectado:', sesion?.id);
        if (sesion) {
          this.actualizarEstadoSesion(sesion);
        } else {
          this.idAcceso = null;
          this.empresa = null;
        }
        this.cdRef.detectChanges();
      });
    
    // Suscribirse a cambios en la empresa
   this.authSubscription = this.empresaService.empresaChanged$
      .subscribe(empresa => {
        console.log('Cambio en empresa detectado:', empresa?.razonSocial);
        this.empresa = empresa;
        this.cdRef.detectChanges();
      });
  }

  ngOnDestroy(): void {
    // Limpiar subscripciones de forma segura
    if (this.sesionSubscription) {
      this.sesionSubscription.unsubscribe();
    }
    
    if (this.authSubscription) {
      this.authSubscription.unsubscribe();
    }
    
    if (this.copiadoTimeout) {
      clearTimeout(this.copiadoTimeout);
    }
  }

  private actualizarEstadoSesion(sesion: any): void {
    // Calcular d铆as restantes
    const fechaExpiracion = new Date(sesion.fechaExpiracion);
    const ahora = new Date();
    const diffTime = fechaExpiracion.getTime() - ahora.getTime();
    this.diasRestantes = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    this.expiraPronto = this.diasRestantes <= 1;
    
    // Calcular porcentaje de progreso (7 d铆as total)
    const totalDias = 7;
    const diasTranscurridos = totalDias - this.diasRestantes;
    this.porcentajeProgreso = Math.max(0, Math.min(100, (diasTranscurridos / totalDias) * 100));
    
    console.log('Estado sesi贸n actualizado:', {
      diasRestantes: this.diasRestantes,
      expiraPronto: this.expiraPronto,
      porcentajeProgreso: this.porcentajeProgreso
    });
  }

  get mostrarHeader(): boolean {
    const mostrar = !!this.idAcceso;
    console.log(' Mostrar header?', mostrar, 'ID:', this.idAcceso);
    return mostrar;
  }

  get idAccesoFormateado(): string {
    if (!this.idAcceso) return '';
    
    // Mostrar solo las primeras y 煤ltimas partes
    const parts = this.idAcceso.split('-');
    if (parts.length >= 4) {
      return `${parts[0]}-${parts[1]}...${parts[parts.length - 1]}`;
    }
    return this.idAcceso;
  }

  get estadoIcon(): string {
    if (this.expiraPronto) return 'warning';
    return 'timer';
  }

  get estadoTexto(): string {
    if (this.diasRestantes <= 0) return 'Expirada';
    if (this.diasRestantes <= 1) return 'Expira pronto';
    return 'Activa';
  }

  get mostrarProgreso(): boolean {
    return this.diasRestantes > 0 && this.diasRestantes <= 7;
  }

  // M茅todo para truncar texto
  truncarTexto(texto: string, limite: number): string {
    if (!texto) return '';
    if (texto.length <= limite) return texto;
    return texto.substring(0, limite) + '...';
  }

  copiarId(): void {
    if (this.idAcceso) {
      navigator.clipboard.writeText(this.idAcceso).then(() => {
        this.copiado = true;
        this.cdRef.detectChanges();
        
        // Mostrar feedback visual temporal
        if (this.copiadoTimeout) {
          clearTimeout(this.copiadoTimeout);
        }
        
        this.copiadoTimeout = setTimeout(() => {
          this.copiado = false;
          this.cdRef.detectChanges();
        }, 2000);
        
        console.log('ID copiado:', this.idAcceso);
      }).catch(err => {
        console.error('Error al copiar ID:', err);
      });
    }
  }

  verDetalles(): void {
    const detalles = `
ID de Acceso: ${this.idAcceso}
Empresa: ${this.empresa?.razonSocial || 'No especificada'}
N煤mero Patronal: ${this.empresa?.numeroPatronal || this.empresa?.nroPatronal || 'N/A'}
Estado Sesi贸n: ${this.estadoTexto}
Expira en: ${this.diasRestantes} d铆as
    `.trim();
    
    alert(detalles);
  }

  cerrarSesion(): void {
    if (confirm('驴Est谩 seguro de cerrar la sesi贸n? Perder谩 el ID de acceso.')) {
      this.sesionService.limpiarSesion();
      this.empresaService.limpiarDatosExamen();
      window.location.href = '/login';
    }
  }
}..
============================================================================== 
ARCHIVO : src\app\shared\components\header\header.html 
============================================================================== 
<!-- shared/components/header.html (Corregido) -->
<header class="session-header">
  @if (mostrarHeader) {
  <div class="header-container">
    <!-- Logo CNS -->
    <div class="logo-section">
      <mat-icon class="logo-icon">medical_services</mat-icon>
      <div class="logo-text">
        <h2>Medicina del Trabajo</h2>
        <p>Sistemas C.N.S.</p>
      </div>
    </div>

    <!-- Informaci贸n de Sesi贸n -->
    @if (idAcceso) {
    <div class="session-info">
      <!-- ID de Acceso -->
      <div class="info-item id-item" (click)="copiarId()" [matTooltip]="'Copiar ID: ' + idAcceso">
        <mat-icon class="info-icon">vpn_key</mat-icon>
        <div class="info-content">
          <span class="label">ID de Acceso</span>
          <span class="value">{{ idAccesoFormateado }}</span>
        </div>
        @if (!copiado) {
          <mat-icon class="copy-icon">content_copy</mat-icon>
        }
        @if (copiado) {
          <mat-icon class="copy-icon">check</mat-icon>
        }
      </div>

      <!-- Empresa -->
      @if (empresa) {
      <div class="info-item empresa-item" [matTooltip]="empresa.razonSocial">
        <mat-icon class="info-icon">business</mat-icon>
        <div class="info-content">
          <span class="label">Empresa</span>
          <span class="value">
            {{ truncarTexto(empresa.razonSocial, 20) }}
          </span>
        </div>
      </div>
      }

      <!-- Estado de Sesi贸n -->
      <div class="info-item estado-item" [class.expira-pronto]="expiraPronto">
        <mat-icon class="info-icon">{{ estadoIcon }}</mat-icon>
        <div class="info-content">
          <span class="label">Sesi贸n</span>
          <span class="value">
            {{ estadoTexto }}
            @if (diasRestantes > 0) {
            <span class="tiempo-restante">
              ({{ diasRestantes }}d)
            </span>
            }
          </span>
        </div>
      </div>
    </div>
    }

    <!-- Acciones -->
    <div class="header-actions">
      <button mat-icon-button class="action-btn" [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="copiarId()">
          <mat-icon>content_copy</mat-icon>
          <span>Copiar ID</span>
        </button>
        <button mat-menu-item (click)="verDetalles()">
          <mat-icon>info</mat-icon>
          <span>Detalles de sesi贸n</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="cerrarSesion()" class="logout-btn">
          <mat-icon>logout</mat-icon>
          <span>Cerrar sesi贸n</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- Barra de progreso -->
  @if (mostrarProgreso) {
  <div class="progress-bar">
    <div class="progress-fill" [style.width.%]="porcentajeProgreso"></div>
  </div>
  }
  }
</header>..
============================================================================== 
ARCHIVO : src\app\shared\components\header\header.css 
============================================================================== 
.session-header {
  background: white;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  height: 70px;
  max-width: 1400px;
  margin: 0 auto;
}

/* Logo Section */
.logo-section {
  display: flex;
  align-items: center;
  gap: 15px;
  flex: 0 0 auto;
}

.logo-icon {
  font-size: 36px;
  width: 36px;
  height: 36px;
  color: #4caf50;
  background: #e8f5e9;
  border-radius: 50%;
  padding: 6px;
}

.logo-text h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #333;
  line-height: 1.2;
}

.logo-text p {
  margin: 0;
  font-size: 12px;
  color: #666;
}

/* Session Info */
.session-info {
  display: flex;
  align-items: center;
  gap: 15px;
  flex: 1;
  justify-content: center;
  padding: 0 20px;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 15px;
  border-radius: 8px;
  background: #f8f9fa;
  border: 1px solid #e0e0e0;
  transition: all 0.3s ease;
  cursor: default;
  min-width: 180px;
  max-width: 250px;
}

.id-item {
  cursor: pointer;
  border-color: #4caf50;
  background: #e8f5e9;
}

.id-item:hover {
  background: #d4edda;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
}

.empresa-item {
  border-color: #2196f3;
  background: #e3f2fd;
}

.estado-item {
  border-color: #ff9800;
  background: #fff3e0;
}

.estado-item.expira-pronto {
  border-color: #f44336;
  background: #ffebee;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}

.info-icon {
  font-size: 20px;
  width: 20px;
  height: 20px;
  color: #4caf50;
  flex-shrink: 0;
}

.empresa-item .info-icon {
  color: #2196f3;
}

.estado-item .info-icon {
  color: #ff9800;
}

.estado-item.expira-pronto .info-icon {
  color: #f44336;
}

.info-content {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0;
}

.label {
  font-size: 10px;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
  margin-bottom: 2px;
}

.value {
  font-size: 13px;
  font-weight: 500;
  color: #333;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.id-item .value {
  font-family: 'Courier New', monospace;
  font-weight: 600;
  color: #2e7d32;
}

.copy-icon {
  font-size: 16px !important;
  width: 16px !important;
  height: 16px !important;
  color: #666;
  flex-shrink: 0;
  transition: color 0.3s;
}

.id-item:hover .copy-icon {
  color: #4caf50;
}

.tiempo-restante {
  font-size: 11px;
  color: #666;
  margin-left: 4px;
}

.estado-item.expira-pronto .tiempo-restante {
  color: #f44336;
  font-weight: 600;
}

/* Header Actions */
.header-actions {
  flex: 0 0 auto;
}

.action-btn {
  color: #666;
  transition: all 0.3s;
}

.action-btn:hover {
  color: #4caf50;
  background: #f5f5f5;
}

/* Progress Bar */
.progress-bar {
  height: 3px;
  background: #e0e0e0;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #4caf50, #81c784);
  transition: width 0.5s ease;
}

/* Responsive */
@media (max-width: 1024px) {
  .session-info {
    gap: 10px;
    padding: 0 10px;
  }
  
  .info-item {
    min-width: 160px;
    padding: 8px 12px;
  }
}

@media (max-width: 768px) {
  .header-container {
    padding: 0 16px;
    height: 60px;
  }
  
  .session-info {
    display: none;
  }
  
  .logo-text h2 {
    font-size: 16px;
  }
  
  .logo-text p {
    font-size: 11px;
  }
  
  .header-actions {
    margin-left: auto;
  }
}

/* Para mostrar informaci贸n en m贸vil */
@media (max-width: 768px) {
  .mobile-info-button {
    display: block;
    margin-left: 10px;
  }
}..
============================================================================== 
ARCHIVO : src\app\shared\config\api.config.ts 
============================================================================== 
export const API_CONFIG = {
  baseUrl: 'https://api-desarrollo.cns.gob.bo/erpcns',
  version: 'v1',
  endpoints: {
    aseguradoTitular: '/Afiliaciones/Asegurados/AseguradoTitular',
    empresasAfiliadas: '/Afiliaciones/EmpresasAfiliadas/Search'
  }
};

export const STORAGE_KEYS = {
  jwtToken: 'jwt_token',
  empresaExamen: 'empresa_examen_preocupacional',
  sesionAcceso: 'examen_sesion_acceso',       // A帽adido
  idAcceso: 'examen_id_acceso'               // A帽adido
} as const;

export const ERROR_MESSAGES = {
  connection: 'Error de conexi贸n. Verifique su conexi贸n a internet.',
  unauthorized: 'No autorizado. Token JWT inv谩lido o expirado.',
  forbidden: 'Acceso prohibido. No tiene permisos para acceder a este recurso.',
  notFound: 'Recurso no encontrado.',
  serverError: 'Error interno del servidor.',
  serviceUnavailable: 'Servicio temporalmente no disponible. Intente m谩s tarde.',
  empresaNotFound: 'Empresa no encontrada. Verifique el n煤mero patronal.',
  empresaInactiva: 'La empresa no est谩 activa para realizar ex谩menes.'
};..
============================================================================== 
ARCHIVO : src\app\shared\modules\material.module.ts 
============================================================================== 
// shared/modules/material.module.ts
import { NgModule } from '@angular/core';

// Material Components
import { MatButtonModule } from '@angular/material/button';
import { MatCardModule } from '@angular/material/card';
import { MatCheckboxModule } from '@angular/material/checkbox';
import { MatDatepickerModule } from '@angular/material/datepicker';
import { MatDialogModule } from '@angular/material/dialog';
import { MatDividerModule } from '@angular/material/divider';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatIconModule } from '@angular/material/icon';
import { MatInputModule } from '@angular/material/input';
import { MatMenuModule } from '@angular/material/menu';
import { MatProgressSpinnerModule } from '@angular/material/progress-spinner';
import { MatSelectModule } from '@angular/material/select';
import { MatSnackBarModule } from '@angular/material/snack-bar';
import { MatStepperModule } from '@angular/material/stepper';
import { MatTableModule } from '@angular/material/table';
import { MatTooltipModule } from '@angular/material/tooltip';
import { MatNativeDateModule } from '@angular/material/core';
import { MatBadgeModule } from '@angular/material/badge';
import { MatChipsModule } from '@angular/material/chips';
import { MatExpansionModule } from '@angular/material/expansion';
import { MatListModule } from '@angular/material/list';
import { MatPaginatorModule } from '@angular/material/paginator';
import { MatSortModule } from '@angular/material/sort';
import { MatTabsModule } from '@angular/material/tabs';

const MATERIAL_MODULES = [
  MatButtonModule,
  MatCardModule,
  MatCheckboxModule,
  MatDatepickerModule,
  MatDialogModule,
  MatDividerModule,
  MatFormFieldModule,
  MatIconModule,
  MatInputModule,
  MatMenuModule,
  MatNativeDateModule,
  MatProgressSpinnerModule,
  MatSelectModule,
  MatSnackBarModule,
  MatStepperModule,
  MatTableModule,
  MatTooltipModule,
  MatBadgeModule,
  MatChipsModule,
  MatExpansionModule,
  MatListModule,
  MatPaginatorModule,
  MatSortModule,
  MatTabsModule
];

@NgModule({
  imports: MATERIAL_MODULES,
  exports: MATERIAL_MODULES
})
export class SharedMaterialModule {}..
============================================================================== 
ARCHIVO : src\app\shared\utils\buildQueryParams.ts 
============================================================================== 
import { HttpParams } from "@angular/common/http";

export function buildQueryParams (obj: any): HttpParams {
    let queryParams = new HttpParams();

    for (let propiedad in obj){
        if (obj.hasOwnProperty(propiedad)){
            queryParams = queryParams.append(propiedad, obj[propiedad]);
        } 
    }
    return queryParams;
}..
============================================================================== 
ARCHIVO : src\app\shared\utils\date-formatter.util.ts 
============================================================================== 
// shared/utils/date-formatter.util.ts
export class DateFormatter {
  static formatDate(date: Date | string | null): string {
    if (!date) return '';
    
    const d = new Date(date);
    if (isNaN(d.getTime())) return '';
    
    const day = d.getDate().toString().padStart(2, '0');
    const month = (d.getMonth() + 1).toString().padStart(2, '0');
    const year = d.getFullYear();
    
    return `${day}/${month}/${year}`;
  }

  static formatDateTime(date: Date | string | null): string {
    if (!date) return '';
    
    const d = new Date(date);
    if (isNaN(d.getTime())) return '';
    
    const day = d.getDate().toString().padStart(2, '0');
    const month = (d.getMonth() + 1).toString().padStart(2, '0');
    const year = d.getFullYear();
    const hours = d.getHours().toString().padStart(2, '0');
    const minutes = d.getMinutes().toString().padStart(2, '0');
    
    return `${day}/${month}/${year} ${hours}:${minutes}`;
  }

  static formatForAPI(date: Date | string): string {
    const d = new Date(date);
    return d.toISOString().split('T')[0];
  }
}..
============================================================================== 
ARCHIVO : src\environments\environment.development.ts 
============================================================================== 
export const environment = {
  
  production: false,
   auth: {
    authority: 'https://auth-desarrollo.cns.gob.bo',
    client_id: 'erp_web_client',
    client_secret: '', // Esto debe ser configurado por el equipo de seguridad
    redirect_uri: `${window.location.origin}/callback`,
    post_logout_redirect_uri: `${window.location.origin}/`,
    response_type: 'code',
    scope: 'openid profile email roles erp_api offline_access',
    silent_redirect_uri: `${window.location.origin}/silent-renew.html`,
    automaticSilentRenew: true,
    accessTokenExpiringNotificationTime: 60
  },
  environment: "local",
  apiUrl: 'https://localhost:7052/api', 
  apiBaseUrl: 'https://api-desarrollo.cns.gob.bo/erpcns/v1',
  appName: 'Sistema de Citas Preocupacionales',
  version: '1.0.0',
  timeout: 30000
};..
============================================================================== 
ARCHIVO : src\environments\environment.ts 
============================================================================== 
export const environment = {
  production: false,
  //environment: "local",
  apiUrl: 'https://localhost:7052/api' 

  //apiBaseUrl: 'https://api-desarrollo.cns.gob.bo/erpcns/v1',
  //appName: 'Sistema de Citas Preocupacionales',
  //version: '1.0.0',
  //timeout: 30000
};..
